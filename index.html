<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢†åœ°ç®¡ç†</title>
    
    <!-- ä½¿ç”¨Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <style>
        /* å®Œå…¨é‡ç½®æ‰€æœ‰æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* å…³é”®ï¼šSillyTaverné€šå¸¸ä½¿ç”¨å›ºå®šé«˜åº¦çš„iframe */
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 12px; /* ä½¿ç”¨æ›´å°çš„åŸºç¡€å­—ä½“ */
        }
        
        #app {
            height: 100%;
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            padding: 5px; /* å‡å°‘å†…è¾¹è· */
        }
        
        /* ä¸»å®¹å™¨ - ç™½è‰²å¡ç‰‡æ ·å¼ */
        .dashboard-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 100%; /* ç¡®ä¿ä¸è¶…è¿‡çˆ¶å®¹å™¨ */
        }
        
        /* æ ‡é¢˜æ  - å›ºå®šé«˜åº¦ */
        .header {
            padding: 8px 12px;
            background: linear-gradient(to right, #2c3e50, #4a6491);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .header-title {
            font-size: 14px;
            font-weight: bold;
        }
        
        .header-time {
            font-size: 11px;
            opacity: 0.8;
        }
        
        .header-buttons {
            display: flex;
            gap: 6px;
        }
        
        .btn-small {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 3px;
            white-space: nowrap;
        }
        
        .btn-refresh {
            background: #3498db;
            color: white;
        }
        
        .btn-settlement {
            background: #27ae60;
            color: white;
        }
        
        /* ä¸»å†…å®¹åŒº - å¯æ»šåŠ¨ */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
            max-height: calc(100vh - 60px); /* åŠ¨æ€è®¡ç®—æœ€å¤§é«˜åº¦ */
        }
        
        /* å…³é”®æŒ‡æ ‡å¡ç‰‡ - ç´§å‡‘å¸ƒå±€ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-bottom: 8px;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 4px;
        }
        
        .stat-icon {
            font-size: 12px;
        }
        
        .stat-title {
            font-size: 11px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .stat-value {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-unit {
            font-size: 10px;
            color: #7f8c8d;
            margin-left: 2px;
        }
        
        /* é€‰é¡¹å¡å¯¼èˆª */
        .tab-nav {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px 6px 0 0;
            overflow: hidden;
        }
        
        .tab-button {
            flex: 1;
            padding: 6px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 11px;
            text-align: center;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .tab-button.active {
            background: white;
            border-bottom: 2px solid #3498db;
            font-weight: 600;
        }
        
        /* é€‰é¡¹å¡å†…å®¹ */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* æ•°æ®è¡¨æ ¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }
        
        .data-table th {
            background: #f8f9fa;
            padding: 6px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .data-table td {
            padding: 6px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        /* ç´§å‡‘åˆ—è¡¨ */
        .compact-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 8px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 3px solid #3498db;
        }
        
        .item-label {
            font-size: 11px;
            color: #666;
        }
        
        .item-value {
            font-size: 11px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        /* è¿›åº¦æ¡ */
        .mini-progress {
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 2px;
        }
        
        .mini-progress-fill {
            height: 100%;
            background: #3498db;
            border-radius: 2px;
        }
        
        /* æ ‡ç­¾æ ·å¼ */
        .tag {
            display: inline-block;
            padding: 1px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .tag-success { background: #d4edda; color: #155724; }
        .tag-warning { background: #fff3cd; color: #856404; }
        .tag-danger { background: #f8d7da; color: #721c24; }
        .tag-info { background: #cce5ff; color: #004085; }
        
        /* æ»šåŠ¨æ¡ä¼˜åŒ– */
        .main-content::-webkit-scrollbar {
            width: 4px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }
        
        /* åº•éƒ¨çŠ¶æ€æ  */
        .footer {
            padding: 4px 8px;
            background: #f8f9fa;
            border-top: 1px solid #e0e0e0;
            font-size: 10px;
            color: #7f8c8d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tab-nav {
                flex-wrap: wrap;
            }
            
            .tab-button {
                min-width: 60px;
            }
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 11px;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100px;
        }
        
        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app"></div>
    
    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        
        const app = createApp({
            setup() {
                // å½“å‰æ¿€æ´»çš„é€‰é¡¹å¡
                const activeTab = ref('overview');
                
                // é¢†åœ°æ•°æ®
                const territory = ref({
                    name: "åŒ—å¢ƒè¾¹å¢ƒé¢†",
                    area: 85,
                    terrain: "ä¸˜é™µä¸æ£®æ—",
                    population: 1250,
                    treasury: 2500,
                    income: 1850,
                    expense: 1670,
                    balance: 180,
                    threat: "è­¦æˆ’",
                    morale: 70,
                    
                    resources: [
                        { name: "ç²®é£Ÿ", amount: 6500, unit: "æ‹…", safe: 3750 },
                        { name: "æœ¨æ", amount: 900, unit: "æ–¹", safe: 300 },
                        { name: "çŸ³æ", amount: 500, unit: "æ–¹", safe: 200 },
                        { name: "é“çŸ¿", amount: 300, unit: "æ–¤", safe: 100 }
                    ],
                    
                    races: [
                        { name: "äººç±»", count: 900, status: "ä¸»å¯¼" },
                        { name: "çŸ®äºº", count: 150, status: "å¹³ç­‰" },
                        { name: "åŠç²¾çµ", count: 100, status: "å¹³ç­‰" },
                        { name: "å“¥å¸ƒæ—", count: 50, status: "å¥´éš¶" }
                    ],
                    
                    military: {
                        regular: 80,
                        militia: 200,
                        elite: 0,
                        rating: "D"
                    },
                    
                    buildings: [
                        { name: "å±…æ°‘åŒº", level: 2, status: "æ­£å¸¸è¿è¥", type: "residential" },
                        { name: "å¸‚åœº", level: 2, status: "æ­£å¸¸è¿è¥", type: "commercial" },
                        { name: "é“åŒ é“º", level: 1, status: "æ­£å¸¸è¿è¥", type: "industrial" },
                        { name: "åŒ—å¢ƒç­æœ›å¡”", level: 1, status: "å»ºè®¾ä¸­", type: "military" }
                    ],
                    
                    technology: [
                        { name: "åŸºç¡€å†œä¸šæŠ€æœ¯", progress: 100, status: "å·²ç ”å‘" },
                        { name: "é“å™¨å†¶ç‚¼æŠ€æœ¯", progress: 45, status: "ç ”å‘ä¸­" },
                        { name: "åŸºç¡€å†›äº‹æˆ˜æœ¯", progress: 0, status: "æœªç ”å‘" }
                    ]
                });
                
                // è®¡ç®—å±æ€§
                const populationFormatted = computed(() => {
                    return territory.value.population.toLocaleString();
                });
                
                const treasuryFormatted = computed(() => {
                    return territory.value.treasury.toLocaleString();
                });
                
                const balanceStatus = computed(() => {
                    const balance = territory.value.balance;
                    if (balance > 0) return { text: 'ç›ˆä½™', color: '#27ae60', icon: 'ğŸ“ˆ' };
                    if (balance < 0) return { text: 'äºæŸ', color: '#e74c3c', icon: 'ğŸ“‰' };
                    return { text: 'å¹³è¡¡', color: '#f39c12', icon: 'âš–ï¸' };
                });
                
                const threatColor = computed(() => {
                    switch(territory.value.threat) {
                        case 'å®‰å…¨': return '#27ae60';
                        case 'è­¦æˆ’': return '#f39c12';
                        case 'å±é™©': return '#e74c3c';
                        case 'æå±é™©': return '#9b59b6';
                        default: return '#7f8c8d';
                    }
                });
                
                const moraleColor = computed(() => {
                    const morale = territory.value.morale;
                    if (morale > 70) return '#27ae60';
                    if (morale > 40) return '#f39c12';
                    return '#e74c3c';
                });
                
                // æ£€æŸ¥èµ„æºæ˜¯å¦ä½äºå®‰å…¨çº¿
                const resourceWarnings = computed(() => {
                    return territory.value.resources.filter(r => r.amount < r.safe);
                });
                
                // åˆ‡æ¢é€‰é¡¹å¡
                const switchTab = (tabName) => {
                    activeTab.value = tabName;
                };
                
                // åˆ·æ–°æ•°æ®
                const refreshData = () => {
                    console.log('åˆ·æ–°é¢†åœ°æ•°æ®...');
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„APIè°ƒç”¨
                };
                
                // æœˆåº¦ç»“ç®—
                const monthlySettlement = () => {
                    if (confirm('ç¡®å®šè¦æ‰§è¡Œæœˆåº¦ç»“ç®—å—ï¼Ÿè¿™å°†æ›´æ–°æ‰€æœ‰ç»æµæ•°æ®ã€‚')) {
                        console.log('æ‰§è¡Œæœˆåº¦ç»“ç®—...');
                        // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„ç»“ç®—é€»è¾‘
                    }
                };
                
                // åˆå§‹åŒ–
                onMounted(() => {
                    console.log('é¢†åœ°ç®¡ç†é¢æ¿å·²åŠ è½½');
                    
                    // è°ƒæ•´iframeé«˜åº¦ä»¥é€‚åº”å†…å®¹
                    const adjustHeight = () => {
                        const height = document.documentElement.scrollHeight;
                        window.parent.postMessage({
                            type: 'resize_iframe',
                            height: height + 'px'
                        }, '*');
                    };
                    
                    // åˆå§‹è°ƒæ•´
                    setTimeout(adjustHeight, 100);
                    
                    // ç›‘å¬å†…å®¹å˜åŒ–
                    const observer = new MutationObserver(adjustHeight);
                    observer.observe(document.body, {
                        childList: true,
                        subtree: true,
                        attributes: true
                    });
                });
                
                return {
                    activeTab,
                    territory,
                    populationFormatted,
                    treasuryFormatted,
                    balanceStatus,
                    threatColor,
                    moraleColor,
                    resourceWarnings,
                    switchTab,
                    refreshData,
                    monthlySettlement
                };
            },
            
            template: `
                <div class="dashboard-container">
                    <!-- æ ‡é¢˜æ  -->
                    <div class="header">
                        <div class="header-left">
                            <div class="header-title">ğŸ° {{ territory.name }}</div>
                            <div class="header-time">æœ€åæ›´æ–°: {{ new Date().toLocaleTimeString() }}</div>
                        </div>
                        <div class="header-buttons">
                            <button @click="refreshData" class="btn-small btn-refresh" title="åˆ·æ–°æ•°æ®">ğŸ”„</button>
                            <button @click="monthlySettlement" class="btn-small btn-settlement" title="æœˆåº¦ç»“ç®—">ğŸ“…</button>
                        </div>
                    </div>
                    
                    <!-- ä¸»å†…å®¹åŒº -->
                    <div class="main-content">
                        <!-- å…³é”®æŒ‡æ ‡ -->
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-header">
                                    <span class="stat-icon">ğŸ‘¥</span>
                                    <span class="stat-title">æ€»äººå£</span>
                                </div>
                                <div class="stat-value">
                                    {{ populationFormatted }}<span class="stat-unit">äºº</span>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <span class="stat-icon">ğŸ’°</span>
                                    <span class="stat-title">å›½åº“èµ„é‡‘</span>
                                </div>
                                <div class="stat-value">
                                    {{ treasuryFormatted }}<span class="stat-unit">é‡‘å¸</span>
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <span class="stat-icon">ğŸ’¸</span>
                                    <span class="stat-title">æœˆåº¦æ”¶æ”¯</span>
                                </div>
                                <div class="stat-value" :style="{ color: balanceStatus.color }">
                                    {{ territory.balance }}<span class="stat-unit">é‡‘å¸</span> {{ balanceStatus.icon }}
                                </div>
                            </div>
                            
                            <div class="stat-card">
                                <div class="stat-header">
                                    <span class="stat-icon">âš ï¸</span>
                                    <span class="stat-title">å¨èƒç­‰çº§</span>
                                </div>
                                <div class="stat-value" :style="{ color: threatColor }">
                                    {{ territory.threat }}
                                </div>
                            </div>
                        </div>
                        
                        <!-- é€‰é¡¹å¡å¯¼èˆª -->
                        <div class="tab-nav">
                            <button class="tab-button" :class="{ active: activeTab === 'overview' }" @click="switchTab('overview')">
                                æ¦‚è§ˆ
                            </button>
                            <button class="tab-button" :class="{ active: activeTab === 'resources' }" @click="switchTab('resources')">
                                èµ„æº
                            </button>
                            <button class="tab-button" :class="{ active: activeTab === 'population' }" @click="switchTab('population')">
                                äººå£
                            </button>
                            <button class="tab-button" :class="{ active: activeTab === 'military' }" @click="switchTab('military')">
                                å†›äº‹
                            </button>
                            <button class="tab-button" :class="{ active: activeTab === 'buildings' }" @click="switchTab('buildings')">
                                å»ºç­‘
                            </button>
                        </div>
                        
                        <!-- æ¦‚è§ˆé€‰é¡¹å¡ -->
                        <div class="tab-content" :class="{ active: activeTab === 'overview' }">
                            <div class="compact-list">
                                <div class="list-item">
                                    <span class="item-label">é¢†åœ°é¢ç§¯</span>
                                    <span class="item-value">{{ territory.area }} å¹³æ–¹é‡Œ</span>
                                </div>
                                <div class="list-item">
                                    <span class="item-label">åœ°å½¢ç‰¹å¾</span>
                                    <span class="item-value">{{ territory.terrain }}</span>
                                </div>
                                <div class="list-item">
                                    <span class="item-label">æ°‘å¿ƒæŒ‡æ•°</span>
                                    <span class="item-value" :style="{ color: moraleColor }">{{ territory.morale }}</span>
                                    <div class="mini-progress">
                                        <div class="mini-progress-fill" :style="{ width: territory.morale + '%' }"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- èµ„æºé¢„è­¦ -->
                            <div v-if="resourceWarnings.length > 0" style="margin-top: 12px;">
                                <h4 style="font-size: 12px; color: #e74c3c; margin-bottom: 6px;">âš ï¸ èµ„æºé¢„è­¦</h4>
                                <div class="compact-list">
                                    <div v-for="resource in resourceWarnings" :key="resource.name" class="list-item" style="border-left-color: #e74c3c;">
                                        <span class="item-label">{{ resource.name }}</span>
                                        <span class="item-value" style="color: #e74c3c;">
                                            {{ resource.amount }}{{ resource.unit }} (å®‰å…¨: {{ resource.safe }}{{ resource.unit }})
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- èµ„æºé€‰é¡¹å¡ -->
                        <div class="tab-content" :class="{ active: activeTab === 'resources' }">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>èµ„æº</th>
                                        <th>å‚¨é‡</th>
                                        <th>å®‰å…¨çº¿</th>
                                        <th>çŠ¶æ€</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="resource in territory.resources" :key="resource.name">
                                        <td>{{ resource.name }}</td>
                                        <td>{{ resource.amount }}{{ resource.unit }}</td>
                                        <td>{{ resource.safe }}{{ resource.unit }}</td>
                                        <td>
                                            <span :class="{
                                                'tag tag-success': resource.amount >= resource.safe * 1.2,
                                                'tag tag-warning': resource.amount >= resource.safe && resource.amount < resource.safe * 1.2,
                                                'tag tag-danger': resource.amount < resource.safe
                                            }">
                                                {{ resource.amount >= resource.safe ? 'å……è¶³' : 'çŸ­ç¼º' }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- äººå£é€‰é¡¹å¡ -->
                        <div class="tab-content" :class="{ active: activeTab === 'population' }">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>ç§æ—</th>
                                        <th>äººå£</th>
                                        <th>å æ¯”</th>
                                        <th>åœ°ä½</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="race in territory.races" :key="race.name">
                                        <td>{{ race.name }}</td>
                                        <td>{{ race.count }}äºº</td>
                                        <td>{{ Math.round((race.count / territory.population) * 100) }}%</td>
                                        <td>
                                            <span :class="{
                                                'tag tag-success': race.status === 'ä¸»å¯¼',
                                                'tag tag-info': race.status === 'å¹³ç­‰',
                                                'tag tag-warning': race.status === 'å—é™åˆ¶',
                                                'tag tag-danger': race.status === 'å¥´éš¶'
                                            }">
                                                {{ race.status }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- å†›äº‹é€‰é¡¹å¡ -->
                        <div class="tab-content" :class="{ active: activeTab === 'military' }">
                            <div class="compact-list">
                                <div class="list-item">
                                    <span class="item-label">å¸¸å¤‡å†›</span>
                                    <span class="item-value">{{ territory.military.regular }}äºº</span>
                                </div>
                                <div class="list-item">
                                    <span class="item-label">æ°‘å…µ</span>
                                    <span class="item-value">{{ territory.military.militia }}äºº</span>
                                </div>
                                <div class="list-item">
                                    <span class="item-label">ç²¾é”éƒ¨é˜Ÿ</span>
                                    <span class="item-value">{{ territory.military.elite }}äºº</span>
                                </div>
                                <div class="list-item">
                                    <span class="item-label">æ€»æˆ˜åŠ›è¯„çº§</span>
                                    <span class="item-value">{{ territory.military.rating }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å»ºç­‘é€‰é¡¹å¡ -->
                        <div class="tab-content" :class="{ active: activeTab === 'buildings' }">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>å»ºç­‘</th>
                                        <th>ç­‰çº§</th>
                                        <th>çŠ¶æ€</th>
                                        <th>ç±»å‹</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="building in territory.buildings" :key="building.name">
                                        <td>{{ building.name }}</td>
                                        <td>Lv.{{ building.level }}</td>
                                        <td>
                                            <span :class="{
                                                'tag tag-success': building.status === 'æ­£å¸¸è¿è¥',
                                                'tag tag-warning': building.status === 'å»ºè®¾ä¸­',
                                                'tag tag-info': building.status === 'å‡çº§ä¸­'
                                            }">
                                                {{ building.status }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="tag" :class="{
                                                'tag-info': building.type === 'residential',
                                                'tag-success': building.type === 'commercial',
                                                'tag-warning': building.type === 'industrial',
                                                'tag-danger': building.type === 'military'
                                            }">
                                                {{ 
                                                    building.type === 'residential' ? 'ä½å®…' : 
                                                    building.type === 'commercial' ? 'å•†ä¸š' : 
                                                    building.type === 'industrial' ? 'å·¥ä¸š' : 'å†›äº‹'
                                                }}
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- åº•éƒ¨çŠ¶æ€æ  -->
                    <div class="footer">
                        <div class="footer-left">
                            é¢†åœ°ç®¡ç†é¢æ¿ v1.0
                        </div>
                        <div class="footer-right">
                            æ•°æ®å·²åŠ è½½ | <a href="#" @click="refreshData" style="color: #3498db; text-decoration: none;">åˆ·æ–°</a>
                        </div>
                    </div>
                </div>
            `
        });
        
        app.mount('#app');
        
        // æä¾›å…¨å±€API
        window.TerritoryManager = {
            updateData: function(newData) {
                const appElement = document.querySelector('#app');
                if (appElement && appElement.__vue_app__) {
                    const instance = appElement.__vue_app__._instance;
                    if (instance && instance.setupState) {
                        instance.setupState.territory = newData;
                    }
                }
            },
            
            // è‡ªåŠ¨è°ƒæ•´iframeé«˜åº¦
            autoResize: function() {
                const height = document.documentElement.scrollHeight;
                if (window.parent) {
                    window.parent.postMessage({
                        type: 'resize_iframe',
                        height: height + 'px'
                    }, '*');
                }
            }
        };
        
        // è‡ªåŠ¨è°ƒæ•´iframeå¤§å°
        setTimeout(() => {
            if (window.TerritoryManager) {
                window.TerritoryManager.autoResize();
            }
        }, 200);
        
        // ç›‘å¬çª—å£å˜åŒ–
        window.addEventListener('resize', () => {
            setTimeout(() => {
                if (window.TerritoryManager) {
                    window.TerritoryManager.autoResize();
                }
            }, 100);
        });
        
        console.log('SillyTavernä¼˜åŒ–ç‰ˆé¢†åœ°ç®¡ç†é¢æ¿å·²åŠ è½½');
    </script>
</body>
</html>
