<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢†åœ°çŠ¶æ€é¢æ¿</title>
    <!-- åŠ è½½lodashï¼Œç”¨äºå®‰å…¨çš„å˜é‡è®¿é—® -->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    <style>
        /* å®Œå…¨é‡ç½®ï¼Œåªä½¿ç”¨æœ€åŸºæœ¬æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            width: 100% !important;
            background: #F5E6C8 !important;
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif !important;
            color: #2C1810 !important;
            font-size: 14px !important;
            line-height: 1.5 !important;
            overflow-x: hidden !important;
        }
        
        /* ä¸»å®¹å™¨ */
        .territory-panel {
            width: 100% !important;
            max-width: 100% !important;
            padding: 10px !important;
            background: #F5E6C8 !important;
        }
        
        /* æ ‡é¢˜å’Œé¢†ä¸»æŒ‰é’® */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #8B6914;
        }
        
        .header-left {
            flex: 1;
        }
        
        .panel-title {
            font-size: 20px;
            color: #2C1810;
            margin-bottom: 5px;
        }
        
        .panel-subtitle {
            color: #8B6914;
            font-size: 12px;
        }
        
        .lord-button {
            padding: 8px 15px;
            background: #8B6914;
            color: #F5E6C8;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        
        .lord-button:hover {
            background: #725811;
            transform: translateY(-2px);
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: #F5E6C8;
            border-radius: 10px;
            padding: 20px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 3px solid #8B6914;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8B6914;
        }
        
        .modal-title {
            font-size: 24px;
            color: #2C1810;
        }
        
        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            color: #8B6914;
            cursor: pointer;
            padding: 5px;
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .control-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(232, 212, 168, 0.5);
            border-radius: 5px;
            border: 1px solid #8B6914;
        }
        
        .control-btn {
            padding: 6px 12px;
            background: #8B6914;
            color: #F5E6C8;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
            min-width: 120px;
            justify-content: center;
        }
        
        .control-btn:hover {
            background: #725811;
        }
        
        /* å¿«é€ŸçŠ¶æ€æ  */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #8B6914;
            border-radius: 5px;
            padding: 10px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #2C1810;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 11px;
            color: #4A3728;
        }
        
        /* é€‰é¡¹å¡å¯¼èˆª - æ›´æ–°é¡ºåº */
        .tab-nav {
            display: flex;
            overflow-x: auto;
            margin-bottom: 10px;
            border-bottom: 1px solid #8B6914;
            background: rgba(232, 212, 168, 0.3);
        }
        
        .tab-btn {
            padding: 8px 15px;
            border: none;
            background: transparent;
            color: #4A3728;
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
        }
        
        .tab-btn.active {
            color: #2C1810;
            font-weight: bold;
            border-bottom: 2px solid #8B6914;
            background: rgba(139, 105, 20, 0.1);
        }
        
        /* é€‰é¡¹å¡å†…å®¹ */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ç« èŠ‚æ ·å¼ */
        .section {
            margin-bottom: 15px;
            border: 1px solid #8B6914;
            border-radius: 5px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .section-header {
            background: #E8D4A8;
            padding: 10px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #8B6914;
        }
        
        .section-title {
            font-weight: bold;
            color: #2C1810;
        }
        
        .section-toggle {
            font-size: 12px;
            color: #8B6914;
        }
        
        .section-content {
            padding: 10px;
            display: block;
        }
        
        /* æ•°æ®è¡¨æ ¼ */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        .data-table th {
            background: #E8D4A8;
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #8B6914;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 6px 8px;
            border-bottom: 1px solid rgba(139, 105, 20, 0.3);
        }
        
        .data-table tr:hover {
            background: rgba(245, 230, 200, 0.5);
        }
        
        /* å»ºç­‘ç½‘æ ¼æ ·å¼ */
        .building-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .building-category {
            margin-bottom: 25px;
        }
        
        .category-title {
            font-size: 16px;
            font-weight: bold;
            color: #2C1810;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #8B6914;
        }
        
        .building-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #8B6914;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .building-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(139, 105, 20, 0.2);
        }
        
        .building-emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .building-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2C1810;
        }
        
        .building-location {
            font-size: 12px;
            color: #8B6914;
            margin-bottom: 5px;
        }
        
        .building-status {
            font-size: 11px;
            color: #4A3728;
        }
        
        .profit-indicator {
            font-weight: bold;
            margin-top: 5px;
        }
        
        .profit-positive {
            color: #28a745;
        }
        
        .profit-negative {
            color: #dc3545;
        }
        
        .profit-neutral {
            color: #6c757d;
        }
        
        /* è§’è‰²ç½‘æ ¼æ ·å¼ - å®½é«˜æ¯”è°ƒæ•´ä¸ºå®½åº¦è¿œå¤§äºé«˜åº¦ */
        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .character-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #8B6914;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            min-height: 80px;
            height: 80px; /* å›ºå®šé«˜åº¦ï¼Œå®½åº¦è‡ªé€‚åº” */
        }
        
        .character-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(139, 105, 20, 0.2);
        }
        
        .character-avatar {
            font-size: 40px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .character-info {
            flex: 1;
            overflow: hidden;
        }
        
        .character-name {
            font-weight: bold;
            margin-bottom: 3px;
            color: #2C1810;
        }
        
        .character-title {
            font-size: 12px;
            color: #8B6914;
            margin-bottom: 5px;
        }
        
        .character-location {
            font-size: 11px;
            color: #4A3728;
            margin-bottom: 5px;
        }
        
        .character-stats {
            display: flex;
            gap: 10px;
            font-size: 11px;
        }
        
        .stat-love, .stat-loyalty {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        /* æ³•ä»¤ç½‘æ ¼æ ·å¼ */
        .decree-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .decree-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #8B6914;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 100px;
        }
        
        .decree-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(139, 105, 20, 0.2);
        }
        
        .decree-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .decree-name {
            font-weight: bold;
            font-size: 16px;
            color: #2C1810;
        }
        
        .decree-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .status-active {
            background: #d4edda;
            color: #155724;
        }
        
        .decree-time {
            font-size: 12px;
            color: #8B6914;
            margin-bottom: 10px;
        }
        
        .decree-effects {
            display: flex;
            gap: 15px;
            font-size: 11px;
        }
        
        .effect-economy, .effect-social {
            flex: 1;
        }
        
        .effect-title {
            font-weight: bold;
            margin-bottom: 3px;
        }
        
        /* è¿›åº¦æ¡ */
        .progress {
            height: 6px;
            background: rgba(139, 105, 20, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin: 4px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: #8B6914;
            border-radius: 3px;
        }
        
        /* æ ‡ç­¾ */
        .tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .tag-success {
            background: #d4edda;
            color: #155724;
        }
        
        .tag-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .tag-danger {
            background: #f8d7da;
            color: #721c24;
        }
        
        /* è­¦å‘Šæ¡† */
        .alert {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 12px;
        }
        
        .alert-warning {
            background: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            color: #856404;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-btn {
                min-width: 100px;
            }
            
            .building-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .character-grid, .decree-grid {
                grid-template-columns: 1fr;
            }
            
            .character-card {
                min-height: 70px;
                height: 70px;
            }
        }
        
        @media (max-width: 480px) {
            .quick-stats {
                grid-template-columns: 1fr;
            }
            
            .tab-nav {
                flex-wrap: wrap;
            }
            
            .tab-btn {
                flex: 1;
                text-align: center;
                min-width: 80px;
            }
            
            .building-grid {
                grid-template-columns: 1fr;
            }
            
            .character-card {
                min-height: 60px;
                height: 60px;
            }
        }
        
        /* åº•éƒ¨ä¿¡æ¯ */
        .footer {
            margin-top: 20px;
            padding: 10px;
            text-align: center;
            color: #4A3728;
            font-size: 11px;
            border-top: 1px solid rgba(139, 105, 20, 0.3);
        }

        /* æ¨¡æ€æ¡†å†…éƒ¨å†…å®¹æ ·å¼ */
        .modal-section {
            margin-bottom: 20px;
        }
        
        .modal-section-title {
            font-size: 18px;
            color: #2C1810;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #8B6914;
        }
        
        .modal-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .modal-info-item {
            margin-bottom: 8px;
        }
        
        .modal-label {
            font-weight: bold;
            color: #4A3728;
            margin-right: 5px;
        }
        
        .modal-value {
            color: #2C1810;
        }
        
        /* å»ºç­‘è¯¦æƒ…æ¨¡æ€æ¡†ç‰¹å®šæ ·å¼ */
        .building-detail-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            border: 1px solid rgba(139, 105, 20, 0.3);
        }
        
        .building-finance-table {
            width: 100%;
            font-size: 12px;
        }
        
        .building-finance-table td {
            padding: 5px;
            border-bottom: 1px solid rgba(139, 105, 20, 0.1);
        }
        
        /* è§’è‰²è¯¦æƒ…æ¨¡æ€æ¡†ç‰¹å®šæ ·å¼ */
        .character-detail-avatar {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .character-avatar-large {
            font-size: 80px;
            margin-bottom: 10px;
        }
        
        .ability-radar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .ability-item {
            text-align: center;
            padding: 10px;
            background: rgba(232, 212, 168, 0.3);
            border-radius: 5px;
        }
        
        .ability-name {
            font-size: 11px;
            color: #4A3728;
            margin-bottom: 5px;
        }
        
        .ability-value {
            font-size: 16px;
            font-weight: bold;
            color: #2C1810;
        }
        
        /* æ³•ä»¤è¯¦æƒ…æ¨¡æ€æ¡†ç‰¹å®šæ ·å¼ */
        .decree-effect-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .decree-effect-category {
            padding: 10px;
            background: rgba(232, 212, 168, 0.3);
            border-radius: 5px;
        }
        
        .effect-category-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2C1810;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #8B6914;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ========== æ–°å¢ï¼šè§’è‰²æ¨¡æ€æ¡†é€‰é¡¹å¡æ ·å¼ ========== */
        .character-modal-tabs {
            display: flex;
            overflow-x: auto;
            margin-bottom: 15px;
            border-bottom: 1px solid #8B6914;
            background: rgba(232, 212, 168, 0.3);
        }
        
        .character-tab-btn {
            padding: 8px 15px;
            border: none;
            background: transparent;
            color: #4A3728;
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            font-size: 13px;
        }
        
        .character-tab-btn.active {
            color: #2C1810;
            font-weight: bold;
            border-bottom: 2px solid #8B6914;
            background: rgba(139, 105, 20, 0.1);
        }
        
        .character-tab-content {
            display: none;
        }
        
        .character-tab-content.active {
            display: block;
        }
        
        /* æ€§ä¿¡æ¯æ ·å¼ */
        .sex-info-section {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            border: 1px solid rgba(139, 105, 20, 0.3);
        }
        
        .sex-info-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2C1810;
            font-size: 15px;
        }
        
        .sex-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .sex-info-item {
            margin-bottom: 5px;
            font-size: 12px;
        }
        
        .sex-progress-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }
        
        .sex-progress-label {
            min-width: 100px;
            font-size: 12px;
        }
        
        /* ç”Ÿç†å‘¨æœŸæŒ‡ç¤ºå™¨ */
        .cycle-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        .cycle-stage {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .cycle-menstrual {
            background: #f8d7da;
            color: #721c24;
        }
        
        .cycle-follicular {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .cycle-ovulation {
            background: #d4edda;
            color: #155724;
        }
        
        .cycle-luteal {
            background: #fff3cd;
            color: #856404;
        }
        
        /* æ€€å­•çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .pregnancy-indicator {
            padding: 8px;
            border-radius: 5px;
            margin-top: 8px;
            font-size: 12px;
        }
        
        .pregnancy-yes {
            background: rgba(220, 53, 69, 0.1);
            border: 1px solid rgba(220, 53, 69, 0.3);
        }
        
        .pregnancy-no {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid rgba(40, 167, 69, 0.3);
        }
        
        /* ä½“æ¶²çŠ¶æ€æ ·å¼ */
        .fluid-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .fluid-item {
            padding: 8px;
            border-radius: 5px;
            background: rgba(232, 212, 168, 0.2);
        }
        
        .fluid-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: #4A3728;
        }
        
        /* æ€§å™¨å®˜ä¿¡æ¯æ ·å¼ */
        .organ-info {
            padding: 10px;
            border-radius: 5px;
            background: rgba(232, 212, 168, 0.2);
            margin-bottom: 10px;
        }
        
        .organ-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2C1810;
            font-size: 14px;
        }
        /* ========== æ™¨æŠ¥ç³»ç»Ÿæ ·å¼ ========== */
.morning-report-btn {
    position: relative;
    padding: 8px 15px;
    background: #8B6914;
    color: #F5E6C8;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s ease;
    margin-left: 10px;
}

.morning-report-btn:hover {
    background: #725811;
    transform: translateY(-2px);
}

.unread-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 10px;
    height: 10px;
    background: #dc3545;
    border-radius: 50%;
    border: 2px solid #F5E6C8;
}

/* æ™¨æŠ¥æ¨¡æ€æ¡†ç‰¹å®šæ ·å¼ */
.morning-report-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.morning-report-card {
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid #8B6914;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
}

.morning-report-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 15px;
}

.morning-report-title {
    font-size: 18px;
    font-weight: bold;
    color: #2C1810;
    margin-right: 10px;
}

.morning-report-category {
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: bold;
    background: #E8D4A8;
    color: #4A3728;
}

.morning-report-content {
    font-size: 14px;
    line-height: 1.6;
    color: #4A3728;
    margin-bottom: 15px;
    padding: 10px;
    background: rgba(232, 212, 168, 0.1);
    border-radius: 5px;
    border-left: 3px solid #8B6914;
}

.morning-report-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.share-btn {
    padding: 6px 12px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.share-btn:hover {
    background: #218838;
}

/* åˆ†äº«è§’è‰²é€‰æ‹©æ¨¡æ€æ¡†æ ·å¼ */
.share-character-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 10px;
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
    margin-top: 15px;
}

.share-character-card {
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid #8B6914;
    border-radius: 5px;
    padding: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 10px;
}

.share-character-card:hover {
    background: rgba(232, 212, 168, 0.3);
    transform: translateY(-2px);
}

.share-character-avatar {
    font-size: 30px;
}

.share-character-name {
    font-weight: bold;
    font-size: 14px;
    color: #2C1810;
}

.share-character-title {
    font-size: 11px;
    color: #8B6914;
}
    </style>
</head>
<body>
    <!-- é¢†ä¸»ä¿¡æ¯æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="lord-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="lord-modal-title">é¢†ä¸»ä¿¡æ¯</h2>
                <button class="close-button" onclick="closeModal('lord-modal')">Ã—</button>
            </div>
            <div id="lord-modal-content">
                <!-- å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- å»ºç­‘è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="building-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="building-modal-title">å»ºç­‘è¯¦æƒ…</h2>
                <button class="close-button" onclick="closeModal('building-modal')">Ã—</button>
            </div>
            <div id="building-modal-content">
                <!-- å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- è§’è‰²è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="character-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="character-modal-title">è§’è‰²è¯¦æƒ…</h2>
                <button class="close-button" onclick="closeModal('character-modal')">Ã—</button>
            </div>
            <div id="character-modal-content">
                <!-- å†…å®¹å°†åŠ¨æ€ç”Ÿæˆï¼ˆå·²åˆ é™¤å¤§emojiå¤´åƒï¼‰ -->
            </div>
        </div>
    </div>
    
    <!-- æ³•ä»¤è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="decree-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="decree-modal-title">æ³•ä»¤è¯¦æƒ…</h2>
                <button class="close-button" onclick="closeModal('decree-modal')">Ã—</button>
            </div>
            <div id="decree-modal-content">
                <!-- å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    <!-- æ™¨æŠ¥æ¨¡æ€æ¡† -->
<div class="modal-overlay" id="morning-report-modal">
    <div class="modal-content" style="max-width: 800px; max-height: 85vh;">
        <div class="modal-header">
            <h2 class="modal-title">ğŸ“° æ™¨æŠ¥ç³»ç»Ÿ</h2>
            <button class="close-button" onclick="closeMorningReportModal()">Ã—</button>
        </div>
        <div id="morning-report-modal-content">
            <!-- æ™¨æŠ¥å†…å®¹å°†åŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</div>

<!-- åˆ†äº«é€‰æ‹©è§’è‰²æ¨¡æ€æ¡† -->
<div class="modal-overlay" id="share-report-modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2 class="modal-title">ğŸ¤ åˆ†äº«æ™¨æŠ¥</h2>
            <button class="close-button" onclick="closeModal('share-report-modal')">Ã—</button>
        </div>
        <div id="share-report-modal-content">
            <div id="share-report-info" style="margin-bottom: 15px; padding: 10px; background: rgba(232, 212, 168, 0.3); border-radius: 5px;">
                <!-- åˆ†äº«ä¿¡æ¯å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="share-character-grid" id="share-character-list">
                <!-- è§’è‰²åˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
</div>
    <div class="territory-panel">
        <!-- æ ‡é¢˜å’Œé¢†ä¸»æŒ‰é’® -->
        <div class="panel-header">
    <div class="header-left">
        <h1 class="panel-title">ğŸ° é¢†åœ°çŠ¶æ€é¢æ¿</h1>
        <div class="panel-subtitle">ç‰ˆæœ¬: 3.0 | æœ€åæ›´æ–°: <span id="last-update">åˆšåˆš</span></div>
    </div>
    <div style="display: flex; align-items: center; gap: 10px;">
        <button class="lord-button" onclick="openLordModal()">
            ğŸ‘‘ <span id="lord-name">é¢†ä¸»</span>
        </button>
        <!-- æ–°å¢æ™¨æŠ¥æŒ‰é’® -->
        <button class="morning-report-btn" onclick="openMorningReportModal()" id="morning-report-btn">
            ğŸ“° æ™¨æŠ¥
            <span class="unread-badge" id="morning-report-badge" style="display: none;"></span>
        </button>
    </div>
</div>
        
        <!-- æ§åˆ¶æ  -->
        <div class="control-bar">
            <button class="control-btn" onclick="refreshData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
            <button class="control-btn" onclick="monthlySettlement()">ğŸ“… æœˆåº¦ç»“ç®—</button>
            <button class="control-btn" onclick="toggleAutoRefresh()" id="auto-refresh-btn">â–¶ï¸ è‡ªåŠ¨åˆ·æ–°</button>
            <button class="control-btn" onclick="exportData()">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
            <button class="control-btn" onclick="showDebugPanel()">ğŸ› è°ƒè¯•ä¿¡æ¯</button>
        </div>
        
        <!-- å¿«é€ŸçŠ¶æ€ -->
        <div class="quick-stats" id="quick-stats">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- é€‰é¡¹å¡å¯¼èˆª - é‡æ–°æ’åº -->
        <div class="tab-nav" id="tab-nav">
            <button class="tab-btn active" onclick="switchTab('overview')">æ¦‚è§ˆ</button>
            <button class="tab-btn" onclick="switchTab('economy')">ç»æµ</button>
            <button class="tab-btn" onclick="switchTab('population')">äººå£</button>
            <button class="tab-btn" onclick="switchTab('military')">å†›äº‹</button>
            <button class="tab-btn" onclick="switchTab('buildings')">å»ºç­‘</button>
            <button class="tab-btn" onclick="switchTab('resources')">èµ„æº</button>
            <button class="tab-btn" onclick="switchTab('technology')">ç§‘æŠ€</button>
            <button class="tab-btn" onclick="switchTab('decrees')">æ³•ä»¤</button>
            <button class="tab-btn" onclick="switchTab('characters')">è§’è‰²</button>
            <button class="tab-btn" onclick="switchTab('diplomacy')">å¤–äº¤</button>
            <button class="tab-btn" onclick="switchTab('system')">ç³»ç»Ÿ</button>
        </div>
        
        <!-- æ¦‚è§ˆé€‰é¡¹å¡ -->
        <div class="tab-content active" id="tab-overview">
            <!-- åŸºç¡€ä¿¡æ¯ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ° é¢†åœ°åŸºç¡€ä¿¡æ¯</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="basic-info">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- ç»æµæ¦‚å†µ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ’° ç»æµæ¦‚å†µ</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="economy-overview">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- äººå£æ¦‚å†µ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ‘¥ äººå£æ¦‚å†µ</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="population-overview">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
            
            <!-- å¨èƒä¸å®‰å…¨ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">âš ï¸ å¨èƒä¸å®‰å…¨</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="threat-overview">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç»æµé€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-economy">
            <!-- è´¢æ”¿çŠ¶å†µ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ’° è´¢æ”¿çŠ¶å†µ</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="finance-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- ç¨æ”¶ä½“ç³» -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ›ï¸ ç¨æ”¶ä½“ç³»</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="tax-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- ç‰©ä»·æŒ‡æ•° -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ“Š ç‰©ä»·æŒ‡æ•°</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="price-index">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
        </div>
        
        <!-- äººå£é€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-population">
            <!-- å¹´é¾„ç»“æ„ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ‘¶ å¹´é¾„ç»“æ„</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="age-structure">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- ç§æ—æ„æˆ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸŒ ç§æ—æ„æˆ</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="race-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- èŒä¸šåˆ†å¸ƒ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ¢ èŒä¸šåˆ†å¸ƒ</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="occupation-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- æ»¡æ„åº¦ç»´åº¦ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ˜Š å±…æ°‘æ»¡æ„åº¦</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="satisfaction-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
        </div>
        
        <!-- å†›äº‹é€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-military">
            <!-- å…µåŠ›çŠ¶å†µ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">âš”ï¸ å…µåŠ›çŠ¶å†µ</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="military-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- è£…å¤‡çŠ¶æ€ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ–ï¸ è£…å¤‡çŠ¶æ€</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="equipment-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- é˜²å¾¡è®¾æ–½ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ° é˜²å¾¡è®¾æ–½</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="defense-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
        </div>
        
        <!-- å»ºç­‘é€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-buildings">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ›ï¸ å»ºç­‘è®¾æ–½</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="buildings-content">
                        <!-- å»ºç­‘å°†æŒ‰åˆ†ç±»åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- èµ„æºé€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-resources">
            <!-- ä»“åº“ç‰©èµ„ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸª ä»“åº“ç‰©èµ„</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="resource-warnings"></div>
                    <table class="data-table" id="warehouse-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- è‡ªç„¶èµ„æº -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸŒ³ è‡ªç„¶èµ„æº</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="natural-resources">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- ç¯å¢ƒçŠ¶å†µ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸŒ¤ï¸ ç¯å¢ƒçŠ¶å†µ</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="environment-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
        </div>
        
        <!-- ç§‘æŠ€é€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-technology">
            <!-- ç§‘æŠ€ç ”å‘ -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ”¬ ç§‘æŠ€ç ”å‘</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="technology-list">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ³•ä»¤é€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-decrees">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ“œ ç°è¡Œæ³•ä»¤</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="decrees-content">
                        <!-- æ³•ä»¤å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è§’è‰²é€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-characters">
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ‘¥ é¢†åœ°è§’è‰²</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="characters-content">
                        <!-- è§’è‰²å¡ç‰‡å°†åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å¤–äº¤é€‰é¡¹å¡ -->
<div class="tab-content" id="tab-diplomacy">
    <!-- å¤–äº¤æ¦‚è§ˆ -->
    <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
            <div class="section-title">ğŸŒ å¤–äº¤æ¦‚è§ˆ</div>
            <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content">
            <div id="diplomacy-overview">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- åŠ¿åŠ›å…³ç³» -->
    <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
            <div class="section-title">ğŸ¤ åŠ¿åŠ›å…³ç³»</div>
            <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content">
            <div id="diplomacy-relations">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
    
    <!-- ä½¿è€…ä¿¡æ¯ -->
    <div class="section">
        <div class="section-header" onclick="toggleSection(this)">
            <div class="section-title">ğŸ‘¤ ä½¿è€…ä¿¡æ¯</div>
            <div class="section-toggle">â–¼</div>
        </div>
        <div class="section-content">
            <div id="diplomacy-envoys">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>
</div>
        
        <!-- ç³»ç»Ÿé€‰é¡¹å¡ -->
        <div class="tab-content" id="tab-system">
            <!-- ç³»ç»Ÿè®¾ç½® -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">âš™ï¸ ç³»ç»Ÿè®¾ç½®</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <table class="data-table" id="system-details">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </table>
                </div>
            </div>
            
            <!-- è°ƒè¯•ä¿¡æ¯ -->
            <div class="section" id="debug-section" style="display: none;">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ› è°ƒè¯•ä¿¡æ¯</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div id="debug-info"></div>
                </div>
            </div>
            
            <!-- æ•°æ®ç®¡ç† -->
            <div class="section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div class="section-title">ğŸ”„ æ•°æ®ç®¡ç†</div>
                    <div class="section-toggle">â–¼</div>
                </div>
                <div class="section-content">
                    <div style="padding: 15px; text-align: center;">
                        <button class="control-btn" onclick="refreshData()" style="margin-bottom: 10px; width: 100%;">
                            ğŸ”„ å¼ºåˆ¶åˆ·æ–°æ•°æ®
                        </button>
                        <button class="control-btn" onclick="exportData()" style="margin-bottom: 10px; width: 100%;">
                            ğŸ“¤ å¯¼å‡ºå½“å‰æ•°æ®
                        </button>
                        <button class="control-btn" onclick="monthlySettlement()" style="margin-bottom: 10px; width: 100%;">
                            ğŸ“… æ‰§è¡Œæœˆåº¦ç»“ç®—
                        </button>
                        <button class="control-btn" onclick="clearData()" style="margin-bottom: 10px; width: 100%; background: #dc3545;">
                            ğŸ—‘ï¸ æ¸…é™¤æœ¬åœ°æ•°æ®
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨ä¿¡æ¯ -->
        <div class="footer">
            é¢†åœ°ç»è¥ç³»ç»Ÿ v3.0 | MVUå˜é‡é©±åŠ¨ | 
            <span onclick="refreshData()" style="color: #8B6914; cursor: pointer; text-decoration: underline;">
                ç‚¹å‡»åˆ·æ–°æ•°æ®
            </span>
        </div>
    </div>

    <script>
        // é¢†åœ°æ•°æ®å­˜å‚¨
        let territoryData = null;
        // æ™¨æŠ¥ç³»ç»Ÿå˜é‡
        let morningReportUnread = false;
        let currentShareReport = null; // å½“å‰æ­£åœ¨åˆ†äº«çš„æ™¨æŠ¥
        let lastUpdate = null;
        let autoRefreshEnabled = false;
        let autoRefreshInterval = null;
        let debugMode = false;
        
        // ç»Ÿä¸€çš„æ•°æ®æå–å‡½æ•°
        function extractMVUValue(data) {
            if (data === undefined || data === null) return null;
            
            // å¦‚æœæ˜¯æ•°ç»„ï¼Œæ£€æŸ¥æ ¼å¼
            if (Array.isArray(data)) {
                // MVUå¸¸è§æ ¼å¼ï¼š[å€¼, æè¿°] æˆ– [å€¼]
                if (data.length >= 1) {
                    // é€’å½’å¤„ç†æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
                    return extractMVUValue(data[0]);
                }
                return null;
            }
            
            // å¦‚æœæ˜¯å¯¹è±¡ï¼Œæ£€æŸ¥å¸¸è§å±æ€§
            if (typeof data === 'object') {
                // å°è¯•è·å–å¸¸è§çš„æ•°å€¼å±æ€§
                if (data.value !== undefined) return data.value;
                if (data.å€¼ !== undefined) return data.å€¼;
                if (data.æ•°é‡ !== undefined) return data.æ•°é‡;
                if (data.count !== undefined) return data.count;
                if (data.Value !== undefined) return data.Value;
                
                // å¦‚æœå¯¹è±¡åªæœ‰ä¸€ä¸ªé”®å€¼å¯¹ï¼Œä¸”å€¼æ˜¯æ•°å­—ï¼Œè¿”å›è¯¥å€¼
                const keys = Object.keys(data);
                if (keys.length === 1) {
                    const value = data[keys[0]];
                    if (typeof value === 'number' || !isNaN(parseFloat(value))) {
                        return parseFloat(value);
                    }
                }
                
                // å…¶ä»–æƒ…å†µè¿”å›åŸå¯¹è±¡
                return data;
            }
            
            // å¦‚æœæ˜¯æ•°å­—æˆ–å¯ä»¥è½¬æ¢ä¸ºæ•°å­—çš„å­—ç¬¦ä¸²
            if (typeof data === 'number') return data;
            if (typeof data === 'string' && !isNaN(parseFloat(data))) {
                return parseFloat(data);
            }
            
            // å…¶ä»–æƒ…å†µè¿”å›åŸå€¼
            return data;
        }
        
        // æ”¹è¿›çš„æ•°æ®è½¬æ¢å‡½æ•°
        function convertMVUData(data, path = '') {
            if (!data || typeof data !== 'object') {
                return data;
            }
            
            // å¤„ç†æ•°ç»„
            if (Array.isArray(data)) {
                // æ£€æŸ¥æ˜¯å¦æ˜¯ [å€¼, æè¿°] æ ¼å¼
                if (data.length === 2 && typeof data[1] === 'string') {
                    return data[0];
                }
                // å¤„ç†æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ 
                const result = [];
                for (let i = 0; i < data.length; i++) {
                    result.push(convertMVUData(data[i], `${path}[${i}]`));
                }
                return result;
            }
            
            // å¤„ç†å¯¹è±¡
            const result = {};
            
            for (const [key, value] of Object.entries(data)) {
                // è·³è¿‡$metaå±æ€§
                if (key === '$meta') continue;
                
                const currentPath = path ? `${path}.${key}` : key;
                
                if (value === null || value === undefined) {
                    result[key] = value;
                } else if (Array.isArray(value)) {
                    // å¤„ç†æ•°ç»„
                    result[key] = convertMVUData(value, currentPath);
                } else if (typeof value === 'object') {
                    // å¤„ç†åµŒå¥—å¯¹è±¡
                    result[key] = convertMVUData(value, currentPath);
                } else {
                    // åŸºæœ¬ç±»å‹ç›´æ¥èµ‹å€¼
                    result[key] = value;
                }
            }
            
            return result;
        }
        
        // ä»MVUè·å–æ•°æ®
        async function fetchFromMVU() {
            try {
                showLoading(true);
                
                let mvuData = null;
                
                // æ–¹æ³•1ï¼šä½¿ç”¨getVariables
                if (typeof getVariables === 'function') {
                    try {
                        mvuData = getVariables({
                            type: 'message',
                            message_id: getCurrentMessageId?.() || 'current'
                        });
                    } catch (e) {
                        console.error('getVariables é”™è¯¯:', e);
                    }
                }
                
                // æ–¹æ³•2ï¼šå°è¯•window.getVariables
                if (!mvuData && typeof window.getVariables === 'function') {
                    try {
                        mvuData = await window.getVariables({
                            type: 'message',
                            message_id: window.getCurrentMessageId?.() || 'current'
                        });
                    } catch (e) {
                        console.error('window.getVariables é”™è¯¯:', e);
                    }
                }
                
                // å¤„ç†è·å–åˆ°çš„æ•°æ®
                if (mvuData) {
                    // ä»stat_dataä¸­æå–Territoryæ•°æ®
                    if (mvuData.stat_data) {
                        if (mvuData.stat_data.Territory) {
                            // å¯¹æ•°æ®è¿›è¡Œè½¬æ¢
                            territoryData = convertMVUData(mvuData.stat_data.Territory, 'Territory');
                        } else {
                            territoryData = convertMVUData(mvuData.stat_data, 'stat_data');
                        }
                    } else if (mvuData.Territory) {
                        // ç›´æ¥å¤„ç†Territoryæ•°æ®
                        territoryData = convertMVUData(mvuData.Territory, 'Territory');
                    } else {
                        territoryData = getDefaultData();
                    }
                } else {
                    const storedData = localStorage.getItem('territoryData');
                    if (storedData) {
                        territoryData = JSON.parse(storedData);
                    } else {
                        territoryData = getDefaultData();
                    }
                }
                
                // éªŒè¯æ•°æ®
                if (!territoryData || !territoryData.äººå£) {
                    territoryData = getDefaultData();
                }
                
                // æ·»åŠ ç¤ºä¾‹è§’è‰²æ•°æ®ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                if (!territoryData.è§’è‰²) {
                    territoryData.è§’è‰² = getExampleCharacters();
                }
                
                lastUpdate = new Date();
                document.getElementById('last-update').textContent = lastUpdate.toLocaleTimeString();
                
                // æ›´æ–°é¢†ä¸»åå­—
                if (territoryData.Lord && territoryData.Lord.å§“å) {
                    document.getElementById('lord-name').textContent = extractMVUValue(territoryData.Lord.å§“å) || 'é¢†ä¸»';
                }
                
                updateUI();
                localStorage.setItem('territoryData', JSON.stringify(territoryData));
                
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
                territoryData = getDefaultData();
                updateUI();
            } finally {
                showLoading(false);
                adjustIframeHeight();
            }
        }
        
        // è·å–é»˜è®¤æ•°æ®
        function getDefaultData() {
            return {
                åŸºæœ¬ä¿¡æ¯: {
                    åç§°: ["åŒ—å¢ƒè¾¹å¢ƒé¢†", "é¢†åœ°å"],
                    é¢ç§¯: [85, "å¹³æ–¹é‡Œ"],
                    åœ°å½¢: ["ä¸˜é™µä¸æ£®æ—", "ä¸»è¦åœ°å½¢ç‰¹å¾"],
                    å‘å±•é˜¶æ®µ: ["åˆå»º", "æ®ç‚¹/é¢†é•‡/é¢†åŸ/é‚¦åŸŸ/ç‹é¢†/å¸éƒ½"]
                },
                äººå£: {
                    æ€»äººå£: [1250, "æ€»äººå£æ•°"],
                    ç§æ—æ„æˆ: {
                        äººç±»: {
                            æ•°é‡: [900, "äººå£æ•°"],
                            åœ°ä½: ["ä¸»å¯¼", "ä¸»å¯¼ç§æ—ï¼ŒæŒæ¡æ”¿æ²»ç»æµæƒåŠ›"],
                            ç‰¹æ®Šèƒ½åŠ›: ["é€‚åº”æ€§å¼ºï¼Œå­¦ä¹ èƒ½åŠ›å¿«", "èƒ½åŠ›æè¿°"],
                            å¿ è¯šåº¦: {
                                æ•°å€¼: [70, "å¯¹é¢†ä¸»ç»Ÿæ²»çš„å¿ è¯šåº¦"],
                                çŠ¶æ€: ["å¿ è¯š", "å›ç¦»/æŠ—æ‹’/é¡ºä»/å¿ è¯š/ç‹‚çƒ­"]
                            }
                        },
                        çŸ®äºº: {
                            æ•°é‡: [150, "äººå£æ•°"],
                            åœ°ä½: ["å¹³ç­‰", "äº«æœ‰å¹³ç­‰æƒåˆ©çš„æ‰‹å·¥ä¸šè€…"],
                            ç‰¹æ®Šèƒ½åŠ›: ["åœ°ä¸‹è§†è§‰ï¼Œé”»é€ ä¸çŸ³å·¥ä¸“ç²¾", "çŸ®äººä¼ ç»ŸæŠ€è‰º"],
                            å¿ è¯šåº¦: {
                                æ•°å€¼: [65, "å¯¹é¢†ä¸»ç»Ÿæ²»çš„å¿ è¯šåº¦"],
                                çŠ¶æ€: ["é¡ºä»", "å›ç¦»/æŠ—æ‹’/é¡ºä»/å¿ è¯š/ç‹‚çƒ­"]
                            }
                        },
                        åŠç²¾çµ: {
                            æ•°é‡: [100, "äººå£æ•°"],
                            åœ°ä½: ["å¹³ç­‰", "äº«æœ‰å¹³ç­‰æƒåˆ©ï¼Œä½†ç¤¾ä¼šèåˆåº¦è¾ƒä½"],
                            ç‰¹æ®Šèƒ½åŠ›: ["è‡ªç„¶äº²å’Œï¼Œå¼“ç®­ä¸è¿½è¸ªä¸“ç²¾", "ç²¾çµè¡€ç»Ÿå¸¦æ¥çš„å¤©èµ‹"],
                            å¿ è¯šåº¦: {
                                æ•°å€¼: [65, "å¯¹é¢†ä¸»ç»Ÿæ²»çš„å¿ è¯šåº¦"],
                                çŠ¶æ€: ["é¡ºä»", "å›ç¦»/æŠ—æ‹’/é¡ºä»/å¿ è¯š/ç‹‚çƒ­"]
                            }
                        },
                        å“¥å¸ƒæ—: {
                            æ•°é‡: [50, "äººå£æ•°"],
                            åœ°ä½: ["å¥´éš¶", "æˆ˜ä¿˜æˆ–å¥´å½¹ï¼Œæ— å…¬æ°‘æƒåˆ©"],
                            ç‰¹æ®Šèƒ½åŠ›: ["å¤œè§†ï¼Œæ•æ·ï¼Œå°å‹å·¥ç¨‹", "é€‚åˆåœ°ä¸‹å’Œå¤œé—´å·¥ä½œ"],
                            å¿ è¯šåº¦: {
                                æ•°å€¼: [65, "å¯¹é¢†ä¸»ç»Ÿæ²»çš„å¿ è¯šåº¦"],
                                çŠ¶æ€: ["é¡ºä»", "å›ç¦»/æŠ—æ‹’/é¡ºä»/å¿ è¯š/ç‹‚çƒ­"]
                            }
                        },
                        å…½äºº: {
                            æ•°é‡: [30, "äººå£æ•°"],
                            åœ°ä½: ["å—é™åˆ¶", "å…è®¸å±…ä½ä½†é™åˆ¶æ´»åŠ¨ï¼Œéœ€ç‰¹åˆ«è®¸å¯"],
                            ç‰¹æ®Šèƒ½åŠ›: ["åŠ›é‡å¼ºå¤§ï¼Œè€åŠ›è¶…å¸¸", "é€‚åˆé‡ä½“åŠ›åŠ³åŠ¨å’Œæˆ˜æ–—"],
                            å¿ è¯šåº¦: {
                                æ•°å€¼: [65, "å¯¹é¢†ä¸»ç»Ÿæ²»çš„å¿ è¯šåº¦"],
                                çŠ¶æ€: ["é¡ºä»", "å›ç¦»/æŠ—æ‹’/é¡ºä»/å¿ è¯š/ç‹‚çƒ­"]
                            }
                        }
                    },
                    å¹´é¾„ç»“æ„: {
                        å„¿ç«¥_0_14: [250, "äººæ•°"],
                        é’å¹´_15_35: [600, "äººæ•°"],
                        ä¸­å¹´_36_60: [300, "äººæ•°"],
                        è€å¹´_60_: [100, "äººæ•°"]
                    },
                    èŒä¸šåˆ†å¸ƒ: {
                        å†œæ°‘: {
                            äººæ•°: [700, "å†œä¸šäººå£"],
                            æœˆè´¡çŒ®: [15, "äººå‡æœˆå†œä¸šäº§å‡ºä»·å€¼"],
                            å¹³å‡è–ªèµ„: [2, "é‡‘å¸/æœˆ"],
                            æ»¡æ„åº¦: [65, "0-100"]
                        },
                        å·¥åŒ : {
                            äººæ•°: [120, "æ‰‹å·¥ä¸šè€…"],
                            æœˆè´¡çŒ®: [25, "äººå‡æœˆæ‰‹å·¥ä¸šäº§å€¼"],
                            å¹³å‡è–ªèµ„: [5, "é‡‘å¸/æœˆ"],
                            æ»¡æ„åº¦: [70, "0-100"]
                        },
                        å•†äºº: {
                            äººæ•°: [60, "å•†ä¸šäººå£"],
                            æœˆè´¡çŒ®: [30, "äººå‡æœˆå•†ä¸šäº¤æ˜“é¢"],
                            å¹³å‡è–ªèµ„: [8, "é‡‘å¸/æœˆ"],
                            æ»¡æ„åº¦: [75, "0-100"]
                        },
                        å®˜å‘˜: {
                            äººæ•°: [15, "è¡Œæ”¿ç®¡ç†äººå‘˜"],
                            æœˆè´¡çŒ®: [-10, "äººå‡æœˆä¿¸ç¦„æ”¯å‡º"],
                            å¹³å‡è–ªèµ„: [10, "é‡‘å¸/æœˆ"],
                            æ»¡æ„åº¦: [80, "0-100"]
                        },
                        å£«å…µ: {
                            äººæ•°: [80, "å¸¸å¤‡å†›"],
                            æœˆè´¡çŒ®: [-20, "äººå‡æœˆå†›é¥·æ”¯å‡º"],
                            å¹³å‡è–ªèµ„: [6, "é‡‘å¸/æœˆ"],
                            æ»¡æ„åº¦: [70, "0-100"]
                        },
                        å­¦è€…: {
                            äººæ•°: [10, "å­¦è€…ã€æ•™å¸ˆç­‰"],
                            æœˆè´¡çŒ®: [5, "äººå‡æœˆæ–‡åŒ–äº§å€¼"],
                            å¹³å‡è–ªèµ„: [7, "é‡‘å¸/æœˆ"],
                            æ»¡æ„åº¦: [85, "0-100"]
                        },
                        æ— ä¸š: {
                            äººæ•°: [265, "æ— å›ºå®šèŒä¸šè€…"],
                            æœˆè´¡çŒ®: [0, "æ— ç»æµè´¡çŒ®"],
                            å¹³å‡è–ªèµ„: [0, "é‡‘å¸/æœˆ"],
                            æ»¡æ„åº¦: [40, "0-100"]
                        }
                    },
                    æ»¡æ„åº¦ç»´åº¦: {
                        é£Ÿç‰©æ»¡æ„åº¦: [70, "0-100"],
                        ä½æˆ¿æ»¡æ„åº¦: [60, "0-100"],
                        å®‰å…¨æ»¡æ„åº¦: [65, "0-100"],
                        å¨±ä¹æ»¡æ„åº¦: [50, "0-100"],
                        ç¨æ”¶æ»¡æ„åº¦: [55, "0-100"],
                        å·¥ä½œæ»¡æ„åº¦: [65, "0-100"],
                        æ•™è‚²æ»¡æ„åº¦: [40, "0-100"],
                        åŒ»ç–—æ»¡æ„åº¦: [45, "0-100"]
                    },
                    äººå£å¢é•¿ç‡: [0.008, "æ¯æœˆè‡ªç„¶å¢é•¿ç‡"]
                },
                ç»æµ: {
                    è´¢æ”¿: {
                        åº“å­˜é‡‘å¸: [2500, "å½“å‰å›½åº“èµ„é‡‘"],
                        é¢†ä¸»èµ„äº§_æœˆæ”¶å…¥: [0, "é¢†ä¸»æ‰€æœ‰èµ„äº§äº§ç”Ÿçš„æœˆæ”¶å…¥(è‡ªåŠ¨è®¡ç®—)"],
                        é¢†ä¸»èµ„äº§_æœˆæ”¯å‡º: [0, "é¢†ä¸»æ‰€æœ‰èµ„äº§çš„æœˆæ”¯å‡º(è‡ªåŠ¨è®¡ç®—)"],
                        ç§æœ‰èµ„äº§_åº”ç¨æ”¶å…¥: [0, "ç§æœ‰èµ„äº§äº§ç”Ÿçš„åº”ç¨æ”¶å…¥(è‡ªåŠ¨è®¡ç®—)"],
                        ç§æœ‰èµ„äº§ç¨ç‡: [0.15, "å¯¹ç§æœ‰èµ„äº§å¾æ”¶çš„ç¨ç‡(0-1)"],
                        ç§æœ‰èµ„äº§_ç¨æ”¶: [0, "ä»ç§æœ‰èµ„äº§å¾æ”¶çš„ç¨æ”¶(è‡ªåŠ¨è®¡ç®—)"],
                        ç‰¹æ®Šæ”¶æ”¯: [0, "æ¥è‡ªæ³•ä»¤ã€äº‹ä»¶ç­‰çš„ç‰¹æ®Šæ”¶æ”¯"],
                        æœˆæ€»æ”¶å…¥: [0, "æœˆæ€»æ”¶å…¥ = é¢†ä¸»èµ„äº§æ”¶å…¥ + ç§æœ‰èµ„äº§ç¨æ”¶ + ç‰¹æ®Šæ”¶æ”¯(è‡ªåŠ¨è®¡ç®—)"],
                        æœˆæ€»æ”¯å‡º: [0, "æœˆæ€»æ”¯å‡º = é¢†ä¸»èµ„äº§æ”¯å‡º + ç‰¹æ®Šæ”¯å‡º(è‡ªåŠ¨è®¡ç®—)"],
                        æœˆå‡€æ”¶å…¥: [0, "æœˆå‡€æ”¶å…¥ = æ€»æ”¶å…¥ - æ€»æ”¯å‡º(è‡ªåŠ¨è®¡ç®—)"],
                        æ”¶æ”¯çŠ¶æ€: ["", "ğŸ“ˆç›ˆä½™/ğŸ“‰äºæŸ/âš–ï¸å¹³è¡¡"]
                    },
                    å…¬å…±ç¨ç‡: {
                        å†œä¸šç¨: [0.10, "å†œä¸šç¨ç‡(0-1)"],
                        å•†ä¸šç¨: [0.15, "å•†ä¸šç¨ç‡(0-1)"],
                        å·¥ä¸šç¨: [0.12, "æ‰‹å·¥ä¸šç¨ç‡(0-1)"],
                        ä¸ªäººæ‰€å¾—ç¨: [0.05, "å¹³æ°‘æ‰€å¾—ç¨ç‡(0-1)"]
                    },
                    ç‰©ä»·æŒ‡æ•°: {
                        ç²®é£Ÿå•ä»·: [0.4, "æ¯æ‹…ç²®é£Ÿä»·æ ¼(é‡‘å¸)"],
                        æœ¨æå•ä»·: [1.8, "æ¯æ–¹æœ¨æä»·æ ¼(é‡‘å¸)"],
                        çŸ³æå•ä»·: [2.5, "æ¯æ–¹çŸ³æä»·æ ¼(é‡‘å¸)"],
                        é“çŸ¿å•ä»·: [3.0, "æ¯æ–¤é“çŸ¿çŸ³ä»·æ ¼(é‡‘å¸)"],
                        æ­¦å™¨å•ä»·: [15, "æ¯æŠŠåŸºç¡€æ­¦å™¨ä»·æ ¼(é‡‘å¸)"],
                        å·¥å…·å•ä»·: [8, "æ¯ä»¶åŸºç¡€å·¥å…·ä»·æ ¼(é‡‘å¸)"]
                    }
                },
                ä»“åº“: {
                    res_food_grain: {
                        id: ["res_food_grain", "ID"],
                        åç§°: ["ç²®é£Ÿ", "å"],
                        ç±»åˆ«: ["é£Ÿç‰©", "ç±»"],
                        å½“å‰å‚¨é‡: [6500, "é‡"],
                        å•ä½: ["æ‹…", "å•ä½"],
                        å®‰å…¨å‚¨é‡: [3750, "3ä¸ªæœˆå£ç²®"],
                        å¸‚åœºä»·æ ¼: [0.4, "é‡‘å¸/æ‹…"],
                        æè¿°: ["åŸºç¡€è°·ç‰©ï¼Œé¢†åœ°ç”Ÿå­˜ä¹‹æœ¬ã€‚", "è¿°"]
                    },
                    res_material_wood: {
                        id: ["res_material_wood", "ID"],
                        åç§°: ["æœ¨æ", "å"],
                        ç±»åˆ«: ["ææ–™", "ç±»"],
                        å½“å‰å‚¨é‡: [900, "é‡"],
                        å•ä½: ["æ–¹", "å•ä½"],
                        å®‰å…¨å‚¨é‡: [300, "åŸºç¡€å»ºè®¾å‚¨å¤‡"],
                        å¸‚åœºä»·æ ¼: [1.8, "é‡‘å¸/æ–¹"],
                        æè¿°: ["ç”¨äºå»ºç­‘ã€å·¥å…·å’Œç‡ƒæ–™ã€‚", "è¿°"]
                    },
                    res_material_stone: {
                        id: ["res_material_stone", "ID"],
                        åç§°: ["çŸ³æ", "å"],
                        ç±»åˆ«: ["ææ–™", "ç±»"],
                        å½“å‰å‚¨é‡: [500, "é‡"],
                        å•ä½: ["æ–¹", "å•ä½"],
                        å®‰å…¨å‚¨é‡: [200, "é˜²å¾¡å·¥äº‹å‚¨å¤‡"],
                        å¸‚åœºä»·æ ¼: [2.5, "é‡‘å¸/æ–¹"],
                        æè¿°: ["ç”¨äºå»ºç­‘å’ŒåŸå¢™ã€‚", "è¿°"]
                    },
                    res_material_iron: {
                        id: ["res_material_iron", "ID"],
                        åç§°: ["é“çŸ¿", "å"],
                        ç±»åˆ«: ["ææ–™", "ç±»"],
                        å½“å‰å‚¨é‡: [300, "é‡"],
                        å•ä½: ["æ–¤", "å•ä½"],
                        å®‰å…¨å‚¨é‡: [100, "æ­¦å™¨è£…å¤‡å‚¨å¤‡"],
                        å¸‚åœºä»·æ ¼: [3.0, "é‡‘å¸/æ–¤"],
                        æè¿°: ["ç”¨äºé”»é€ æ­¦å™¨å’Œå·¥å…·ã€‚", "è¿°"]
                    },
                    item_weapon_spear: {
                        id: ["item_weapon_spear", "ID"],
                        åç§°: ["é•¿çŸ›", "å"],
                        ç±»åˆ«: ["æ­¦å™¨", "ç±»"],
                        å½“å‰å‚¨é‡: [30, "é‡"],
                        å•ä½: ["æŠŠ", "å•ä½"],
                        å®‰å…¨å‚¨é‡: [50, "åŸºç¡€æ­¦è£…å‚¨å¤‡"],
                        å¸‚åœºä»·æ ¼: [12, "é‡‘å¸/æŠŠ"],
                        æè¿°: ["æ ‡å‡†æ­¥å…µæ­¦å™¨ï¼Œæ˜“äºç”Ÿäº§ã€‚", "è¿°"]
                    },
                    item_tool_hammer: {
                        id: ["item_tool_hammer", "ID"],
                        åç§°: ["é“é”¤", "å"],
                        ç±»åˆ«: ["å·¥å…·", "ç±»"],
                        å½“å‰å‚¨é‡: [40, "é‡"],
                        å•ä½: ["æŠŠ", "å•ä½"],
                        å®‰å…¨å‚¨é‡: [30, "åŸºç¡€å·¥å…·å‚¨å¤‡"],
                        å¸‚åœºä»·æ ¼: [8, "é‡‘å¸/æŠŠ"],
                        æè¿°: ["åŸºç¡€å·¥å…·ï¼Œç”¨äºå»ºè®¾å’Œç»´ä¿®ã€‚", "è¿°"]
                    }
                },
                å»ºç­‘: {
                    building_blacksmith: {
                        id: ["building_blacksmith", "ID"],
                        åç§°: ["é“é”¤ä¸ç §é“åŒ é“º", "å"],
                        ç±»å‹: ["ç”Ÿäº§", "ç±»"],
                        äº§æƒ: ["private", "ç§æœ‰"],
                        ä½ç½®: ["C4", "åœ°å›¾åæ ‡ï¼šC4"],
                        ç­‰çº§: [2, "çº§"],
                        çŠ¶æ€: ["æ­£å¸¸è¿è¥", "æ€"],
                        äººå‘˜é…ç½®: {
                            ç®¡ç†è€…: {
                                å½“å‰äººæ•°: [1, "é“åŒ å¤§å¸ˆæœå°”é‡‘"],
                                æœ€å¤§äººæ•°: [1, ""],
                                æœˆè–ª: [20, "é‡‘å¸/æœˆ"]
                            },
                            å·¥åŒ : {
                                å½“å‰äººæ•°: [3, "ç†Ÿç»ƒé“åŒ "],
                                æœ€å¤§äººæ•°: [4, ""],
                                æœˆè–ª: [10, "é‡‘å¸/æœˆ"]
                            },
                            å·¥äºº: {
                                å½“å‰äººæ•°: [1, "åŠ©æ‰‹"],
                                æœ€å¤§äººæ•°: [2, ""],
                                æœˆè–ª: [5, "é‡‘å¸/æœˆ"]
                            },
                            å­¦å¾’: {
                                å½“å‰äººæ•°: [2, "å­¦å¾’"],
                                æœ€å¤§äººæ•°: [4, ""],
                                æœˆè–ª: [3, "é‡‘å¸/æœˆ"]
                            },
                            å®ˆå«: {
                                å½“å‰äººæ•°: [0, "æ— "],
                                æœ€å¤§äººæ•°: [0, ""],
                                æœˆè–ª: [6, "é‡‘å¸/æœˆ"]
                            },
                            æ€»å½“å‰äººæ•°: [7, "1+3+1+2"],
                            æ€»æœ€å¤§äººæ•°: [11, "1+4+2+4"],
                            æ€»æœˆè–ª: [61, "1Ã—20 + 3Ã—10 + 1Ã—5 + 2Ã—3"],
                            ç©ºé—²å²—ä½: [4, "å¯å†é›‡ä½£4äºº"]
                        },
                        ç»æµæ¨¡å‹: {
                            é€šç”¨è´¢åŠ¡: {
                                ç»´æŠ¤è´¹: [20, "æ¯æœˆåŸºç¡€ç»´æŠ¤è´¹ç”¨"],
                                æœˆæ€»æ”¯å‡º: [81, "ç»´æŠ¤è´¹20 + äººå‘˜æ€»æœˆè–ª61"]
                            },
                            ç”Ÿäº§æ•ˆç‡: [1.0, "å½“å‰ç”Ÿäº§æ•ˆç‡ç³»æ•°"],
                            ç”Ÿäº§å‹: {
                                é€‚ç”¨: [true, "æ˜¯ç”Ÿäº§å‹å»ºç­‘"],
                                åŸææ–™æ¶ˆè€—: {
                                    res_material_iron: [60, "æ¯æœˆæ¶ˆè€—é“çŸ¿æ–¤æ•°"],
                                    res_material_wood: [30, "æ¯æœˆæ¶ˆè€—æœ¨ææ–¹æ•°"]
                                },
                                äº§å“äº§å‡º: {
                                    item_weapon_spear: [12, "æ¯æœˆç”Ÿäº§é•¿çŸ›æ•°é‡"],
                                    item_tool_hammer: [25, "æ¯æœˆç”Ÿäº§é“é”¤æ•°é‡"]
                                },
                                åŸææ–™æˆæœ¬: [0, "å¾…è®¡ç®—"],
                                äº§å“ä»·å€¼: [0, "å¾…è®¡ç®—"],
                                æœˆæ¯›æ”¶å…¥: [0, "å¾…è®¡ç®—"]
                            },
                            è´¢åŠ¡æ±‡æ€»: {
                                æœˆæ¯›æ”¶å…¥: [0, "å¾…è®¡ç®—"],
                                æœˆæ€»æ”¯å‡º: [81, "ç»§æ‰¿"],
                                æœˆå‡€æ”¶ç›Š: [0, "å¾…è®¡ç®—"],
                                æ”¶æ”¯çŠ¶æ€: ["", "å¾…è®¡ç®—"]
                            }
                        },
                        å‡çº§: {
                            å¯å‡çº§: [true, "å¯å‡åˆ°3çº§"],
                            å½“å‰çŠ¶æ€: ["æ— ", "æ— å‡çº§è®¡åˆ’"],
                            ç›®æ ‡ç­‰çº§: [3, "è®¡åˆ’å‡çº§åˆ°3çº§"],
                            å®Œæˆæ—¶é—´: ["", ""],
                            éœ€æ±‚: {
                                é‡‘å¸: [500, "æ‰€éœ€é‡‘å¸"],
                                ææ–™: {
                                    æœ¨æ: [50, "æ–¹"],
                                    çŸ³æ: [100, "æ–¹"],
                                    é“çŸ¿: [80, "æ–¤"]
                                },
                                æ—¶é—´: [30, "æ‰€éœ€å¤©æ•°"]
                            },
                            æ•ˆæœ: {
                                ç­‰çº§æå‡è‡³: [3, "å‡çº§åçš„ç­‰çº§"],
                                äººå‘˜ä¸Šé™å¢åŠ : {
                                    ç®¡ç†è€…: [0, "å¢åŠ çš„ç®¡ç†è€…æœ€å¤§äººæ•°"],
                                    å·¥åŒ : [2, "å¢åŠ çš„å·¥åŒ æœ€å¤§äººæ•°"],
                                    å·¥äºº: [1, "å¢åŠ çš„å·¥äººæœ€å¤§äººæ•°"],
                                    å­¦å¾’: [2, "å¢åŠ çš„å­¦å¾’æœ€å¤§äººæ•°"],
                                    å®ˆå«: [0, "å¢åŠ çš„å®ˆå«æœ€å¤§äººæ•°"]
                                },
                                ç»æµæ•ˆæœ: {
                                    åŸºç¡€æ”¶å…¥å¢åŠ : [20, "é‡‘å¸"],
                                    ç»´æŠ¤è´¹å¢åŠ : [10, "é‡‘å¸"],
                                    ç”Ÿäº§æ•ˆç‡æå‡: [0.15, "ç³»æ•°å¢åŠ å€¼"]
                                },
                                æ–°åŠŸèƒ½è§£é”: ["å¯ç”Ÿäº§æ¿ç”²å’Œé”å­ç”²", ""]
                            },
                            æ•ˆæœå·²åº”ç”¨: [false, "å‡çº§æ•ˆæœæœªåº”ç”¨"]
                        },
                        å¤–è§‚æè¿°: ["çŸ³ç ŒçŸ®æˆ¿ï¼ŒçƒŸå›±å†’çƒŸï¼Œé”¤å‡»å£°ä¸æ–­", "è¿°"],
                        å½“å‰çŠ¶å†µ: ["è®¢å•å……è¶³ï¼Œä½†é“é”­ä¾›åº”ä¸ç¨³å®š", "å†µ"],
                        ç‰¹æ®Šäº‹ä»¶: ["æœå°”é‡‘è¯·æ±‚ç¨³å®šé“çŸ¿ä¾›åº”", "äº‹ä»¶"]
                    },
                    building_market: {
                        id: ["building_market", "ID"],
                        åç§°: ["é•‡å¹¿åœºå¸‚é›†", "å"],
                        ç±»å‹: ["å•†ä¸š", "ç±»"],
                        äº§æƒ: ["lord", "é¢†ä¸»æ‰€æœ‰"],
                        ä½ç½®: ["B3", "åœ°å›¾åæ ‡ï¼šB3"],
                        ç­‰çº§: [2, "çº§"],
                        çŠ¶æ€: ["æ­£å¸¸è¿è¥", "æ€"],
                        äººå‘˜é…ç½®: {
                            ç®¡ç†è€…: {
                                å½“å‰äººæ•°: [1, "å¸‚åœºç®¡ç†å‘˜è€æ±¤å§†"],
                                æœ€å¤§äººæ•°: [1, ""],
                                æœˆè–ª: [12, "é‡‘å¸/æœˆ"]
                            },
                            å·¥åŒ : {
                                å½“å‰äººæ•°: [0, "æ— "],
                                æœ€å¤§äººæ•°: [0, ""],
                                æœˆè–ª: [8, "é‡‘å¸/æœˆ"]
                            },
                            å·¥äºº: {
                                å½“å‰äººæ•°: [1, "æ¸…æ´å·¥"],
                                æœ€å¤§äººæ•°: [2, ""],
                                æœˆè–ª: [4, "é‡‘å¸/æœˆ"]
                            },
                            å­¦å¾’: {
                                å½“å‰äººæ•°: [2, "å¸‚åœºåŠ©æ‰‹"],
                                æœ€å¤§äººæ•°: [4, ""],
                                æœˆè–ª: [2, "é‡‘å¸/æœˆ"]
                            },
                            å®ˆå«: {
                                å½“å‰äººæ•°: [4, "å¸‚åœºå®ˆå«"],
                                æœ€å¤§äººæ•°: [6, ""],
                                æœˆè–ª: [6, "é‡‘å¸/æœˆ"]
                            },
                            æ€»å½“å‰äººæ•°: [8, "1+0+1+2+4"],
                            æ€»æœ€å¤§äººæ•°: [13, "1+0+2+4+6"],
                            æ€»æœˆè–ª: [44, "1Ã—12 + 1Ã—4 + 2Ã—2 + 4Ã—6"],
                            ç©ºé—²å²—ä½: [5, "å¯å†é›‡ä½£5äºº"]
                        },
                        ç»æµæ¨¡å‹: {
                            é€šç”¨è´¢åŠ¡: {
                                ç»´æŠ¤è´¹: [15, "æ¯æœˆç»´æŠ¤è´¹"],
                                æœˆæ€»æ”¯å‡º: [59, "ç»´æŠ¤è´¹15 + äººå‘˜æ€»æœˆè–ª44"]
                            },
                            ç”Ÿäº§æ•ˆç‡: [1.0, "å½“å‰ç”Ÿäº§æ•ˆç‡ç³»æ•°"],
                            å•†ä¸šå‹: {
                                é€‚ç”¨: [true, "æ˜¯å•†ä¸šå‹å»ºç­‘"],
                                äº¤æ˜“ç±»å‹: ["é›¶å”®ä¸æœåŠ¡", "ç±»å‹"],
                                æœˆäº¤æ˜“é¢: [600, "æ¯æœˆæ€»äº¤æ˜“é¢"],
                                åˆ©æ¶¦ç‡: [0.25, "åˆ©æ¶¦ç‡"],
                                æœˆæ¯›æ”¶å…¥: [150, "è‡ªåŠ¨è®¡ç®—ï¼š600Ã—0.25"]
                            },
                            è´¢åŠ¡æ±‡æ€»: {
                                æœˆæ¯›æ”¶å…¥: [150, "ç»§æ‰¿"],
                                æœˆæ€»æ”¯å‡º: [59, "ç»§æ‰¿"],
                                æœˆå‡€æ”¶ç›Š: [91, "è‡ªåŠ¨è®¡ç®—"],
                                æ”¶æ”¯çŠ¶æ€: ["ç›ˆä½™", "çŠ¶æ€"]
                            }
                        },
                        å‡çº§: {
                            å¯å‡çº§: [true, "å¯å‡åˆ°3çº§"],
                            å½“å‰çŠ¶æ€: ["æ— ", "æ— å‡çº§è®¡åˆ’"],
                            ç›®æ ‡ç­‰çº§: [3, "è®¡åˆ’å‡çº§åˆ°3çº§"],
                            å®Œæˆæ—¶é—´: ["", ""],
                            éœ€æ±‚: {
                                é‡‘å¸: [800, "æ‰€éœ€é‡‘å¸"],
                                ææ–™: {
                                    æœ¨æ: [150, "æ–¹"],
                                    çŸ³æ: [100, "æ–¹"],
                                    é“çŸ¿: [30, "æ–¤"]
                                },
                                æ—¶é—´: [45, "æ‰€éœ€å¤©æ•°"]
                            },
                            æ•ˆæœ: {
                                ç­‰çº§æå‡è‡³: [3, "å‡çº§åçš„ç­‰çº§"],
                                äººå‘˜ä¸Šé™å¢åŠ : {
                                    ç®¡ç†è€…: [0, "å¢åŠ çš„ç®¡ç†è€…æœ€å¤§äººæ•°"],
                                    å·¥åŒ : [5, "å¢åŠ çš„å·¥åŒ æœ€å¤§äººæ•°ï¼ˆå•†äººæ‘Šä½ï¼‰"],
                                    å·¥äºº: [2, "å¢åŠ çš„å·¥äººæœ€å¤§äººæ•°"],
                                    å­¦å¾’: [2, "å¢åŠ çš„å­¦å¾’æœ€å¤§äººæ•°"],
                                    å®ˆå«: [2, "å¢åŠ çš„å®ˆå«æœ€å¤§äººæ•°"]
                                },
                                ç»æµæ•ˆæœ: {
                                    åŸºç¡€æ”¶å…¥å¢åŠ : [100, "é‡‘å¸"],
                                    ç»´æŠ¤è´¹å¢åŠ : [20, "é‡‘å¸"],
                                    ç”Ÿäº§æ•ˆç‡æå‡: [0, "å•†ä¸šå»ºç­‘æ— ç”Ÿäº§æ•ˆç‡æ¦‚å¿µ"]
                                },
                                æ–°åŠŸèƒ½è§£é”: ["å¯ä¸¾åŠæœˆåº¦é›†å¸‚ï¼Œå¸å¼•è¿œæ–¹å•†é˜Ÿ", ""]
                            },
                            æ•ˆæœå·²åº”ç”¨: [false, "å‡çº§æ•ˆæœæœªåº”ç”¨"]
                        },
                        å¤–è§‚æè¿°: ["é¹…åµçŸ³å¹¿åœºï¼Œæœ¨åˆ¶æ‘Šä½ï¼Œä¸­å¤®æœ‰è€äº•", "è¿°"],
                        å½“å‰çŠ¶å†µ: ["å‘¨å…­é›†å¸‚çƒ­é—¹ï¼Œå¹³æ—¥å†·æ¸…", "å†µ"],
                        ç‰¹æ®Šäº‹ä»¶: ["ä¼ é—»æœ‰è¿ç¦å“äº¤æ˜“", "äº‹ä»¶"]
                    },
                    building_lord_hall: {
                        id: ["building_lord_hall", "ID"],
                        åç§°: ["ç°çŸ³å ¡å¤§å…", "å"],
                        ç±»å‹: ["è¡Œæ”¿", "ç±»"],
                        äº§æƒ: ["lord", "é¢†ä¸»æ‰€æœ‰"],
                        ä½ç½®: ["A1", "åœ°å›¾åæ ‡ï¼šA1ï¼ˆåŸå ¡ä¸­å¿ƒï¼‰"],
                        ç­‰çº§: [3, "çº§"],
                        çŠ¶æ€: ["æ­£å¸¸è¿è¥", "æ€"],
                        äººå‘˜é…ç½®: {
                            ç®¡ç†è€…: {
                                å½“å‰äººæ•°: [1, "ç®¡å®¶é˜¿å°”å¼—é›·å¾·"],
                                æœ€å¤§äººæ•°: [1, ""],
                                æœˆè–ª: [25, "é‡‘å¸/æœˆ"]
                            },
                            å·¥åŒ : {
                                å½“å‰äººæ•°: [4, "æ–‡ä¹¦å®˜"],
                                æœ€å¤§äººæ•°: [6, ""],
                                æœˆè–ª: [12, "é‡‘å¸/æœˆ"]
                            },
                            å·¥äºº: {
                                å½“å‰äººæ•°: [12, "ä»†äºº"],
                                æœ€å¤§äººæ•°: [15, ""],
                                æœˆè–ª: [5, "é‡‘å¸/æœˆ"]
                            },
                            å­¦å¾’: {
                                å½“å‰äººæ•°: [4, "ä¾ä»"],
                                æœ€å¤§äººæ•°: [6, ""],
                                æœˆè–ª: [3, "é‡‘å¸/æœˆ"]
                            },
                            å®ˆå«: {
                                å½“å‰äººæ•°: [8, "å¤§å…å®ˆå«"],
                                æœ€å¤§äººæ•°: [12, ""],
                                æœˆè–ª: [8, "é‡‘å¸/æœˆ"]
                            },
                            æ€»å½“å‰äººæ•°: [29, "1+4+12+4+8"],
                            æ€»æœ€å¤§äººæ•°: [40, "1+6+15+6+12"],
                            æ€»æœˆè–ª: [185, "1Ã—25 + 4Ã—12 + 12Ã—5 + 4Ã—3 + 8Ã—8"],
                            ç©ºé—²å²—ä½: [11, "å¯å†é›‡ä½£11äºº"]
                        },
                        ç»æµæ¨¡å‹: {
                            é€šç”¨è´¢åŠ¡: {
                                ç»´æŠ¤è´¹: [100, "æ¯æœˆç»´æŠ¤è´¹"],
                                æœˆæ€»æ”¯å‡º: [285, "ç»´æŠ¤è´¹100 + äººå‘˜æ€»æœˆè–ª185"]
                            },
                            ç”Ÿäº§æ•ˆç‡: [1.0, "å½“å‰ç”Ÿäº§æ•ˆç‡ç³»æ•°"],
                            æœåŠ¡å‹: {
                                é€‚ç”¨: [true, "æ˜¯æœåŠ¡å‹å»ºç­‘"],
                                æœåŠ¡ç±»å‹: ["è¡Œæ”¿ä¸é˜²å¾¡", "ç±»å‹"],
                                æœˆæœåŠ¡ä»·å€¼: [300, "æä¾›çš„æœåŠ¡ä¼°å€¼"],
                                æœˆæ¯›æ”¶å…¥: [0, "çº¯æ”¯å‡ºï¼Œæ— æ”¶å…¥"]
                            },
                            è´¢åŠ¡æ±‡æ€»: {
                                æœˆæ¯›æ”¶å…¥: [0, "ç»§æ‰¿"],
                                æœˆæ€»æ”¯å‡º: [285, "ç»§æ‰¿"],
                                æœˆå‡€æ”¶ç›Š: [-285, "è‡ªåŠ¨è®¡ç®—"],
                                æ”¶æ”¯çŠ¶æ€: ["äºæŸ", "ä½†æä¾›è¡Œæ”¿æœåŠ¡ä»·å€¼"]
                            }
                        },
                        å‡çº§: {
                            å¯å‡çº§: [true, "å¯æ‰©å»º"],
                            å½“å‰çŠ¶æ€: ["æ— ", "æ— å‡çº§è®¡åˆ’"],
                            ç›®æ ‡ç­‰çº§: [4, "è®¡åˆ’å‡çº§åˆ°4çº§"],
                            å®Œæˆæ—¶é—´: ["", ""],
                            éœ€æ±‚: {
                                é‡‘å¸: [2000, "æ‰€éœ€é‡‘å¸"],
                                ææ–™: {
                                    æœ¨æ: [300, "æ–¹"],
                                    çŸ³æ: [500, "æ–¹"],
                                    é“çŸ¿: [100, "æ–¤"]
                                },
                                æ—¶é—´: [90, "æ‰€éœ€å¤©æ•°"]
                            },
                            æ•ˆæœ: {
                                ç­‰çº§æå‡è‡³: [4, "å‡çº§åçš„ç­‰çº§"],
                                äººå‘˜ä¸Šé™å¢åŠ : {
                                    ç®¡ç†è€…: [0, "å¢åŠ çš„ç®¡ç†è€…æœ€å¤§äººæ•°"],
                                    å·¥åŒ : [2, "å¢åŠ çš„å·¥åŒ æœ€å¤§äººæ•°ï¼ˆå›¾ä¹¦ç®¡ç†å‘˜ç­‰ï¼‰"],
                                    å·¥äºº: [5, "å¢åŠ çš„å·¥äººæœ€å¤§äººæ•°"],
                                    å­¦å¾’: [3, "å¢åŠ çš„å­¦å¾’æœ€å¤§äººæ•°"],
                                    å®ˆå«: [4, "å¢åŠ çš„å®ˆå«æœ€å¤§äººæ•°"]
                                },
                                ç»æµæ•ˆæœ: {
                                    åŸºç¡€æ”¶å…¥å¢åŠ : [0, "é‡‘å¸"],
                                    ç»´æŠ¤è´¹å¢åŠ : [50, "é‡‘å¸"],
                                    ç”Ÿäº§æ•ˆç‡æå‡: [0, "è¡Œæ”¿å»ºç­‘æ— ç”Ÿäº§æ•ˆç‡æ¦‚å¿µ"]
                                },
                                æ–°åŠŸèƒ½è§£é”: ["å¢åŠ å›¾ä¹¦é¦†ã€å®´ä¼šå…ã€å¼ºåŒ–åŸå¢™", ""]
                            },
                            æ•ˆæœå·²åº”ç”¨: [false, "å‡çº§æ•ˆæœæœªåº”ç”¨"]
                        },
                        å¤–è§‚æè¿°: ["åšå›ºçŸ³åˆ¶å¤§å…ï¼Œå…ˆç¥–æ——å¸œï¼Œé¢†ä¸»åº§æ¤…", "è¿°"],
                        å½“å‰çŠ¶å†µ: ["æ­£å¸¸è¿è½¬ï¼Œå¤„ç†é¢†åœ°äº‹åŠ¡", "å†µ"],
                        ç‰¹æ®Šäº‹ä»¶: ["æš‚æ— ", "äº‹ä»¶"]
                    }
                },
                æ³•ä»¤: {
                    decree_basic_tax: {
                        id: ["decree_basic_tax", "ID"],
                        åç§°: ["åŸºç¡€ç¨æ³•", "å"],
                        ç”Ÿæ•ˆçŠ¶æ€: [true, "æ˜¯å¦ç”Ÿæ•ˆ"],
                        ç”Ÿæ•ˆæ—¶é—´: ["ç¬¬1å¹´ 1æœˆ", "ä½•æ—¶ç”Ÿæ•ˆ"],
                        æ³•ä»¤æè¿°: ["é¢†åœ°åŸºç¡€ç¨æ”¶åˆ¶åº¦ï¼Œç»´æŒæ—¥å¸¸è¿è½¬ã€‚", "æ³•ä»¤å†…å®¹å’Œé¢„æœŸæ•ˆæœæè¿°"],
                        ç»æµæ•ˆæœ: {
                            ç¨ç‡ä¿®æ­£: [0, "å¯¹å…¬å…±ç¨ç‡çš„å…¨å±€ä¿®æ­£(+/-ç™¾åˆ†æ¯”)"],
                            ä¸“é¡¹ç¨ç‡: [0, "é’ˆå¯¹ç‰¹å®šè¡Œä¸šçš„ç¨ç‡(å¦‚é…’ç±»ã€å¥¢ä¾ˆå“)"],
                            å›ºå®šæ”¶å…¥: [0, "æ¯æœˆå›ºå®šå¢åŠ çš„æ”¶å…¥(å¦‚è´¡é‡‘ã€è¡¥è´´)"],
                            å›ºå®šæ”¯å‡º: [0, "æ¯æœˆå›ºå®šå¢åŠ çš„æ”¯å‡º(å¦‚æ´¥è´´ã€å¹´é‡‘)"],
                            æ•ˆç‡åŠ æˆ: [0, "å¯¹ç‰¹å®šäº§ä¸šç”Ÿäº§æ•ˆç‡çš„åŠ æˆ"]
                        },
                        ç¤¾ä¼šæ•ˆæœ: {
                            æ°‘å¿ƒå½±å“: [0, "å¯¹æ°‘å¿ƒæŒ‡æ•°çš„æ¯æœˆå½±å“(+/-)"],
                            æ²»å®‰å½±å“: [0, "å¯¹æ²»å®‰çŠ¶å†µçš„æ¯æœˆå½±å“(+/-)"],
                            äººå£å½±å“: [0, "å¯¹äººå£å¢é•¿ç‡çš„ä¿®æ­£(+/-)"]
                        }
                    }
                },
                Lord: {
                    å§“å: ["è‰¾ä¸¹", "é¢†ä¸»å§“å"],
                    æ€§åˆ«: ["ç”·", "ç”·/å¥³/å…¶ä»–"],
                    å¹´é¾„: [28, "é¢†ä¸»å¹´é¾„"],
                    ç§æ—: ["äººç±»", "é¢†ä¸»ç§æ—"],
                    èŒä¸š: ["æˆ˜å£«", "é¢†ä¸»çš„æˆ˜æ–—èŒä¸š"],
                    èº«é«˜: [185, "å˜ç±³"],
                    ä½“é‡: [85, "å…¬æ–¤"],
                    å¤–è²Œ: ["é‡‘å‘è“çœ¼ï¼Œé¢å®¹åˆšæ¯…ï¼Œå³é¢Šæœ‰ä¸€é“ç»†å°çš„ç–¤ç—•", "é¢†ä¸»çš„å¤–è²Œæè¿°"],
                    è¡£ç€: ["é•¶æœ‰å®¶æ—å¾½è®°çš„çš®è´¨æŠ¤ç”²ï¼Œå¤–ç½©æ·±è“è‰²æ–—ç¯·", "é¢†ä¸»å½“å‰çš„è¡£ç€æè¿°"],
                    è£…å¤‡: ["ç²¾é’¢é•¿å‰‘ï¼Œè…°é—´ä½©æˆ´åŒ•é¦–ï¼ŒèƒŒä¸Šæœ‰å¤åˆé•¿å¼“", "é¢†ä¸»å½“å‰çš„è£…å¤‡æè¿°"],
                    èƒŒæ™¯: ["åŒ—å¢ƒè¾¹å¢ƒé¢†çš„å¹´è½»é¢†ä¸»ï¼Œç»§æ‰¿äº†çˆ¶äº²çš„é¢†åœ°ï¼Œå†³å¿ƒä¿å«è¿™ç‰‡åœŸåœ°å¹¶ä½¿å…¶ç¹è£ã€‚", "é¢†ä¸»çš„èƒŒæ™¯æ•…äº‹"],
                    ç§°å·: ["è¾¹å¢ƒå®ˆæŠ¤è€…", "é¢†ä¸»çš„ç§°å·ï¼ˆåˆå§‹ä¸ºç©ºï¼Œéšå‰§æƒ…æ·»åŠ ï¼‰"],
                    æ€§æ ¼: ["åšæ¯…ã€æ­£ç›´ã€å¶å°”å›ºæ‰§ï¼Œå¯¹é¢†æ°‘ä»æ…ˆï¼Œå¯¹æ•Œäººä¸¥å‰", "é¢†ä¸»çš„æ€§æ ¼ç‰¹ç‚¹"],
                    æ‰€åœ¨åœ°ç‚¹: ["é¢†ä¸»å¤§å…", "é¢†ä¸»å½“å‰æ‰€åœ¨ä½ç½®"],
                    è‚‰æ£’: {
                        é•¿åº¦: [18, "å˜ç±³"],
                        å¤–è§‚: ["ç²—å£®æœ‰åŠ›ï¼Œé’ç­‹æ˜æ˜¾", "å¤–è§‚æè¿°"],
                        çŠ¶æ€: ["æ­£å¸¸", "å½“å‰çŠ¶æ€æè¿°"]
                    },
                    æ€§ç»éªŒ: [12, "æ€§ç»éªŒæ¬¡æ•°"],
                    å­å—£: ["æ— ", "å­å—£æè¿°"]
                },
                Diplomacy: {
    å…¨å±€çŠ¶æ€: {
        å¤–äº¤ç„¦ç‚¹: ["å¸å›½å…³ç³»", "å½“å‰æœ€é‡è¦çš„å¤–äº¤äº‹åŠ¡"],
        æœ€è¿‘äº‹ä»¶: ["å¸å›½ä½¿è€…æ¥è®¿", "æœ€è¿‘å‘ç”Ÿçš„å¤–äº¤äº‹ä»¶"],
        ç‰¹æ®ŠçŠ¶æ€: ["æœ‰å®—ä¸»å›½", "ä¾‹å¦‚ï¼šå¤„äºæˆ˜äº‰ä¸­ã€æœ‰å®—ä¸»å›½ã€è¢«å°é”ç­‰"],
        æœˆåº¦å¤–äº¤æ”¶æ”¯: [0, "è‡ªåŠ¨è®¡ç®—ï¼šæ‰€æœ‰æ¡çº¦çš„æ”¶æ”¯å½±å“æ€»å’Œ"]
    },
    åŠ¿åŠ›å…³ç³»: {
        æ ¼é‡ŒèŠ¬å¸å›½: {
            åç§°: ["æ ¼é‡ŒèŠ¬å¸å›½", "ä¸­å¤®æ”¿æƒ"],
            é¢†è¢–: ["å¥¥å¤æ–¯éƒ½çš‡å¸", "é¢†è¢–å§“å"],
            æ€åº¦: ["å®—ä¸»", "æˆ‘çš„å®—ä¸»å›½"],
            å…³ç³»å€¼: [25, "è¡¨é¢æ­æ•¬ï¼Œå®åˆ™ç´§å¼ "],
            å®åŠ›å¯¹æ¯”: ["è¿œå¼ºäºæˆ‘", "å®Œå…¨æ— æ³•æŠ—è¡¡"],
            ç°æœ‰æ¡çº¦: {
                é™„åº¸åè®®: {
                    æ¡çº¦ç±»å‹: ["é™„åº¸", "ç±»å‹"],
                    ç­¾è®¢æ—¶é—´: ["å³ä½æ—¶", "ç­¾è®¢æ—¶é—´"],
                    ä¸»è¦å†…å®¹: ["æ‰¿è®¤å¸å›½å®—ä¸»æƒï¼Œæ¯å¹´ç¼´çº³å²è´¡ï¼Œæˆ˜æ—¶æä¾›å…µåŠ›", "æ ¸å¿ƒå†…å®¹"],
                    æœ‰æ•ˆæœŸ: ["æ°¸ä¹…", "é™¤éç‹¬ç«‹"],
                    æ”¶æ”¯å½±å“: [-500, "æ¯æœˆå‘å¸å›½ç¼´çº³çš„å²è´¡"]
                },
                åŸºç¡€è´¸æ˜“: {
                    æ¡çº¦ç±»å‹: ["è´¸æ˜“", "ç±»å‹"],
                    ç­¾è®¢æ—¶é—´: ["å³ä½æ—¶", "ç­¾è®¢æ—¶é—´"],
                    ä¸»è¦å†…å®¹: ["å¸å›½å•†äººå¯åœ¨é¢†åœ°è‡ªç”±ç»å•†ï¼Œå…³ç¨ä¼˜æƒ 5%", "æ ¸å¿ƒå†…å®¹"],
                    æœ‰æ•ˆæœŸ: ["æ°¸ä¹…", "æœ‰æ•ˆæœŸ"],
                    æ”¶æ”¯å½±å“: [80, "å¸å›½å•†é˜Ÿå¸¦æ¥çš„å‡€æ”¶å…¥"]
                }
            },
            è¿‘æœŸåŠ¨å‘: ["ä½¿è€…å³å°†æ¥è®¿ï¼Œå•†è®¨å¢åŠ å²è´¡äº‹å®œ", "è¿‘æœŸåŠ¨å‘"]
        },
        å±±æ°‘ç‹å›½: {
            åç§°: ["å±±æ°‘ç‹å›½", "å"],
            é¢†è¢–: ["å¸ƒå…°å¾·å›½ç‹", "é¢†è¢–å§“å"],
            æ€åº¦: ["å‹å–„", "æ€åº¦"],
            å…³ç³»å€¼: [65, "å…³ç³»å€¼"],
            å®åŠ›å¯¹æ¯”: ["ç¨å¼º", "å®åŠ›å¯¹æ¯”"],
            ç°æœ‰æ¡çº¦: {
                äº’ä¸ä¾µçŠ¯: {
                    æ¡çº¦ç±»å‹: ["å†›äº‹", "ç±»å‹"],
                    ç­¾è®¢æ—¶é—´: ["ç¬¬1å¹´ 1æœˆ", "ç­¾è®¢æ—¶é—´"],
                    ä¸»è¦å†…å®¹: ["æ‰¿è¯ºäº’ä¸ä¾µçŠ¯ï¼Œå°Šé‡ç°æœ‰è¾¹ç•Œ", "æ ¸å¿ƒå†…å®¹"],
                    æœ‰æ•ˆæœŸ: ["10å¹´", "æœ‰æ•ˆæœŸ"],
                    æ”¶æ”¯å½±å“: [0, "æ— ç›´æ¥ç»æµå½±å“"]
                },
                é€šå•†æ¡çº¦: {
                    æ¡çº¦ç±»å‹: ["è´¸æ˜“", "ç±»å‹"],
                    ç­¾è®¢æ—¶é—´: ["ç¬¬1å¹´ 1æœˆ", "ç­¾è®¢æ—¶é—´"],
                    ä¸»è¦å†…å®¹: ["äº’é™å…³ç¨10%ï¼Œä¿éšœå•†é˜Ÿå®‰å…¨", "æ ¸å¿ƒå†…å®¹"],
                    æœ‰æ•ˆæœŸ: ["5å¹´", "æœ‰æ•ˆæœŸ"],
                    æ”¶æ”¯å½±å“: [150, "æ¯›çš®å’Œè‰è¯çš„è´¸æ˜“å‡€æ”¶å…¥"]
                }
            },
            è¿‘æœŸåŠ¨å‘: ["å¿™äºå†…éƒ¨ç‹©çŒèŠ‚ï¼Œè¾¹å¢ƒå¹³é™", "è¿‘æœŸåŠ¨å‘"]
        },
        ç¢ç‰™éƒ¨è½: {
            åç§°: ["ç¢ç‰™éƒ¨è½", "å"],
            é¢†è¢–: ["æ ¼æ‹‰å…‹é…‹é•¿", "é¢†è¢–å§“å"],
            æ€åº¦: ["æ•Œå¯¹", "æ€åº¦"],
            å…³ç³»å€¼: [-70, "å…³ç³»å€¼"],
            å®åŠ›å¯¹æ¯”: ["ç›¸å½“", "å®åŠ›å¯¹æ¯”"],
            ç°æœ‰æ¡çº¦: {
                äº‹å®åœç«: {
                    æ¡çº¦ç±»å‹: ["å†›äº‹", "ç±»å‹"],
                    ç­¾è®¢æ—¶é—´: ["æ— æ­£å¼ç­¾è®¢", "ç­¾è®¢æ—¶é—´"],
                    ä¸»è¦å†…å®¹: ["åŸºäºå®é™…æ§åˆ¶çº¿çš„éæ­£å¼åœç«", "æ ¸å¿ƒå†…å®¹"],
                    æœ‰æ•ˆæœŸ: ["ä¸ç¨³å®š", "æœ‰æ•ˆæœŸ"],
                    æ”¶æ”¯å½±å“: [-30, "è¾¹å¢ƒé˜²å¾¡çš„é¢å¤–å¼€é”€"]
                }
            },
            è¿‘æœŸåŠ¨å‘: ["åœ¨åŒ—éƒ¨æ£®æ—é¢‘ç¹æ´»åŠ¨ï¼Œå¯èƒ½ç­–åˆ’è¢­å‡»", "è¿‘æœŸåŠ¨å‘"]
        }
    },
    ä½¿è€…ä¿¡æ¯: {
        å¸å›½ä½¿è€…: {
            å§“å: ["å¡å·´æ–¯è’‚å®‰å­çˆµ", "ä½¿è€…å§“å"],
            æ‰€åœ¨ä½ç½®: ["é¢†ä¸»å¤§å…", "å½“å‰æ‰€åœ¨"],
            ä»»åŠ¡: ["å•†è®¨å²è´¡", "æ¥è®¿ç›®çš„"],
            åœç•™æ—¶é—´: ["7å¤©", "é¢„è®¡åœç•™"],
            ä¸ªäººå¥½æ„Ÿ: [40, "å¯¹é¢†ä¸»ä¸ªäººå¥½æ„Ÿ"]
        }
    }
},
æ™¨æŠ¥: {
    ç‹å›½é£é—»: {
        æ ‡é¢˜: ["å¸å›½æœå ‚æš—æµæ¶ŒåŠ¨ï¼Œè¾¹å¢ƒé¢†ä¸»é›†ä¼šå•†è®¨å¯¹ç­–", "æ ‡é¢˜"],
        å†…å®¹: ["å¸éƒ½ä¼ æ¥æ¶ˆæ¯ï¼Œå‡ ä½å®æƒè´µæ—æ­£åœ¨æ¨åŠ¨æ–°çš„è¾¹å¢ƒç®¡æ§æ³•æ¡ˆï¼Œè¦æ±‚æ‰€æœ‰è¾¹å¢ƒé¢†åœ°å¢æ´¾é©»å†›å¹¶æé«˜ç¨æ”¶ã€‚ä¸æ­¤åŒæ—¶ï¼ŒåŒ—å¢ƒåä¸ƒä½é¢†ä¸»å·²ç§˜å¯†çº¦å®šä¸‹æœˆåœ¨ç°å²©å ¡é›†ä¼šï¼Œå•†è®¨è”åˆåº”å¯¹ä¹‹ç­–ã€‚", "å†…å®¹"]
    },
    é¢†åœ°çºªäº‹: {
        æ ‡é¢˜: ["å—å¡æ–°å¦åœ°ä¸°æ”¶ï¼Œå´é­é‡çŒªç¥¸å®³", "æ ‡é¢˜"],
        å†…å®¹: ["é¢†æ°‘ä»¬æ¬£å–œäºå—å¡æ–°å¦å†œç”°çš„é¦–æ¬¡ä¸°æ”¶ï¼Œä½†æ˜¨å¤œä¸€ç¾¤ä»é»‘æ£®æ—çªœå‡ºçš„å·¨é‡çŒªæ¯åäº†è¿‘ä¸‰åˆ†ä¹‹ä¸€çš„åº„ç¨¼ã€‚çŒæˆ·ä»¬å·²ç»„ç»‡å›´æ•ï¼Œé“åŒ é“ºæ­£åœ¨èµ¶åˆ¶æ›´å¤šçŸ›å¤´ã€‚", "å†…å®¹"]
    },
    äººç‰©è½¶å½•: {
        æ ‡é¢˜: ["è€è¯å¸ˆçš„ç¥ç§˜è®¿å®¢ä¸é“åŒ çš„é»„æ˜æ‹æƒ…", "æ ‡é¢˜"],
        å†…å®¹: ["æœ‰äººç›®ç¹ä¸€ä½æŠ«ç€æ–—ç¯·çš„ç²¾çµè¿ç»­ä¸‰å¤œé€ è®¿è€è¯å¸ˆçš„è‰å±‹ï¼Œç¦»å»æ—¶æºå¸¦ç€é¼“å›Šå›Šçš„åŒ…è£¹ã€‚å¦ä¸€æ–¹é¢ï¼Œé“åŒ å®‰å¾·çƒˆæœ€è¿‘æ”¶å·¥åæ€»å¾€åŠç²¾çµèšå±…åŒºè·‘ï¼Œå¹´è½»å­¦å¾’ä»¬éƒ½åœ¨çªƒç¬‘è®®è®ºã€‚", "å†…å®¹"]
    },
    å¼‚äº‹æ‚è°ˆ: {
        æ ‡é¢˜: ["ç‰§ç«¥çš„ç‹¬è§’å…½å¹»æ¢¦ä¸é…’é¦†é‡Œçš„é¢„è¨€è¯—", "æ ‡é¢˜"],
        å†…å®¹: ["ç‰§ç«¥çš®ç‰¹åšæŒè¯´åœ¨æ™¨é›¾ä¸­è§åˆ°äº†é€šä½“çº¯ç™½çš„ç‹¬è§’å…½ï¼Œä½†è·Ÿç€å»çš„çŒçŠ¬ä»€ä¹ˆä¹Ÿæ²¡æ‰¾åˆ°ã€‚'æ²‰ç¡å·¨äºº'é…’é¦†é‡Œï¼Œä¸€ä¸ªæµæµªåŸæ¸¸è¯—äººå”±äº†é¦–å…³äº'å†°å°ä¹‹å¿ƒ'çš„å¤è€å™äº‹è¯—ï¼Œå‡ ä¸ªè€é…’å®¢å¬åè„¸è‰²å‘ç™½ã€‚", "å†…å®¹"]
    }
}
            };
        }
        
        // è·å–ç¤ºä¾‹è§’è‰²ï¼ˆç”¨äºæµ‹è¯•ï¼‰
        function getExampleCharacters() {
            return {
                character_001: {
                    id: ["character_001", "è§’è‰²ID"],
                    å§“å: ["è‰¾è‰ä¸", "è§’è‰²å§“å"],
                    è§’è‰²æ¦‚è§ˆ: {
                        æ€§åˆ«: ["å¥³", "å¥³"],
                        å¹´é¾„: [26, "å¹´é¾„"],
                        èº«ä»½: ["é“åŒ é“ºç®¡ç†è€…", "æ—¥å¸¸èº«ä»½/èŒä¸šï¼Œå¦‚ï¼šé“åŒ ã€å•†äººã€å®˜å‘˜"],
                        èŒä¸š: ["å·¥åŒ ", "æˆ˜æ–—èŒä¸šï¼Œå¦‚ï¼šæˆ˜å£«ã€æ³•å¸ˆã€ç›—è´¼"],
                        ä¸é¢†ä¸»å…³ç³»: ["ä¸‹å±ï¼Œå¿ è¯šçš„ç®¡ç†è€…", "ä¸{{user}}çš„å…³ç³»æè¿°"],
                        æ€§æ ¼: ["ä¸¥è°¨ã€ç»†è‡´ã€æœ‰è´£ä»»å¿ƒ", "æ€§æ ¼ç‰¹ç‚¹ï¼ˆä¸å¯å˜ï¼‰"],
                        å¥½æ„Ÿåº¦: [65, "å¯¹{{user}}çš„å¥½æ„Ÿåº¦0-100"],
                        å¿ è¯šåº¦: [70, "å¯¹{{user}}çš„å¿ è¯šåº¦0-100"],
                        æƒ…ç»ª: ["ä¸“æ³¨", "å½“å‰æƒ…ç»ªçŠ¶æ€"],
                        å½“å‰è¡Œä¸º: ["ç›‘ç£é“åŒ é“ºç”Ÿäº§", "å½“å‰æ­£åœ¨åšä»€ä¹ˆ"],
                        æ‰€åœ¨åœ°ç‚¹: ["é“åŒ é“º", "å½“å‰æ‰€åœ¨ä½ç½®"],
                        æœ€è¿‘äº’åŠ¨: ["ä¸Šå‘¨æ±‡æŠ¥é“åŒ é“ºè¿è¥æƒ…å†µ", "æœ€è¿‘ä¸é¢†ä¸»çš„äº’åŠ¨è®°å½•"]
                    },
                    èº«ä½“å¤–è²Œ: {
                        å¤–è²Œ: ["æ —è‰²é•¿å‘æŸæˆé©¬å°¾ï¼Œç»¿è‰²çœ¼çœ¸ï¼Œé¼»æ¢é«˜æŒº", "è„¸éƒ¨å’Œå¤´å‘çš„è¯¦ç»†æè¿°"],
                        èº«æ: ["åŒ€ç§°ç»“å®ï¼Œæ‰‹è‡‚è‚Œè‚‰çº¿æ¡æ˜æ˜¾", "èº«æä½“å‹æè¿°"],
                        èº«é«˜: [168, "å˜ç±³"],
                        ä½“é‡: [58, "å…¬æ–¤"],
                        ä¸Šèº«è¡£ç€: ["çš®è´¨å›´è£™ï¼Œå†…ç©¿äºšéº»è¡¬è¡«", "å½“å‰ä¸Šèº«ç©¿ç€"],
                        ä¸‹èº«è¡£ç€: ["åšå®é•¿è£¤ï¼Œç‰›çš®é´", "å½“å‰ä¸‹èº«ç©¿ç€"],
                        é…é¥°: ["é“¶è´¨æ‰‹é•¯ï¼Œå®¶æ—å¾½è®°", "ä½©æˆ´çš„é¥°å“ã€é¦–é¥°ç­‰"],
                        ç‰¹æ®Šæ ‡è®°: ["å·¦æ‰‹è…•æœ‰çƒ«ä¼¤ç–¤ç—•", "çº¹èº«ã€ä¼¤ç–¤ç­‰ç‰¹æ®Šæ ‡è®°"]
                    },
                    èƒ½åŠ›äº”ç»´: {
                        å†›äº‹: [30, "å†›äº‹æŒ‡æŒ¥å’Œæˆ˜æ–—èƒ½åŠ›0-100"],
                        ç®¡ç†: [65, "è¡Œæ”¿ç®¡ç†å’Œç»„ç»‡èƒ½åŠ›0-100"],
                        å¤–äº¤: [40, "å¤–äº¤è°ˆåˆ¤å’Œç¤¾äº¤èƒ½åŠ›0-100"],
                        è°‹ç•¥: [55, "è°‹ç•¥ç­–åˆ’å’Œæ™ºæ…§0-100"],
                        å­¦è¯†: [45, "çŸ¥è¯†å’Œå­¦ä¹ èƒ½åŠ›0-100"],
                        å‹‡æ­¦: [35, "ä¸ªäººæˆ˜æ–—å‹‡çŒ›ç¨‹åº¦0-100"]
                    },
                    æ€§: {
                        èƒ¸éƒ¨: {
                            å¤–è§‚: ["ä¸°æ»¡åœ†æ¶¦ï¼Œä¹³æ™•æµ…ç²‰è‰²", "å¤–è§‚æè¿°"],
                            å¤§å°: ["Cç½©æ¯", "å°ºå¯¸æè¿°"],
                            æ•æ„Ÿåº¦: [70, "æ•æ„Ÿåº¦0-100"],
                            çŠ¶æ€: ["æ­£å¸¸", "å½“å‰çŠ¶æ€æè¿°"]
                        },
                        å°ç©´: {
                            å¤–è§‚: ["ç²‰å«©ï¼Œé˜´å”‡å°å·§", "å¤–è§‚æè¿°"],
                            ç´§è‡´åº¦: [85, "ç´§è‡´åº¦0-100"],
                            æ•æ„Ÿåº¦: [75, "æ•æ„Ÿåº¦0-100"],
                            çŠ¶æ€: ["æ¹¿æ¶¦", "å½“å‰æ¹¿æ¶¦/çŠ¶æ€æè¿°"],
                            ä½¿ç”¨æ¬¡æ•°: [3, "è¢«æ’å…¥æ¬¡æ•°"]
                        },
                        ååº­: {
                            å¤–è§‚: ["ç´§è‡´ï¼Œç²‰çº¢è‰²", "å¤–è§‚æè¿°"],
                            ç´§è‡´åº¦: [90, "ç´§è‡´åº¦0-100"],
                            æ•æ„Ÿåº¦: [60, "æ•æ„Ÿåº¦0-100"],
                            çŠ¶æ€: ["æœªå¼€å‘", "å½“å‰çŠ¶æ€æè¿°"],
                            ä½¿ç”¨æ¬¡æ•°: [0, "è¢«æ’å…¥æ¬¡æ•°"]
                        },
                        è‚‰æ£’: {
                            å¤–è§‚: ["æ— ", "å¤–è§‚æè¿°"],
                            é•¿åº¦: [0, "å˜ç±³"],
                            ç²—åº¦: [0, "å˜ç±³"],
                            çŠ¶æ€: ["æ— ", "å½“å‰å‹ƒèµ·çŠ¶æ€æè¿°"]
                        },
                        æ€§ç»éªŒ: {
                            æ€»æ¬¡æ•°: [5, "æ€§è¡Œä¸ºæ€»æ¬¡æ•°"],
                            äººæ•°: [2, "æœ‰è¿‡å…³ç³»çš„æ€»äººæ•°"],
                            ç¬¬ä¸€æ¬¡æ—¶é—´: ["18å²", "åˆä½“éªŒæ—¶é—´"],
                            åå¥½å§¿åŠ¿: ["ä¼ æ•™å£«", "åå¥½çš„æ€§çˆ±å§¿åŠ¿"]
                        },
                        æ€§ç™–: ["è½»å¾®æ”¯é…å€¾å‘ï¼Œå–œæ¬¢è¢«æ¸©æŸ”å¯¹å¾…", "æ€§åå¥½å’Œç‰¹æ®Šç™–å¥½"],
                        ç”Ÿç†å‘¨æœŸ: {
                            å½“å‰é˜¶æ®µ: ["åµæ³¡æœŸ", "æœˆç»æœŸ/åµæ³¡æœŸ/æ’åµæœŸ/é»„ä½“æœŸ"],
                            é˜¶æ®µè¿›åº¦: [3, "å½“å‰é˜¶æ®µç¬¬å‡ å¤©ï¼Œ1-7"],
                            æ€»å‘¨æœŸå¤©æ•°: [28, "å‘¨æœŸæ€»å¤©æ•°"],
                            å½“å‰å‘¨æœŸå¤©æ•°: [10, "å½“å‰å‘¨æœŸç¬¬å‡ å¤©"],
                            ä¸Šæ¬¡æœˆç»å¼€å§‹: ["ç¬¬1å¹´ 1æœˆ1æ—¥", "ä¸Šæ¬¡æœˆç»å¼€å§‹æ—¶é—´"]
                        },
                        æ€€å­•çŠ¶æ€: {
                            æ˜¯å¦æ€€å­•: [false, "æ˜¯å¦æ€€å­•"],
                            æ€€å­•å¼€å§‹æ—¶é—´: ["", "æ€€å­•å¼€å§‹æ—¶é—´"],
                            æ€€å­•å‘¨æ•°: [0, "æ€€å­•å‘¨æ•°"],
                            èƒå„¿çˆ¶äº²: ["", "èƒå„¿çˆ¶äº²å§“å/ID"],
                            å­•æœŸçŠ¶æ€: ["", "å­•æœŸååº”æè¿°"]
                        },
                        å­å—£: {
                            æ•°é‡: [0, "å­å—£æ€»æ•°"],
                            æè¿°: ["æ— ", "å­å—£ç®€å•æè¿°"]
                        },
                        ä½“æ¶²çŠ¶æ€: {
                            èƒƒéƒ¨æ¶²ä½“é‡: [200, "èƒƒéƒ¨æ¶²ä½“é‡(ml)"],
                            å­å®«æ¶²ä½“é‡: [5, "å­å®«æ¶²ä½“é‡(ml)"],
                            è‚ é“æ¶²ä½“é‡: [300, "è‚ é“æ¶²ä½“é‡(ml)"],
                            è†€èƒ±æ¶²ä½“é‡: [150, "è†€èƒ±æ¶²ä½“é‡(ml)"],
                            æœ€å¤§å®¹é‡: {
                                èƒƒéƒ¨: [2000, "èƒƒéƒ¨æœ€å¤§å®¹é‡(ml)"],
                                å­å®«: [100, "å­å®«æœ€å¤§å®¹é‡(ml)"],
                                è‚ é“: [1500, "è‚ é“æœ€å¤§å®¹é‡(ml)"],
                                è†€èƒ±: [800, "è†€èƒ±æœ€å¤§å®¹é‡(ml)"]
                            },
                            æ’æ³„éœ€æ±‚: [20, "æ’æ³„éœ€æ±‚ç¨‹åº¦0-100"]
                        },
                        æ•æ„Ÿå¸¦: ["é¢ˆéƒ¨ã€è€³åã€èƒ¸éƒ¨ã€å¤§è…¿å†…ä¾§", "èº«ä½“æ•æ„ŸåŒºåŸŸæè¿°"],
                        æ‹’ç»è¡Œä¸º: ["ç²—æš´è¡Œä¸ºã€å…¬å¼€åœºåˆ", "æ‹’ç»çš„æ€§è¡Œä¸ºç±»å‹"],
                        ç‰¹æ®Šèƒ½åŠ›: ["æ— ", "ç‰¹æ®Šçš„æ€§èƒ½åŠ›æˆ–ä½“è´¨"]
                    },
                    èƒŒæ™¯æ•…äº‹: ["è‰¾è‰ä¸æ˜¯é“åŒ å¤§å¸ˆæœå°”é‡‘çš„å¥³å„¿ï¼Œä»å°åœ¨é“åŒ é“ºé•¿å¤§ï¼Œç»§æ‰¿äº†çˆ¶äº²çš„æŠ€è‰ºå’Œç®¡ç†èƒ½åŠ›ã€‚å¥¹æ€§æ ¼ä¸¥è°¨è®¤çœŸï¼Œå¯¹å·¥ä½œä¸€ä¸ä¸è‹Ÿï¼Œæ·±å—é“åŒ é“ºå‘˜å·¥ä»¬çš„å°Šé‡ã€‚", "è§’è‰²çš„èƒŒæ™¯æ•…äº‹å’Œç»å†"]
                },
                character_002: {
                    id: ["character_002", "è§’è‰²ID"],
                    å§“å: ["æœå°”é‡‘", "è§’è‰²å§“å"],
                    è§’è‰²æ¦‚è§ˆ: {
                        æ€§åˆ«: ["ç”·", "ç”·"],
                        å¹´é¾„: [52, "å¹´é¾„"],
                        èº«ä»½: ["é“åŒ å¤§å¸ˆ", "æ—¥å¸¸èº«ä»½/èŒä¸šï¼Œå¦‚ï¼šé“åŒ ã€å•†äººã€å®˜å‘˜"],
                        èŒä¸š: ["å·¥åŒ ", "æˆ˜æ–—èŒä¸šï¼Œå¦‚ï¼šæˆ˜å£«ã€æ³•å¸ˆã€ç›—è´¼"],
                        ä¸é¢†ä¸»å…³ç³»: ["è€è‡£ï¼ŒæŠ€æœ¯é¡¾é—®", "ä¸{{user}}çš„å…³ç³»æè¿°"],
                        æ€§æ ¼: ["å›ºæ‰§ä½†ç»éªŒä¸°å¯Œï¼Œå¿ äºèŒå®ˆ", "æ€§æ ¼ç‰¹ç‚¹ï¼ˆä¸å¯å˜ï¼‰"],
                        å¥½æ„Ÿåº¦: [70, "å¯¹{{user}}çš„å¥½æ„Ÿåº¦0-100"],
                        å¿ è¯šåº¦: [85, "å¯¹{{user}}çš„å¿ è¯šåº¦0-100"],
                        æƒ…ç»ª: ["æ»¡æ„", "å½“å‰æƒ…ç»ªçŠ¶æ€"],
                        å½“å‰è¡Œä¸º: ["é”»é€ æ­¦å™¨", "å½“å‰æ­£åœ¨åšä»€ä¹ˆ"],
                        æ‰€åœ¨åœ°ç‚¹: ["é“åŒ é“ºé”»é€ é—´", "å½“å‰æ‰€åœ¨ä½ç½®"],
                        æœ€è¿‘äº’åŠ¨: ["è¯·æ±‚å¢åŠ é“çŸ¿ä¾›åº”", "æœ€è¿‘ä¸é¢†ä¸»çš„äº’åŠ¨è®°å½•"]
                    },
                    èº«ä½“å¤–è²Œ: {
                        å¤–è²Œ: ["å…‰å¤´ï¼Œæµ“å¯†ç°è‰²èƒ¡é¡»ï¼Œæ£•è‰²çœ¼ç›æ·±é‚ƒ", "è„¸éƒ¨å’Œå¤´å‘çš„è¯¦ç»†æè¿°"],
                        èº«æ: ["çŸ®å£®ï¼Œè‚©è†€å®½åš", "èº«æä½“å‹æè¿°"],
                        èº«é«˜: [142, "å˜ç±³"],
                        ä½“é‡: [65, "å…¬æ–¤"],
                        ä¸Šèº«è¡£ç€: ["æ— è¢–çš®ç”²ï¼Œéœ²å‡ºè‚Œè‚‰å‘è¾¾çš„æ‰‹è‡‚", "å½“å‰ä¸Šèº«ç©¿ç€"],
                        ä¸‹èº«è¡£ç€: ["åšå¸†å¸ƒè£¤ï¼Œé“å¤´é´", "å½“å‰ä¸‹èº«ç©¿ç€"],
                        é…é¥°: ["é“œè´¨è€³ç¯ï¼Œçš®è´¨å·¥å…·è…°å¸¦", "ä½©æˆ´çš„é¥°å“ã€é¦–é¥°ç­‰"],
                        ç‰¹æ®Šæ ‡è®°: ["åŒè‡‚å¸ƒæ»¡çƒ«ä¼¤å’Œåˆ€ç–¤", "çº¹èº«ã€ä¼¤ç–¤ç­‰ç‰¹æ®Šæ ‡è®°"]
                    },
                    èƒ½åŠ›äº”ç»´: {
                        å†›äº‹: [40, "å†›äº‹æŒ‡æŒ¥å’Œæˆ˜æ–—èƒ½åŠ›0-100"],
                        ç®¡ç†: [60, "è¡Œæ”¿ç®¡ç†å’Œç»„ç»‡èƒ½åŠ›0-100"],
                        å¤–äº¤: [30, "å¤–äº¤è°ˆåˆ¤å’Œç¤¾äº¤èƒ½åŠ›0-100"],
                        è°‹ç•¥: [50, "è°‹ç•¥ç­–åˆ’å’Œæ™ºæ…§0-100"],
                        å­¦è¯†: [70, "çŸ¥è¯†å’Œå­¦ä¹ èƒ½åŠ›0-100"],
                        å‹‡æ­¦: [55, "ä¸ªäººæˆ˜æ–—å‹‡çŒ›ç¨‹åº¦0-100"]
                    },
                    æ€§: {
                        èƒ¸éƒ¨: {
                            å¤–è§‚: ["å¹³å¦ï¼Œèƒ¸è‚Œå‘è¾¾", "å¤–è§‚æè¿°"],
                            å¤§å°: ["æ— ", "å°ºå¯¸æè¿°"],
                            æ•æ„Ÿåº¦: [20, "æ•æ„Ÿåº¦0-100"],
                            çŠ¶æ€: ["æ­£å¸¸", "å½“å‰çŠ¶æ€æè¿°"]
                        },
                        å°ç©´: {
                            å¤–è§‚: ["æ— ", "å¤–è§‚æè¿°"],
                            ç´§è‡´åº¦: [0, "ç´§è‡´åº¦0-100"],
                            æ•æ„Ÿåº¦: [0, "æ•æ„Ÿåº¦0-100"],
                            çŠ¶æ€: ["æ— ", "å½“å‰æ¹¿æ¶¦/çŠ¶æ€æè¿°"],
                            ä½¿ç”¨æ¬¡æ•°: [0, "è¢«æ’å…¥æ¬¡æ•°"]
                        },
                        ååº­: {
                            å¤–è§‚: ["æ­£å¸¸", "å¤–è§‚æè¿°"],
                            ç´§è‡´åº¦: [80, "ç´§è‡´åº¦0-100"],
                            æ•æ„Ÿåº¦: [30, "æ•æ„Ÿåº¦0-100"],
                            çŠ¶æ€: ["æœªå¼€å‘", "å½“å‰çŠ¶æ€æè¿°"],
                            ä½¿ç”¨æ¬¡æ•°: [0, "è¢«æ’å…¥æ¬¡æ•°"]
                        },
                        è‚‰æ£’: {
                            å¤–è§‚: ["ç²—å£®ï¼Œé’ç­‹æ˜æ˜¾", "å¤–è§‚æè¿°"],
                            é•¿åº¦: [16, "å˜ç±³"],
                            ç²—åº¦: [4, "å˜ç±³"],
                            çŠ¶æ€: ["æ­£å¸¸", "å½“å‰å‹ƒèµ·çŠ¶æ€æè¿°"]
                        },
                        æ€§ç»éªŒ: {
                            æ€»æ¬¡æ•°: [50, "æ€§è¡Œä¸ºæ€»æ¬¡æ•°"],
                            äººæ•°: [3, "æœ‰è¿‡å…³ç³»çš„æ€»äººæ•°"],
                            ç¬¬ä¸€æ¬¡æ—¶é—´: ["20å²", "åˆä½“éªŒæ—¶é—´"],
                            åå¥½å§¿åŠ¿: ["ä¼ ç»Ÿå§¿åŠ¿", "åå¥½çš„æ€§çˆ±å§¿åŠ¿"]
                        },
                        æ€§ç™–: ["ä¼ ç»Ÿä¿å®ˆ", "æ€§åå¥½å’Œç‰¹æ®Šç™–å¥½"],
                        ç”Ÿç†å‘¨æœŸ: {
                            å½“å‰é˜¶æ®µ: ["æ— ", "æœˆç»æœŸ/åµæ³¡æœŸ/æ’åµæœŸ/é»„ä½“æœŸ"],
                            é˜¶æ®µè¿›åº¦: [0, "å½“å‰é˜¶æ®µç¬¬å‡ å¤©ï¼Œ1-7"],
                            æ€»å‘¨æœŸå¤©æ•°: [0, "å‘¨æœŸæ€»å¤©æ•°"],
                            å½“å‰å‘¨æœŸå¤©æ•°: [0, "å½“å‰å‘¨æœŸç¬¬å‡ å¤©"],
                            ä¸Šæ¬¡æœˆç»å¼€å§‹: ["", "ä¸Šæ¬¡æœˆç»å¼€å§‹æ—¶é—´"]
                        },
                        æ€€å­•çŠ¶æ€: {
                            æ˜¯å¦æ€€å­•: [false, "æ˜¯å¦æ€€å­•"],
                            æ€€å­•å¼€å§‹æ—¶é—´: ["", "æ€€å­•å¼€å§‹æ—¶é—´"],
                            æ€€å­•å‘¨æ•°: [0, "æ€€å­•å‘¨æ•°"],
                            èƒå„¿çˆ¶äº²: ["", "èƒå„¿çˆ¶äº²å§“å/ID"],
                            å­•æœŸçŠ¶æ€: ["", "å­•æœŸååº”æè¿°"]
                        },
                        å­å—£: {
                            æ•°é‡: [2, "å­å—£æ€»æ•°"],
                            æè¿°: ["ä¸€å­ä¸€å¥³ï¼Œå‡å·²æˆå¹´", "å­å—£ç®€å•æè¿°"]
                        },
                        ä½“æ¶²çŠ¶æ€: {
                            èƒƒéƒ¨æ¶²ä½“é‡: [500, "èƒƒéƒ¨æ¶²ä½“é‡(ml)"],
                            å­å®«æ¶²ä½“é‡: [0, "å­å®«æ¶²ä½“é‡(ml)"],
                            è‚ é“æ¶²ä½“é‡: [400, "è‚ é“æ¶²ä½“é‡(ml)"],
                            è†€èƒ±æ¶²ä½“é‡: [200, "è†€èƒ±æ¶²ä½“é‡(ml)"],
                            æœ€å¤§å®¹é‡: {
                                èƒƒéƒ¨: [2500, "èƒƒéƒ¨æœ€å¤§å®¹é‡(ml)"],
                                å­å®«: [0, "å­å®«æœ€å¤§å®¹é‡(ml)"],
                                è‚ é“: [1800, "è‚ é“æœ€å¤§å®¹é‡(ml)"],
                                è†€èƒ±: [1000, "è†€èƒ±æœ€å¤§å®¹é‡(ml)"]
                            },
                            æ’æ³„éœ€æ±‚: [30, "æ’æ³„éœ€æ±‚ç¨‹åº¦0-100"]
                        },
                        æ•æ„Ÿå¸¦: ["æ— ç‰¹åˆ«æ•æ„ŸåŒºåŸŸ", "èº«ä½“æ•æ„ŸåŒºåŸŸæè¿°"],
                        æ‹’ç»è¡Œä¸º: ["åŒæ€§è¡Œä¸ºã€ç‰¹æ®Šç™–å¥½", "æ‹’ç»çš„æ€§è¡Œä¸ºç±»å‹"],
                        ç‰¹æ®Šèƒ½åŠ›: ["æ— ", "ç‰¹æ®Šçš„æ€§èƒ½åŠ›æˆ–ä½“è´¨"]
                    },
                    èƒŒæ™¯æ•…äº‹: ["æœå°”é‡‘æ˜¯é¢†åœ°å†…æœ€èµ„æ·±çš„é“åŒ å¤§å¸ˆï¼Œå·²åœ¨é“åŒ é“ºå·¥ä½œäº†ä¸‰åä½™å¹´ã€‚ä»–æŠ€è‰ºç²¾æ¹›ï¼Œå°¤å…¶æ“…é•¿é”»é€ æ­¦å™¨å’Œç›”ç”²ï¼Œä¸ºé¢†åœ°çš„é˜²å¾¡åšå‡ºäº†é‡è¦è´¡çŒ®ã€‚", "è§’è‰²çš„èƒŒæ™¯æ•…äº‹å’Œç»å†"]
                }
            };
        }
        
        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(show) {
            const refreshBtn = document.querySelector('.control-btn[onclick="refreshData()"]');
            if (refreshBtn) {
                if (show) {
                    refreshBtn.innerHTML = '<div class="loading"></div>åˆ·æ–°ä¸­...';
                    refreshBtn.disabled = true;
                } else {
                    refreshBtn.innerHTML = 'ğŸ”„ åˆ·æ–°æ•°æ®';
                    refreshBtn.disabled = false;
                }
            }
        }
        
        // å®‰å…¨è·å–æ•°å­—
        function safeNumber(value, defaultValue = 0) {
            if (value === undefined || value === null) {
                return defaultValue;
            }
            
            const extracted = extractMVUValue(value);
            const num = Number(extracted);
            
            if (isNaN(num)) {
                return defaultValue;
            }
            
            return num;
        }
        
        // å®‰å…¨è·å–å­—ç¬¦ä¸²
        function safeString(value, defaultValue = '') {
            if (value === undefined || value === null) {
                return defaultValue;
            }
            
            const extracted = extractMVUValue(value);
            return String(extracted);
        }
        
        // æ›´æ–°UI
        function updateUI() {
            if (!territoryData) {
                return;
            }
            
            updateQuickStats();
            updateBasicInfo();
            updateEconomyOverview();
            updatePopulationOverview();
            updateThreatOverview();
            updateResourceWarnings();
            
            // æ›´æ–°å½“å‰é€‰é¡¹å¡å†…å®¹
            const activeTab = document.querySelector('.tab-btn.active');
            if (activeTab) {
                const tabText = activeTab.textContent.trim();
                switch(tabText) {
                    case 'æ¦‚è§ˆ': break; // å·²ç»æ›´æ–°
                    case 'ç»æµ': loadEconomyDetails(); break;
                    case 'äººå£': loadPopulationDetails(); break;
                    case 'å†›äº‹': loadMilitaryDetails(); break;
                    case 'å»ºç­‘': loadBuildingsGrid(); break;
                    case 'èµ„æº': loadResourcesDetails(); break;
                    case 'ç§‘æŠ€': loadTechnologyDetails(); break;
                    case 'æ³•ä»¤': loadDecreesGrid(); break;
                    case 'è§’è‰²': loadCharactersGrid(); break;
                    case 'å¤–äº¤': loadDiplomacyDetails(); break;
                    case 'ç³»ç»Ÿ': loadSystemDetails(); break;
                }
            }
        }
        
        // æ›´æ–°å¿«é€ŸçŠ¶æ€
        function updateQuickStats() {
            const container = document.getElementById('quick-stats');
            if (!container) return;
            
            const basic = territoryData.åŸºæœ¬ä¿¡æ¯ || {};
            const population = territoryData.äººå£ || {};
            const finance = territoryData.ç»æµ?.è´¢æ”¿ || {};
            const residents = territoryData.çŠ¶æ€?.å±…æ°‘çŠ¶æ€ || {};
            const threat = territoryData.çŠ¶æ€?.å¨èƒçŠ¶æ€ || {};
            
            const totalPopulation = safeNumber(population.æ€»äººå£, 1250);
            const treasury = safeNumber(finance.åº“å­˜é‡‘å¸, 2500);
            const netIncome = safeNumber(finance.æœˆå‡€æ”¶å…¥, 180);
            const threatLevel = safeString(threat.å¨èƒç­‰çº§, 'è­¦æˆ’');
            const morale = safeNumber(residents.æ°‘å¿ƒæŒ‡æ•°, 70);
            const area = safeNumber(basic.é¢ç§¯, 85);
            
            const stats = [
                { 
                    label: 'æ€»äººå£', 
                    value: formatNumber(totalPopulation), 
                    unit: 'äºº',
                    color: '#2C1810'
                },
                { 
                    label: 'å›½åº“èµ„é‡‘', 
                    value: formatCurrency(treasury),
                    color: '#ffc107'
                },
                { 
                    label: 'æœˆåº¦å‡€æ”¶å…¥', 
                    value: formatCurrency(netIncome, true),
                    color: netIncome >= 0 ? '#28a745' : '#dc3545'
                },
                { 
                    label: 'å¨èƒç­‰çº§', 
                    value: threatLevel,
                    color: getThreatColor(threatLevel)
                },
                { 
                    label: 'æ°‘å¿ƒæŒ‡æ•°', 
                    value: formatNumber(morale),
                    unit: '/100',
                    color: getMoraleColor(morale)
                },
                { 
                    label: 'é¢†åœ°é¢ç§¯', 
                    value: formatNumber(area),
                    unit: 'å¹³æ–¹é‡Œ',
                    color: '#2C1810'
                }
            ];
            
            let html = '';
            stats.forEach(stat => {
                const colorStyle = stat.color ? `style="color: ${stat.color};"` : '';
                html += `
                    <div class="stat-card">
                        <div class="stat-value" ${colorStyle}>${stat.value}${stat.unit || ''}</div>
                        <div class="stat-label">${stat.label}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // æ›´æ–°åŸºç¡€ä¿¡æ¯
        function updateBasicInfo() {
            const container = document.getElementById('basic-info');
            if (!container) return;
            
            const basic = territoryData.åŸºæœ¬ä¿¡æ¯ || {};
            const system = territoryData.System || {};
            
            const rows = [
                ['é¢†åœ°åç§°', safeString(basic.åç§°, 'åŒ—å¢ƒè¾¹å¢ƒé¢†')],
                ['é¢†åœ°é¢ç§¯', `${safeNumber(basic.é¢ç§¯, 85)} å¹³æ–¹é‡Œ`],
                ['åœ°å½¢ç‰¹å¾', safeString(basic.åœ°å½¢, 'ä¸˜é™µä¸æ£®æ—')],
                ['å‘å±•é˜¶æ®µ', safeString(basic.å‘å±•é˜¶æ®µ, 'åˆå»º')],
                ['æ¸¸æˆæ—¶é—´', safeString(system.å½“å‰æ¸¸æˆæ—¶é—´, 'ç¬¬1å¹´ 1æœˆ')],
                ['å½“å‰å­£èŠ‚', safeString(system.å½“å‰å­£èŠ‚, 'æ˜¥å­£')]
            ];
            
            let html = '';
            rows.forEach(row => {
                html += `
                    <tr>
                        <td style="width: 100px;">${row[0]}</td>
                        <td>${row[1]}</td>
                    </tr>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // æ›´æ–°ç»æµæ¦‚å†µ
        function updateEconomyOverview() {
            const container = document.getElementById('economy-overview');
            if (!container) return;
            
            const finance = territoryData.ç»æµ?.è´¢æ”¿ || {};
            const taxes = territoryData.ç»æµ?.å…¬å…±ç¨ç‡ || {};
            
            // è®¡ç®—æ€»æ”¶å…¥ï¼ˆä½¿ç”¨æ–°çš„æ”¶å…¥ç»“æ„ï¼‰
            const lordIncome = safeNumber(finance.é¢†ä¸»èµ„äº§_æœˆæ”¶å…¥, 0);
            const privateTax = safeNumber(finance.ç§æœ‰èµ„äº§_ç¨æ”¶, 0);
            const specialIncome = safeNumber(finance.ç‰¹æ®Šæ”¶æ”¯, 0);
            const totalIncome = safeNumber(finance.æœˆæ€»æ”¶å…¥, lordIncome + privateTax + specialIncome);
            
            const expense = safeNumber(finance.æœˆæ€»æ”¯å‡º, 1670);
            const net = safeNumber(finance.æœˆå‡€æ”¶å…¥, totalIncome - expense);
            const balanceStatus = safeString(finance.æ”¶æ”¯çŠ¶æ€, net >= 0 ? 'ğŸ“ˆç›ˆä½™' : 'ğŸ“‰äºæŸ');
            
            const incomeColor = totalIncome >= expense ? '#28a745' : '#dc3545';
            const netColor = net >= 0 ? '#28a745' : '#dc3545';
            
            let html = `
                <table class="data-table">
                    <tr>
                        <td style="width: 100px;">æœˆæ€»æ”¶å…¥</td>
                        <td style="color: ${incomeColor}; font-weight: bold;">${formatCurrency(totalIncome)}</td>
                    </tr>
                    <tr>
                        <td style="width: 100px;">æ”¶å…¥æ„æˆ</td>
                        <td style="font-size: 11px;">
                            é¢†ä¸»èµ„äº§: ${formatCurrency(lordIncome)} | 
                            ç§æœ‰ç¨æ”¶: ${formatCurrency(privateTax)} | 
                            ç‰¹æ®Šæ”¶æ”¯: ${formatCurrency(specialIncome, true)}
                        </td>
                    </tr>
                    <tr>
                        <td>æœˆæ€»æ”¯å‡º</td>
                        <td style="color: #dc3545;">${formatCurrency(expense)}</td>
                    </tr>
                    <tr>
                        <td>æœˆå‡€æ”¶å…¥</td>
                        <td style="color: ${netColor}; font-weight: bold;">${formatCurrency(net, true)}</td>
                    </tr>
                    <tr>
                        <td>æ”¶æ”¯çŠ¶æ€</td>
                        <td>${balanceStatus}</td>
                    </tr>
                    <tr>
                        <td>ç¨ç‡ä½“ç³»</td>
                        <td>
                            å†œä¸š: ${(safeNumber(taxes.å†œä¸šç¨, 0.10) * 100).toFixed(1)}% | 
                            å•†ä¸š: ${(safeNumber(taxes.å•†ä¸šç¨, 0.15) * 100).toFixed(1)}% | 
                            å·¥ä¸š: ${(safeNumber(taxes.å·¥ä¸šç¨, 0.12) * 100).toFixed(1)}%
                        </td>
                    </tr>
                </table>
            `;
            
            container.innerHTML = html;
        }
        
        // æ›´æ–°äººå£æ¦‚å†µ
        function updatePopulationOverview() {
            const container = document.getElementById('population-overview');
            if (!container) return;
            
            const population = territoryData.äººå£ || {};
            const total = safeNumber(population.æ€»äººå£, 1250);
            const races = population.ç§æ—æ„æˆ || {};
            
            // è®¡ç®—ç§æ—åˆ†å¸ƒ
            let raceHtml = '<div style="margin-top: 10px;">';
            Object.entries(races).forEach(([name, data]) => {
                if (typeof data === 'object' && data !== null) {
                    const count = safeNumber(data.æ•°é‡, 0);
                    const percentage = total > 0 ? (count / total * 100).toFixed(1) : 0;
                    const status = safeString(data.åœ°ä½, '');
                    const loyalty = data.å¿ è¯šåº¦ ? safeNumber(data.å¿ è¯šåº¦.æ•°å€¼, 65) : 65;
                    const loyaltyStatus = data.å¿ è¯šåº¦ ? safeString(data.å¿ è¯šåº¦.çŠ¶æ€, 'é¡ºä»') : 'é¡ºä»';
                    
                    raceHtml += `
                        <div style="margin-bottom: 5px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                                <span>${name}</span>
                                <span>${count}äºº (${percentage}%)</span>
                            </div>
                            <div class="progress">
                                <div class="progress-bar" style="width: ${percentage}%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 11px; color: #4A3728;">
                                <span>åœ°ä½: ${status}</span>
                                <span>å¿ è¯š: ${loyalty} (${loyaltyStatus})</span>
                            </div>
                        </div>
                    `;
                }
            });
            raceHtml += '</div>';
            
            let html = `
                <div style="margin-bottom: 15px;">
                    <div style="font-weight: bold; margin-bottom: 5px;">æ€»äººå£: ${formatNumber(total)} äºº</div>
                    <div style="font-size: 12px; color: #4A3728;">
                        äººå£å¢é•¿ç‡: ${(safeNumber(population.äººå£å¢é•¿ç‡, 0.008) * 100).toFixed(2)}%
                    </div>
                </div>
                ${raceHtml}
            `;
            
            container.innerHTML = html;
        }
        
        // æ›´æ–°å¨èƒæ¦‚å†µ
        function updateThreatOverview() {
            const container = document.getElementById('threat-overview');
            if (!container) return;
            
            const threat = territoryData.çŠ¶æ€?.å¨èƒçŠ¶æ€ || {};
            const residents = territoryData.çŠ¶æ€?.å±…æ°‘çŠ¶æ€ || {};
            
            const threatLevel = safeString(threat.å¨èƒç­‰çº§, 'è­¦æˆ’');
            const threatColor = getThreatColor(threatLevel);
            const morale = safeNumber(residents.æ°‘å¿ƒæŒ‡æ•°, 70);
            const moraleColor = getMoraleColor(morale);
            const crimeRate = safeNumber(residents.çŠ¯ç½ªç‡, 0.05) * 100;
            const epidemicRisk = safeNumber(residents.æµè¡Œç—…é£é™©, 0.1) * 100;
            
            let html = `
                <table class="data-table">
                    <tr>
                        <td style="width: 100px;">å¨èƒç­‰çº§</td>
                        <td style="color: ${threatColor}; font-weight: bold;">${threatLevel}</td>
                    </tr>
                    <tr>
                        <td>ä¸»è¦å¨èƒ</td>
                        <td>${safeString(threat.ä¸»è¦é­”ç‰©, 'å“¥å¸ƒæ—å›¢ä¼™')}</td>
                    </tr>
                    <tr>
                        <td>å¨èƒæ–¹å‘</td>
                        <td>${safeString(threat.å¨èƒæ–¹å‘, 'åŒ—é¢æ£®æ—')}</td>
                    </tr>
                    <tr>
                        <td>ç”Ÿæ´»æ°´å¹³</td>
                        <td>${safeString(residents.ç”Ÿæ´»æ°´å¹³, 'æ¸©é¥±')}</td>
                    </tr>
                    <tr>
                        <td>æ²»å®‰çŠ¶å†µ</td>
                        <td>${safeNumber(residents.æ²»å®‰çŠ¶å†µ, 65)}/100</td>
                    </tr>
                    <tr>
                        <td>çŠ¯ç½ªç‡</td>
                        <td>${crimeRate.toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>æµè¡Œç—…é£é™©</td>
                        <td>${epidemicRisk.toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>æ°‘å¿ƒæŒ‡æ•°</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="color: ${moraleColor}; font-weight: bold;">${morale}/100</span>
                                <div class="progress" style="flex: 1;">
                                    <div class="progress-bar" style="width: ${morale}%"></div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            `;
            
            container.innerHTML = html;
        }
        
        // æ›´æ–°èµ„æºé¢„è­¦
        function updateResourceWarnings() {
            const container = document.getElementById('resource-warnings');
            if (!container) return;
            
            const warehouse = territoryData.ä»“åº“ || {};
            let warnings = [];
            
            Object.values(warehouse).forEach(item => {
                if (typeof item === 'object' && item !== null) {
                    const current = safeNumber(item.å½“å‰å‚¨é‡, 0);
                    const safe = safeNumber(item.å®‰å…¨å‚¨é‡, 0);
                    if (current < safe) {
                        warnings.push({
                            name: safeString(item.åç§°, 'æœªçŸ¥'),
                            current: current,
                            safe: safe,
                            unit: safeString(item.å•ä½, '')
                        });
                    }
                }
            });
            
            if (warnings.length > 0) {
                let html = '<div class="alert alert-warning">';
                html += '<strong>âš ï¸ ç‰©èµ„é¢„è­¦</strong><br>';
                warnings.forEach(warning => {
                    html += `${warning.name}: ${warning.current}${warning.unit} (å®‰å…¨çº¿: ${warning.safe}${warning.unit})<br>`;
                });
                html += '</div>';
                container.innerHTML = html;
            } else {
                container.innerHTML = '';
            }
        }
        
        // åŠ è½½å»ºç­‘ç½‘æ ¼
        function loadBuildingsGrid() {
            const container = document.getElementById('buildings-content');
            if (!container) return;
            
            const buildings = territoryData.å»ºç­‘ || {};
            
            if (Object.keys(buildings).length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æš‚æ— å»ºç­‘æ•°æ®</div>';
                return;
            }
            
            // æŒ‰ç±»å‹åˆ†ç±»å»ºç­‘
            const buildingsByType = {};
            
            Object.entries(buildings).forEach(([key, building]) => {
                if (typeof building === 'object' && building !== null) {
                    const type = safeString(building.ç±»å‹, 'å…¶ä»–');
                    if (!buildingsByType[type]) {
                        buildingsByType[type] = [];
                    }
                    buildingsByType[type].push({ key, building });
                }
            });
            
            let html = '';
            
            // å®šä¹‰ç±»å‹å›¾æ ‡å’Œæ˜¾ç¤ºé¡ºåº
            const typeOrder = ['ç”Ÿäº§', 'å•†ä¸š', 'è¡Œæ”¿', 'å†›äº‹', 'å±…ä½', 'å†œä¸š', 'ç‰¹æ®Š'];
            const typeIcons = {
                'ç”Ÿäº§': 'ğŸ­',
                'å•†ä¸š': 'ğŸª',
                'è¡Œæ”¿': 'ğŸ›ï¸',
                'å†›äº‹': 'âš”ï¸',
                'å±…ä½': 'ğŸ ',
                'å†œä¸š': 'ğŸŒ¾',
                'ç‰¹æ®Š': 'âœ¨',
                'å…¶ä»–': 'ğŸ¢'
            };
            
            // æŒ‰é¡ºåºæ˜¾ç¤ºå„ç±»å»ºç­‘
            typeOrder.forEach(type => {
                if (buildingsByType[type] && buildingsByType[type].length > 0) {
                    html += `<div class="building-category">`;
                    html += `<div class="category-title">${typeIcons[type] || 'ğŸ¢'} ${type}å»ºç­‘ (${buildingsByType[type].length})</div>`;
                    html += `<div class="building-grid">`;
                    
                    buildingsByType[type].forEach(({ key, building }) => {
                        const name = safeString(building.åç§°, 'æœªçŸ¥å»ºç­‘');
                        const location = safeString(building.ä½ç½®, '');
                        const level = safeNumber(building.ç­‰çº§, 1);
                        const status = safeString(building.çŠ¶æ€, 'æœªçŸ¥');
                        const finance = building.ç»æµæ¨¡å‹?.è´¢åŠ¡æ±‡æ€» || {};
                        const netProfit = safeNumber(finance.æœˆå‡€æ”¶ç›Š, 0);
                        
                        // ç¡®å®šå›¾æ ‡
                        let emoji = typeIcons[type] || 'ğŸ¢';
                        if (type === 'ç”Ÿäº§' && name.includes('é“åŒ ')) emoji = 'âš’ï¸';
                        if (type === 'ç”Ÿäº§' && name.includes('ä¼æœ¨')) emoji = 'ğŸª“';
                        if (type === 'ç”Ÿäº§' && name.includes('é‡‡çŸ³')) emoji = 'â›ï¸';
                        
                        // ç¡®å®šåˆ©æ¶¦é¢œè‰²
                        let profitClass = 'profit-neutral';
                        if (netProfit > 0) profitClass = 'profit-positive';
                        if (netProfit < 0) profitClass = 'profit-negative';
                        
                        // æ ¼å¼åŒ–åˆ©æ¶¦
                        let profitText = '';
                        if (netProfit > 0) profitText = `+${formatCurrency(netProfit, false)}`;
                        else if (netProfit < 0) profitText = `${formatCurrency(netProfit, true)}`;
                        else profitText = 'æ”¶æ”¯å¹³è¡¡';
                        
                        html += `
                            <div class="building-card" onclick="openBuildingModal('${key}')">
                                <div class="building-emoji">${emoji}</div>
                                <div class="building-name">${name}</div>
                                ${location ? `<div class="building-location">ä½ç½®: ${location}</div>` : ''}
                                <div class="building-status">ç­‰çº§: ${level} | ${status}</div>
                                <div class="profit-indicator ${profitClass}">${profitText}</div>
                            </div>
                        `;
                    });
                    
                    html += `</div></div>`;
                }
            });
            
            // æ˜¾ç¤ºæœªåˆ†ç±»çš„å»ºç­‘
            Object.keys(buildingsByType).forEach(type => {
                if (!typeOrder.includes(type) && type !== 'å…¶ä»–') {
                    if (!buildingsByType[type]) return;
                    
                    html += `<div class="building-category">`;
                    html += `<div class="category-title">${typeIcons[type] || 'ğŸ¢'} ${type}å»ºç­‘ (${buildingsByType[type].length})</div>`;
                    html += `<div class="building-grid">`;
                    
                    buildingsByType[type].forEach(({ key, building }) => {
                        const name = safeString(building.åç§°, 'æœªçŸ¥å»ºç­‘');
                        const location = safeString(building.ä½ç½®, '');
                        const level = safeNumber(building.ç­‰çº§, 1);
                        const status = safeString(building.çŠ¶æ€, 'æœªçŸ¥');
                        const finance = building.ç»æµæ¨¡å‹?.è´¢åŠ¡æ±‡æ€» || {};
                        const netProfit = safeNumber(finance.æœˆå‡€æ”¶ç›Š, 0);
                        
                        let profitClass = 'profit-neutral';
                        if (netProfit > 0) profitClass = 'profit-positive';
                        if (netProfit < 0) profitClass = 'profit-negative';
                        
                        let profitText = '';
                        if (netProfit > 0) profitText = `+${formatCurrency(netProfit, false)}`;
                        else if (netProfit < 0) profitText = `${formatCurrency(netProfit, true)}`;
                        else profitText = 'æ”¶æ”¯å¹³è¡¡';
                        
                        html += `
                            <div class="building-card" onclick="openBuildingModal('${key}')">
                                <div class="building-emoji">${typeIcons[type] || 'ğŸ¢'}</div>
                                <div class="building-name">${name}</div>
                                ${location ? `<div class="building-location">ä½ç½®: ${location}</div>` : ''}
                                <div class="building-status">ç­‰çº§: ${level} | ${status}</div>
                                <div class="profit-indicator ${profitClass}">${profitText}</div>
                            </div>
                        `;
                    });
                    
                    html += `</div></div>`;
                }
            });
            
            container.innerHTML = html;
        }
        
        // åŠ è½½è§’è‰²ç½‘æ ¼
        function loadCharactersGrid() {
            const container = document.getElementById('characters-content');
            if (!container) return;
            
            const characters = territoryData.è§’è‰² || {};
            
            if (Object.keys(characters).length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æš‚æ— è§’è‰²æ•°æ®</div>';
                return;
            }
            
            let html = '<div class="character-grid">';
            
            Object.entries(characters).forEach(([key, character]) => {
                if (typeof character === 'object' && character !== null) {
                    const overview = character.è§’è‰²æ¦‚è§ˆ || {};
                    const name = safeString(character.å§“å, 'æœªçŸ¥è§’è‰²');
                    const gender = safeString(overview.æ€§åˆ«, '');
                    const identity = safeString(overview.èº«ä»½, '');
                    const location = safeString(overview.æ‰€åœ¨åœ°ç‚¹, 'æœªçŸ¥');
                    const love = safeNumber(overview.å¥½æ„Ÿåº¦, 0);
                    const loyalty = safeNumber(overview.å¿ è¯šåº¦, 0);
                    
                    // ç¡®å®šå¤´åƒ
                    let avatar = 'ğŸ‘¤';
                    if (gender === 'å¥³') avatar = 'ğŸ‘©';
                    if (gender === 'ç”·') avatar = 'ğŸ‘¨';
                    if (identity.includes('é“åŒ ')) avatar = 'âš’ï¸';
                    if (identity.includes('æˆ˜å£«')) avatar = 'ğŸ›¡ï¸';
                    if (identity.includes('å•†äºº')) avatar = 'ğŸ’°';
                    if (identity.includes('å®˜å‘˜')) avatar = 'ğŸ“‹';
                    
                    html += `
                        <div class="character-card" onclick="openCharacterModal('${key}')">
                            <div class="character-avatar">${avatar}</div>
                            <div class="character-info">
                                <div class="character-name">${name}</div>
                                <div class="character-title">${identity}</div>
                                <div class="character-location">ğŸ“ ${location}</div>
                                <div class="character-stats">
                                    <div class="stat-love">
                                        <span style="color: #e83e8c;">â¤ï¸</span>
                                        <span>${love}</span>
                                    </div>
                                    <div class="stat-loyalty">
                                        <span style="color: #ffc107;">â­</span>
                                        <span>${loyalty}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // åŠ è½½æ³•ä»¤ç½‘æ ¼
        function loadDecreesGrid() {
            const container = document.getElementById('decrees-content');
            if (!container) return;
            
            const decrees = territoryData.æ³•ä»¤ || {};
            
            if (Object.keys(decrees).length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æš‚æ— æ³•ä»¤æ•°æ®</div>';
                return;
            }
            
            let html = '<div class="decree-grid">';
            
            Object.entries(decrees).forEach(([key, decree]) => {
                if (typeof decree === 'object' && decree !== null) {
                    const name = safeString(decree.åç§°, 'æœªçŸ¥æ³•ä»¤');
                    const active = decree.ç”Ÿæ•ˆçŠ¶æ€ === true;
                    const activeTime = safeString(decree.ç”Ÿæ•ˆæ—¶é—´, 'æœªçŸ¥');
                    const description = safeString(decree.æ³•ä»¤æè¿°, '');
                    const economicEffects = decree.ç»æµæ•ˆæœ || {};
                    const socialEffects = decree.ç¤¾ä¼šæ•ˆæœ || {};
                    
                    html += `
                        <div class="decree-card" onclick="openDecreeModal('${key}')">
                            <div class="decree-header">
                                <div class="decree-name">${name}</div>
                                <div class="decree-status ${active ? 'status-active' : ''}">
                                    ${active ? 'ç”Ÿæ•ˆä¸­' : 'å·²å¤±æ•ˆ'}
                                </div>
                            </div>
                            <div class="decree-time">ç”Ÿæ•ˆæ—¶é—´: ${activeTime}</div>
                            <div class="decree-effects">
                                <div class="effect-economy">
                                    <div class="effect-title">ç»æµæ•ˆæœ</div>
                                    ${economicEffects.ç¨ç‡ä¿®æ­£ ? `<div>ç¨ç‡ä¿®æ­£: ${economicEffects.ç¨ç‡ä¿®æ­£ >= 0 ? '+' : ''}${(economicEffects.ç¨ç‡ä¿®æ­£ * 100).toFixed(1)}%</div>` : ''}
                                    ${economicEffects.å›ºå®šæ”¶å…¥ ? `<div>å›ºå®šæ”¶å…¥: ${formatCurrency(economicEffects.å›ºå®šæ”¶å…¥)}</div>` : ''}
                                    ${economicEffects.æ•ˆç‡åŠ æˆ ? `<div>æ•ˆç‡åŠ æˆ: +${(economicEffects.æ•ˆç‡åŠ æˆ * 100).toFixed(1)}%</div>` : ''}
                                    ${!economicEffects.ç¨ç‡ä¿®æ­£ && !economicEffects.å›ºå®šæ”¶å…¥ && !economicEffects.æ•ˆç‡åŠ æˆ ? '<div>æ— æ˜æ˜¾æ•ˆæœ</div>' : ''}
                                </div>
                                <div class="effect-social">
                                    <div class="effect-title">ç¤¾ä¼šæ•ˆæœ</div>
                                    ${socialEffects.æ°‘å¿ƒå½±å“ ? `<div>æ°‘å¿ƒå½±å“: ${socialEffects.æ°‘å¿ƒå½±å“ >= 0 ? '+' : ''}${socialEffects.æ°‘å¿ƒå½±å“}</div>` : ''}
                                    ${socialEffects.æ²»å®‰å½±å“ ? `<div>æ²»å®‰å½±å“: ${socialEffects.æ²»å®‰å½±å“ >= 0 ? '+' : ''}${socialEffects.æ²»å®‰å½±å“}</div>` : ''}
                                    ${socialEffects.äººå£å½±å“ ? `<div>äººå£å½±å“: ${socialEffects.äººå£å½±å“ >= 0 ? '+' : ''}${(socialEffects.äººå£å½±å“ * 100).toFixed(2)}%</div>` : ''}
                                    ${!socialEffects.æ°‘å¿ƒå½±å“ && !socialEffects.æ²»å®‰å½±å“ && !socialEffects.äººå£å½±å“ ? '<div>æ— æ˜æ˜¾æ•ˆæœ</div>' : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // åŠ è½½äººå£è¯¦æƒ…
        function loadPopulationDetails() {
            // å¹´é¾„ç»“æ„
            const ageContainer = document.getElementById('age-structure');
            if (ageContainer) {
                const ageStructure = territoryData.äººå£?.å¹´é¾„ç»“æ„ || {};
                const total = safeNumber(territoryData.äººå£?.æ€»äººå£, 1250);
                
                let html = `
                    <tr>
                        <th>å¹´é¾„æ®µ</th>
                        <th>äººæ•°</th>
                        <th>å æ¯”</th>
                        <th>è¯´æ˜</th>
                    </tr>
                `;
                
                const ageGroups = [
                    { key: 'å„¿ç«¥_0_14', label: 'å„¿ç«¥ (0-14å²)', desc: 'æœªæ¥åŠ³åŠ¨åŠ›ä¸å…µæº' },
                    { key: 'é’å¹´_15_35', label: 'é’å¹´ (15-35å²)', desc: 'ä¸»è¦åŠ³åŠ¨åŠ›ä¸å…µæº' },
                    { key: 'ä¸­å¹´_36_60', label: 'ä¸­å¹´ (36-60å²)', desc: 'ç»éªŒä¸°å¯Œçš„åŠ³åŠ¨åŠ›' },
                    { key: 'è€å¹´_60_', label: 'è€å¹´ (60å²ä»¥ä¸Š)', desc: 'éœ€è¦ä¾›å…»çš„äººå£' }
                ];
                
                ageGroups.forEach(group => {
                    let count = 0;
                    if (ageStructure[group.key] !== undefined) {
                        count = safeNumber(ageStructure[group.key], 0);
                    }
                    
                    const percentage = total > 0 ? (count / total * 100).toFixed(1) : 0;
                    
                    html += `
                        <tr>
                            <td>${group.label}</td>
                            <td>${formatNumber(count)}äºº</td>
                            <td>${percentage}%</td>
                            <td style="font-size: 11px;">${group.desc}</td>
                        </tr>
                    `;
                });
                
                ageContainer.innerHTML = html;
            }
            
            // ç§æ—è¯¦æƒ… - æ›´æ–°ä»¥åŒ…å«å¿ è¯šåº¦
            const raceContainer = document.getElementById('race-details');
            if (raceContainer) {
                const races = territoryData.äººå£?.ç§æ—æ„æˆ || {};
                const total = safeNumber(territoryData.äººå£?.æ€»äººå£, 1250);
                
                let html = `
                    <tr>
                        <th>ç§æ—</th>
                        <th>æ•°é‡</th>
                        <th>å æ¯”</th>
                        <th>åœ°ä½</th>
                        <th>å¿ è¯šåº¦</th>
                        <th>ç‰¹æ®Šèƒ½åŠ›</th>
                    </tr>
                `;
                
                Object.entries(races).forEach(([name, data]) => {
                    if (typeof data === 'object' && data !== null) {
                        const count = safeNumber(data.æ•°é‡, 0);
                        const percentage = total > 0 ? (count / total * 100).toFixed(1) : 0;
                        const status = safeString(data.åœ°ä½, '');
                        const ability = safeString(data.ç‰¹æ®Šèƒ½åŠ›, '');
                        const loyalty = data.å¿ è¯šåº¦ ? safeNumber(data.å¿ è¯šåº¦.æ•°å€¼, 65) : 65;
                        const loyaltyStatus = data.å¿ è¯šåº¦ ? safeString(data.å¿ è¯šåº¦.çŠ¶æ€, 'é¡ºä»') : 'é¡ºä»';
                        
                        let statusClass = 'tag';
                        switch(status) {
                            case 'ä¸»å¯¼': statusClass += ' tag-success'; break;
                            case 'å¹³ç­‰': statusClass += ' tag-warning'; break;
                            case 'å¥´éš¶': statusClass += ' tag-danger'; break;
                            case 'å—é™åˆ¶': statusClass += ' tag-warning'; break;
                            default: statusClass += ' tag-warning';
                        }
                        
                        let loyaltyClass = 'tag';
                        if (loyalty >= 80) loyaltyClass += ' tag-success';
                        else if (loyalty >= 60) loyaltyClass += ' tag-warning';
                        else loyaltyClass += ' tag-danger';
                        
                        html += `
                            <tr>
                                <td>${name}</td>
                                <td>${formatNumber(count)}äºº</td>
                                <td>${percentage}%</td>
                                <td><span class="${statusClass}">${status}</span></td>
                                <td><span class="${loyaltyClass}">${loyalty} (${loyaltyStatus})</span></td>
                                <td style="font-size: 11px;">${ability}</td>
                            </tr>
                        `;
                    }
                });
                
                raceContainer.innerHTML = html;
            }
            
            // èŒä¸šè¯¦æƒ…
            const occupationContainer = document.getElementById('occupation-details');
            if (occupationContainer) {
                const jobs = territoryData.äººå£?.èŒä¸šåˆ†å¸ƒ || {};
                const total = safeNumber(territoryData.äººå£?.æ€»äººå£, 1250);
                
                let html = `
                    <tr>
                        <th>èŒä¸š</th>
                        <th>äººæ•°</th>
                        <th>å æ¯”</th>
                        <th>æœˆè´¡çŒ®</th>
                        <th>æ»¡æ„åº¦</th>
                    </tr>
                `;
                
                Object.entries(jobs).forEach(([name, data]) => {
                    if (typeof data === 'object' && data !== null) {
                        const count = safeNumber(data.äººæ•°, 0);
                        const percentage = total > 0 ? (count / total * 100).toFixed(1) : 0;
                        const contribution = safeNumber(data.æœˆè´¡çŒ®, 0);
                        const satisfaction = safeNumber(data.æ»¡æ„åº¦, 0);
                        
                        const contributionColor = contribution >= 0 ? '#28a745' : '#dc3545';
                        const satisfactionColor = getMoraleColor(satisfaction);
                        
                        html += `
                            <tr>
                                <td>${name}</td>
                                <td>${formatNumber(count)}äºº</td>
                                <td>${percentage}%</td>
                                <td style="color: ${contributionColor}; font-weight: bold;">
                                    ${contribution >= 0 ? '+' : ''}${contribution}é‡‘å¸
                                </td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="color: ${satisfactionColor};">${satisfaction}/100</span>
                                        <div class="progress" style="flex: 1;">
                                            <div class="progress-bar" style="width: ${satisfaction}%"></div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        `;
                    }
                });
                
                occupationContainer.innerHTML = html;
            }
            
            // æ»¡æ„åº¦ç»´åº¦
            const satisfactionContainer = document.getElementById('satisfaction-details');
            if (satisfactionContainer) {
                const satisfaction = territoryData.äººå£?.æ»¡æ„åº¦ç»´åº¦ || {};
                
                let html = `
                    <tr>
                        <th>æ»¡æ„åº¦ç»´åº¦</th>
                        <th>æ•°å€¼</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                `;
                
                const satisfactionItems = [
                    { key: 'é£Ÿç‰©æ»¡æ„åº¦', label: 'é£Ÿç‰©' },
                    { key: 'ä½æˆ¿æ»¡æ„åº¦', label: 'ä½æˆ¿' },
                    { key: 'å®‰å…¨æ»¡æ„åº¦', label: 'å®‰å…¨' },
                    { key: 'å¨±ä¹æ»¡æ„åº¦', label: 'å¨±ä¹' },
                    { key: 'ç¨æ”¶æ»¡æ„åº¦', label: 'ç¨æ”¶' },
                    { key: 'å·¥ä½œæ»¡æ„åº¦', label: 'å·¥ä½œ' },
                    { key: 'æ•™è‚²æ»¡æ„åº¦', label: 'æ•™è‚²' },
                    { key: 'åŒ»ç–—æ»¡æ„åº¦', label: 'åŒ»ç–—' }
                ];
                
                satisfactionItems.forEach(item => {
                    const value = safeNumber(satisfaction[item.key], 0);
                    const color = getMoraleColor(value);
                    const status = value > 70 ? 'è‰¯å¥½' : value > 40 ? 'ä¸€èˆ¬' : 'è¾ƒå·®';
                    
                    html += `
                        <tr>
                            <td>${item.label}</td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="color: ${color};">${value}/100</span>
                                    <div class="progress" style="flex: 1;">
                                        <div class="progress-bar" style="width: ${value}%"></div>
                                    </div>
                                </div>
                            </td>
                            <td style="color: ${color};">${status}</td>
                        </tr>
                    `;
                });
                
                satisfactionContainer.innerHTML = html;
            }
        }
        
        // åŠ è½½ç»æµè¯¦æƒ…
        function loadEconomyDetails() {
            // è´¢æ”¿è¯¦æƒ… - æ›´æ–°ä»¥åæ˜ æ–°çš„æ”¶å…¥ç»“æ„
            const financeContainer = document.getElementById('finance-details');
            if (financeContainer) {
                const finance = territoryData.ç»æµ?.è´¢æ”¿ || {};
                
                const lordIncome = safeNumber(finance.é¢†ä¸»èµ„äº§_æœˆæ”¶å…¥, 0);
                const lordExpense = safeNumber(finance.é¢†ä¸»èµ„äº§_æœˆæ”¯å‡º, 0);
                const privateTaxable = safeNumber(finance.ç§æœ‰èµ„äº§_åº”ç¨æ”¶å…¥, 0);
                const privateTaxRate = safeNumber(finance.ç§æœ‰èµ„äº§ç¨ç‡, 0.15);
                const privateTax = safeNumber(finance.ç§æœ‰èµ„äº§_ç¨æ”¶, privateTaxable * privateTaxRate);
                const specialIncome = safeNumber(finance.ç‰¹æ®Šæ”¶æ”¯, 0);
                
                const totalIncome = safeNumber(finance.æœˆæ€»æ”¶å…¥, lordIncome + privateTax + specialIncome);
                const expense = safeNumber(finance.æœˆæ€»æ”¯å‡º, lordExpense);
                const net = safeNumber(finance.æœˆå‡€æ”¶å…¥, totalIncome - expense);
                const treasury = safeNumber(finance.åº“å­˜é‡‘å¸, 2500);
                const balanceStatus = safeString(finance.æ”¶æ”¯çŠ¶æ€, net >= 0 ? 'ğŸ“ˆç›ˆä½™' : 'ğŸ“‰äºæŸ');
                
                const netColor = net >= 0 ? '#28a745' : '#dc3545';
                const balanceColor = balanceStatus.includes('ç›ˆä½™') ? '#28a745' : 
                                    balanceStatus.includes('äºæŸ') ? '#dc3545' : '#ffc107';
                
                let html = `
                    <tr>
                        <td>å›½åº“èµ„é‡‘</td>
                        <td style="font-weight: bold; color: #ffc107;">${formatCurrency(treasury)}</td>
                    </tr>
                    <tr>
                        <td colspan="2" style="background: #f8f9fa; font-weight: bold;">æ”¶å…¥æ„æˆ</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 20px;">é¢†ä¸»èµ„äº§æ”¶å…¥</td>
                        <td style="color: #28a745;">${formatCurrency(lordIncome)}</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 20px;">ç§æœ‰èµ„äº§ç¨æ”¶</td>
                        <td style="color: #28a745;">${formatCurrency(privateTax)}</td>
                    </tr>
                    <tr>
                        <td style="padding-left: 20px;">ç‰¹æ®Šæ”¶æ”¯</td>
                        <td style="color: ${specialIncome >= 0 ? '#28a745' : '#dc3545'};">${formatCurrency(specialIncome, true)}</td>
                    </tr>
                    <tr>
                        <td>æœˆæ€»æ”¶å…¥</td>
                        <td style="color: #28a745; font-weight: bold;">${formatCurrency(totalIncome)}</td>
                    </tr>
                    <tr>
                        <td>æœˆæ€»æ”¯å‡º</td>
                        <td style="color: #dc3545;">${formatCurrency(expense)}</td>
                    </tr>
                    <tr>
                        <td>æœˆå‡€æ”¶å…¥</td>
                        <td style="color: ${netColor}; font-weight: bold;">${formatCurrency(net, true)}</td>
                    </tr>
                    <tr>
                        <td>æ”¶æ”¯çŠ¶æ€</td>
                        <td style="color: ${balanceColor};">${balanceStatus}</td>
                    </tr>
                `;
                
                financeContainer.innerHTML = html;
            }
            
            // ç¨æ”¶è¯¦æƒ…
            const taxContainer = document.getElementById('tax-details');
            if (taxContainer) {
                const taxes = territoryData.ç»æµ?.å…¬å…±ç¨ç‡ || {};
                const finance = territoryData.ç»æµ?.è´¢æ”¿ || {};
                const privateTaxRate = safeNumber(finance.ç§æœ‰èµ„äº§ç¨ç‡, 0.15);
                
                let html = `
                    <tr>
                        <th>ç¨ç§</th>
                        <th>ç¨ç‡</th>
                    </tr>
                    <tr>
                        <td>å†œä¸šç¨</td>
                        <td>${(safeNumber(taxes.å†œä¸šç¨, 0.10) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>å•†ä¸šç¨</td>
                        <td>${(safeNumber(taxes.å•†ä¸šç¨, 0.15) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>å·¥ä¸šç¨</td>
                        <td>${(safeNumber(taxes.å·¥ä¸šç¨, 0.12) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>ä¸ªäººæ‰€å¾—ç¨</td>
                        <td>${(safeNumber(taxes.ä¸ªäººæ‰€å¾—ç¨, 0.05) * 100).toFixed(1)}%</td>
                    </tr>
                    <tr>
                        <td>ç§æœ‰èµ„äº§ç¨ç‡</td>
                        <td>${(privateTaxRate * 100).toFixed(1)}%</td>
                    </tr>
                `;
                
                taxContainer.innerHTML = html;
            }
            
            // ç‰©ä»·æŒ‡æ•°
            const priceContainer = document.getElementById('price-index');
            if (priceContainer) {
                const prices = territoryData.ç»æµ?.ç‰©ä»·æŒ‡æ•° || {};
                
                let html = `
                    <tr>
                        <th>ç‰©èµ„</th>
                        <th>å•ä»·</th>
                    </tr>
                `;
                
                Object.entries(prices).forEach(([name, value]) => {
                    const price = safeNumber(value, 0);
                    html += `
                        <tr>
                            <td>${name}</td>
                            <td>${formatCurrency(price)}</td>
                        </tr>
                    `;
                });
                
                priceContainer.innerHTML = html;
            }
        }
        
        // åŠ è½½èµ„æºè¯¦æƒ…
        function loadResourcesDetails() {
            // ä»“åº“ç‰©èµ„
            const warehouseContainer = document.getElementById('warehouse-details');
            if (warehouseContainer) {
                const warehouse = territoryData.ä»“åº“ || {};
                
                let html = `
                    <tr>
                        <th>èµ„æº</th>
                        <th>å½“å‰å‚¨é‡</th>
                        <th>å®‰å…¨å‚¨é‡</th>
                        <th>çŠ¶æ€</th>
                        <th>å•ä½</th>
                        <th>å•ä»·</th>
                    </tr>
                `;
                
                Object.entries(warehouse).forEach(([key, item]) => {
                    if (typeof item === 'object' && item !== null) {
                        const current = safeNumber(item.å½“å‰å‚¨é‡, 0);
                        const safe = safeNumber(item.å®‰å…¨å‚¨é‡, 0);
                        const unit = safeString(item.å•ä½, '');
                        const name = safeString(item.åç§°, 'æœªçŸ¥');
                        const price = safeNumber(item.å¸‚åœºä»·æ ¼, 0);
                        const status = current >= safe ? 'å……è¶³' : 'ä¸è¶³';
                        const statusColor = current >= safe ? '#28a745' : '#dc3545';
                        
                        html += `
                            <tr>
                                <td>${name}</td>
                                <td>${formatNumber(current)}</td>
                                <td>${formatNumber(safe)}</td>
                                <td style="color: ${statusColor}; font-weight: bold;">${status}</td>
                                <td>${unit}</td>
                                <td>${formatCurrency(price)}</td>
                            </tr>
                        `;
                    }
                });
                
                warehouseContainer.innerHTML = html;
            }
            
            // è‡ªç„¶èµ„æº
            const naturalContainer = document.getElementById('natural-resources');
            if (naturalContainer) {
                const resources = territoryData.èµ„æºåŠ¨æ€ || {};
                
                let html = `
                    <tr>
                        <th>èµ„æºç±»å‹</th>
                        <th>å¼€é‡‡é‡</th>
                        <th>å¼€é‡‡éš¾åº¦</th>
                        <th>çŸ¿çŸ³å“è´¨</th>
                    </tr>
                `;
                
                Object.entries(resources).forEach(([name, data]) => {
                    if (typeof data === 'object' && data !== null) {
                        const extraction = safeNumber(data.æ¯æœˆå¼€é‡‡é‡, 0);
                        const difficulty = safeNumber(data.å¼€é‡‡éš¾åº¦, 0.5);
                        const quality = safeNumber(data.çŸ¿çŸ³å“è´¨, 0.7);
                        
                        html += `
                            <tr>
                                <td>${name}</td>
                                <td>${formatNumber(extraction)}/æœˆ</td>
                                <td>${(difficulty * 100).toFixed(0)}%</td>
                                <td>${(quality * 100).toFixed(0)}%</td>
                            </tr>
                        `;
                    }
                });
                
                naturalContainer.innerHTML = html;
            }
            
            // ç¯å¢ƒçŠ¶å†µ
            const environmentContainer = document.getElementById('environment-details');
            if (environmentContainer) {
                const environment = territoryData.ç¯å¢ƒ || {};
                const seasonEffects = environment.å­£èŠ‚å½±å“ || {};
                
                let html = `
                    <tr>
                        <th>æŒ‡æ ‡</th>
                        <th>æ•°å€¼</th>
                        <th>è¯´æ˜</th>
                    </tr>
                    <tr>
                        <td>å¤©æ°”çŠ¶å†µ</td>
                        <td>${safeString(environment.å¤©æ°”çŠ¶å†µ, 'æ™´æœ—')}</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>æ¸©åº¦</td>
                        <td>${safeNumber(environment.æ¸©åº¦, 15)}Â°C</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>é™æ°´</td>
                        <td>${safeString(environment.é™æ°´, 'é€‚ä¸­')}</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>è‡ªç„¶ç¾å®³é£é™©</td>
                        <td>${(safeNumber(environment.è‡ªç„¶ç¾å®³é£é™©, 0.1) * 100).toFixed(1)}%</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>å†œä¸šäº§å‡ºä¿®æ­£</td>
                        <td>${safeNumber(seasonEffects.å†œä¸šäº§å‡ºä¿®æ­£, 1.2).toFixed(2)}</td>
                        <td>å­£èŠ‚å¯¹å†œä¸šçš„å½±å“</td>
                    </tr>
                    <tr>
                        <td>å•†ä¸šæ´»åŠ¨ä¿®æ­£</td>
                        <td>${safeNumber(seasonEffects.å•†ä¸šæ´»åŠ¨ä¿®æ­£, 1.0).toFixed(2)}</td>
                        <td>å­£èŠ‚å¯¹å•†ä¸šçš„å½±å“</td>
                    </tr>
                    <tr>
                        <td>å†›äº‹è¡ŒåŠ¨ä¿®æ­£</td>
                        <td>${safeNumber(seasonEffects.å†›äº‹è¡ŒåŠ¨ä¿®æ­£, 0.9).toFixed(2)}</td>
                        <td>å­£èŠ‚å¯¹å†›äº‹çš„å½±å“</td>
                    </tr>
                    <tr>
                        <td>èµ„æºé‡‡é›†ä¿®æ­£</td>
                        <td>${safeNumber(seasonEffects.èµ„æºé‡‡é›†ä¿®æ­£, 1.1).toFixed(2)}</td>
                        <td>å­£èŠ‚å¯¹èµ„æºé‡‡é›†çš„å½±å“</td>
                    </tr>
                `;
                
                environmentContainer.innerHTML = html;
            }
        }
        
        // åŠ è½½å†›äº‹è¯¦æƒ…
        function loadMilitaryDetails() {
            // å…µåŠ›çŠ¶å†µ
            const militaryContainer = document.getElementById('military-details');
            if (militaryContainer) {
                const military = territoryData.å†›äº‹ || {};
                const troops = military.å…µåŠ› || {};
                const ratings = military.æˆ˜åŠ›è¯„çº§ || {};
                
                let html = `
                    <tr>
                        <th>éƒ¨é˜Ÿç±»å‹</th>
                        <th>æ•°é‡</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                    <tr>
                        <td>å¸¸å¤‡å†›</td>
                        <td>${safeNumber(troops.å¸¸å¤‡å†›, 80)}äºº</td>
                        <td>å¸¸è§„é˜²å¾¡åŠ›é‡</td>
                    </tr>
                    <tr>
                        <td>æ°‘å…µ</td>
                        <td>${safeNumber(troops.æ°‘å…µ, 200)}äºº</td>
                        <td>åå¤‡åŠ›é‡</td>
                    </tr>
                    <tr>
                        <td>ç²¾é”éƒ¨é˜Ÿ</td>
                        <td>${safeNumber(troops.ç²¾é”éƒ¨é˜Ÿ, 0)}äºº</td>
                        <td>æ ¸å¿ƒæˆ˜åŠ›</td>
                    </tr>
                    <tr>
                        <td colspan="3" style="background: #f8f9fa; font-weight: bold;">æˆ˜åŠ›è¯„çº§</td>
                    </tr>
                    <tr>
                        <td>æ€»è¯„çº§</td>
                        <td style="font-weight: bold; color: #8B6914;">${safeString(ratings.æ€»è¯„çº§, 'D')}</td>
                        <td>ç»¼åˆæˆ˜åŠ›è¯„ä»·</td>
                    </tr>
                    <tr>
                        <td>é¢†ä¸»æˆ˜åŠ›</td>
                        <td style="font-weight: bold;">${safeString(ratings.é¢†ä¸»æˆ˜åŠ›, 'B')}</td>
                        <td>é¢†ä¸»ä¸ªäººæˆ˜åŠ›</td>
                    </tr>
                    <tr>
                        <td>å†›é˜Ÿæˆ˜åŠ›</td>
                        <td style="font-weight: bold;">${safeString(ratings.å†›é˜Ÿæˆ˜åŠ›, 'E')}</td>
                        <td>å†›é˜Ÿæ•´ä½“æˆ˜åŠ›</td>
                    </tr>
                    <tr>
                        <td>é˜²å¾¡è¯„çº§</td>
                        <td style="font-weight: bold;">${safeString(ratings.é˜²å¾¡è¯„çº§, 'D+')}</td>
                        <td>é˜²å¾¡è®¾æ–½è¯„çº§</td>
                    </tr>
                `;
                
                militaryContainer.innerHTML = html;
            }
            
            // è£…å¤‡çŠ¶æ€
            const equipmentContainer = document.getElementById('equipment-details');
            if (equipmentContainer) {
                const equipment = territoryData.å†›äº‹?.è£…å¤‡çŠ¶æ€ || {};
                
                const equipmentRate = safeNumber(equipment.è£…å¤‡å®Œæ•´ç‡, 0.65) * 100;
                const trainingLevel = safeNumber(equipment.è®­ç»ƒæ°´å¹³, 0.5) * 100;
                const morale = safeNumber(equipment.å£«æ°”, 70);
                
                const equipmentColor = equipmentRate > 70 ? '#28a745' : equipmentRate > 40 ? '#ffc107' : '#dc3545';
                const trainingColor = trainingLevel > 70 ? '#28a745' : trainingLevel > 40 ? '#ffc107' : '#dc3545';
                const moraleColor = getMoraleColor(morale);
                
                let html = `
                    <tr>
                        <th>æŒ‡æ ‡</th>
                        <th>æ•°å€¼</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                    <tr>
                        <td>è£…å¤‡å®Œæ•´ç‡</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="color: ${equipmentColor};">${equipmentRate.toFixed(0)}%</span>
                                <div class="progress" style="flex: 1;">
                                    <div class="progress-bar" style="width: ${equipmentRate}%"></div>
                                </div>
                            </div>
                        </td>
                        <td>${equipmentRate > 70 ? 'è‰¯å¥½' : equipmentRate > 40 ? 'ä¸€èˆ¬' : 'è¾ƒå·®'}</td>
                    </tr>
                    <tr>
                        <td>è®­ç»ƒæ°´å¹³</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="color: ${trainingColor};">${trainingLevel.toFixed(0)}%</span>
                                <div class="progress" style="flex: 1;">
                                    <div class="progress-bar" style="width: ${trainingLevel}%"></div>
                                </div>
                            </div>
                        </td>
                        <td>${trainingLevel > 70 ? 'ç²¾é”' : trainingLevel > 40 ? 'åˆæ ¼' : 'æ–°å…µ'}</td>
                    </tr>
                    <tr>
                        <td>å†›é˜Ÿå£«æ°”</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="color: ${moraleColor};">${morale}/100</span>
                                <div class="progress" style="flex: 1;">
                                    <div class="progress-bar" style="width: ${morale}%"></div>
                                </div>
                            </div>
                        </td>
                        <td>${morale > 70 ? 'é«˜æ˜‚' : morale > 40 ? 'ä¸€èˆ¬' : 'ä½è½'}</td>
                    </tr>
                `;
                
                equipmentContainer.innerHTML = html;
            }
            
            // é˜²å¾¡è®¾æ–½
            const defenseContainer = document.getElementById('defense-details');
            if (defenseContainer) {
                const defense = territoryData.å†›äº‹?.é˜²å¾¡è®¾æ–½ || {};
                
                const wallIntegrity = safeNumber(defense.åŸå¢™å®Œæ•´åº¦, 0.7) * 100;
                const towers = safeNumber(defense.ç­æœ›å¡”æ•°é‡, 2);
                const gates = safeString(defense.åŸé—¨çŠ¶æ€, 'å®Œå¥½');
                const moat = safeString(defense.æŠ¤åŸæ²³, 'æ— ');
                
                const wallColor = wallIntegrity > 80 ? '#28a745' : wallIntegrity > 50 ? '#ffc107' : '#dc3545';
                const gateColor = gates.includes('å®Œå¥½') ? '#28a745' : gates.includes('å—æŸ') ? '#ffc107' : '#dc3545';
                
                let html = `
                    <tr>
                        <th>è®¾æ–½</th>
                        <th>çŠ¶æ€</th>
                        <th>è¯´æ˜</th>
                    </tr>
                    <tr>
                        <td>åŸå¢™å®Œæ•´åº¦</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="color: ${wallColor};">${wallIntegrity.toFixed(0)}%</span>
                                <div class="progress" style="flex: 1;">
                                    <div class="progress-bar" style="width: ${wallIntegrity}%"></div>
                                </div>
                            </div>
                        </td>
                        <td>${wallIntegrity > 80 ? 'åšå›º' : wallIntegrity > 50 ? 'ä¸€èˆ¬' : 'éœ€è¦ç»´ä¿®'}</td>
                    </tr>
                    <tr>
                        <td>ç­æœ›å¡”æ•°é‡</td>
                        <td>${towers}åº§</td>
                        <td>${towers > 3 ? 'å……è¶³' : towers > 1 ? 'åŸºæœ¬' : 'ä¸è¶³'}</td>
                    </tr>
                    <tr>
                        <td>åŸé—¨çŠ¶æ€</td>
                        <td style="color: ${gateColor}; font-weight: bold;">${gates}</td>
                        <td>${gates.includes('å®Œå¥½') ? 'é˜²å¾¡æ­£å¸¸' : 'éœ€è¦å…³æ³¨'}</td>
                    </tr>
                    <tr>
                        <td>æŠ¤åŸæ²³</td>
                        <td>${moat}</td>
                        <td>${moat === 'æ— ' ? 'éœ€è€ƒè™‘å»ºè®¾' : 'æä¾›é¢å¤–é˜²å¾¡'}</td>
                    </tr>
                `;
                
                defenseContainer.innerHTML = html;
            }
        }
        
        // åŠ è½½ç§‘æŠ€è¯¦æƒ…
        function loadTechnologyDetails() {
            const container = document.getElementById('technology-list');
            if (!container) return;
            
            const techs = territoryData.ç§‘æŠ€ || {};
            
            if (Object.keys(techs).length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æš‚æ— ç§‘æŠ€æ•°æ®</div>';
                return;
            }
            
            let html = '';
            
            Object.entries(techs).forEach(([key, tech]) => {
                if (typeof tech === 'object' && tech !== null) {
                    const name = safeString(tech.åç§°, 'æœªçŸ¥ç§‘æŠ€');
                    const status = safeString(tech.ç ”å‘çŠ¶æ€, 'æœªç ”å‘');
                    const progress = safeNumber(tech.å½“å‰è¿›åº¦, 0);
                    const effectDesc = safeString(tech.æ•ˆæœæè¿°, 'æ— ');
                    const effects = tech.å…·ä½“æ•ˆæœ || {};
                    const economicEffects = effects.ç»æµæ•ˆæœ || {};
                    const militaryEffects = effects.å†›äº‹æ•ˆæœ || {};
                    const socialEffects = effects.ç¤¾ä¼šæ•ˆæœ || {};
                    
                    let statusColor, statusText;
                    switch(status) {
                        case 'å·²ç ”å‘':
                            statusColor = '#28a745';
                            statusText = 'å·²å®Œæˆ';
                            break;
                        case 'ç ”å‘ä¸­':
                            statusColor = '#ffc107';
                            statusText = 'è¿›è¡Œä¸­';
                            break;
                        default:
                            statusColor = '#6c757d';
                            statusText = 'æœªå¼€å§‹';
                    }
                    
                    html += `
                        <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #8B6914; border-radius: 5px; background: rgba(255, 255, 255, 0.8);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span style="font-weight: bold; font-size: 13px;">${name}</span>
                                <span class="tag" style="background: ${statusColor}; color: white; padding: 2px 8px; border-radius: 10px; font-size: 11px;">
                                    ${statusText}
                                </span>
                            </div>
                            
                            <div style="margin-top: 5px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 3px;">
                                    <span>ç ”å‘è¿›åº¦</span>
                                    <span>${progress}%</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" style="width: ${progress}%; background: ${statusColor};"></div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 8px; font-size: 11px; color: #4A3728;">
                                ${effectDesc}
                            </div>
                            
                            <div style="display: flex; font-size: 11px; border-top: 1px solid #eee; padding-top: 8px;">
                                <div style="flex: 1; padding-right: 10px;">
                                    <div style="font-weight: bold; color: #28a745; margin-bottom: 3px;">ç»æµæ•ˆæœ</div>
                                    ${economicEffects.æ”¶å…¥åŠ æˆ ? `<div>æ”¶å…¥åŠ æˆ: +${(economicEffects.æ”¶å…¥åŠ æˆ * 100).toFixed(0)}%</div>` : ''}
                                    ${economicEffects.æ•ˆç‡æå‡ ? `<div>æ•ˆç‡æå‡: +${(economicEffects.æ•ˆç‡æå‡ * 100).toFixed(0)}%</div>` : ''}
                                    ${economicEffects.æˆæœ¬é™ä½ ? `<div>æˆæœ¬é™ä½: ${(economicEffects.æˆæœ¬é™ä½ * 100).toFixed(0)}%</div>` : ''}
                                    ${!economicEffects.æ”¶å…¥åŠ æˆ && !economicEffects.æ•ˆç‡æå‡ && !economicEffects.æˆæœ¬é™ä½ ? '<div>æ— </div>' : ''}
                                </div>
                                <div style="flex: 1; padding: 0 10px; border-left: 1px solid #eee; border-right: 1px solid #eee;">
                                    <div style="font-weight: bold; color: #dc3545; margin-bottom: 3px;">å†›äº‹æ•ˆæœ</div>
                                    ${militaryEffects.æˆ˜åŠ›æå‡ ? `<div>æˆ˜åŠ›æå‡: +${(militaryEffects.æˆ˜åŠ›æå‡ * 100).toFixed(0)}%</div>` : ''}
                                    ${militaryEffects.è®­ç»ƒæ•ˆç‡ ? `<div>è®­ç»ƒæ•ˆç‡: +${(militaryEffects.è®­ç»ƒæ•ˆç‡ * 100).toFixed(0)}%</div>` : ''}
                                    ${militaryEffects.è£…å¤‡è´¨é‡ ? `<div>è£…å¤‡è´¨é‡: +${(militaryEffects.è£…å¤‡è´¨é‡ * 100).toFixed(0)}%</div>` : ''}
                                    ${!militaryEffects.æˆ˜åŠ›æå‡ && !militaryEffects.è®­ç»ƒæ•ˆç‡ && !militaryEffects.è£…å¤‡è´¨é‡ ? '<div>æ— </div>' : ''}
                                </div>
                                <div style="flex: 1; padding-left: 10px;">
                                    <div style="font-weight: bold; color: #ffc107; margin-bottom: 3px;">ç¤¾ä¼šæ•ˆæœ</div>
                                    ${socialEffects.æ°‘å¿ƒå½±å“ ? `<div>æ°‘å¿ƒ: ${socialEffects.æ°‘å¿ƒå½±å“ >= 0 ? '+' : ''}${socialEffects.æ°‘å¿ƒå½±å“}</div>` : ''}
                                    ${socialEffects.æ²»å®‰å½±å“ ? `<div>æ²»å®‰: ${socialEffects.æ²»å®‰å½±å“ >= 0 ? '+' : ''}${socialEffects.æ²»å®‰å½±å“}</div>` : ''}
                                    ${socialEffects.äººå£å½±å“ ? `<div>äººå£å¢é•¿: ${socialEffects.äººå£å½±å“ >= 0 ? '+' : ''}${(socialEffects.äººå£å½±å“ * 100).toFixed(2)}%</div>` : ''}
                                    ${!socialEffects.æ°‘å¿ƒå½±å“ && !socialEffects.æ²»å®‰å½±å“ && !socialEffects.äººå£å½±å“ ? '<div>æ— </div>' : ''}
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        // åŠ è½½ç³»ç»Ÿè¯¦æƒ…
        function loadSystemDetails() {

           
            
            // ç³»ç»Ÿè®¾ç½®
            const systemContainer = document.getElementById('system-details');
            if (systemContainer) {
                const system = territoryData.System || {};
                
                let html = `
                    <tr>
                        <th>è®¾ç½®é¡¹</th>
                        <th>å€¼</th>
                        <th>è¯´æ˜</th>
                    </tr>
                    <tr>
                        <td>å½“å‰æ¸¸æˆæ—¶é—´</td>
                        <td>${safeString(system.å½“å‰æ¸¸æˆæ—¶é—´, 'ç¬¬1å¹´ 1æœˆ')}</td>
                        <td>æ¸¸æˆå†…æ—¶é—´</td>
                    </tr>
                    <tr>
                        <td>å½“å‰å­£èŠ‚</td>
                        <td>${safeString(system.å½“å‰å­£èŠ‚, 'æ˜¥å­£')}</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>ä¸Šæ¬¡ç»“ç®—æ—¶é—´</td>
                        <td>${safeString(system.ä¸Šæ¬¡ç»“ç®—æ—¶é—´, 'ç¬¬1å¹´ 1æœˆ')}</td>
                        <td>æœ€åä¸€æ¬¡æœˆåº¦ç»“ç®—</td>
                    </tr>
                    <tr>
                        <td>è‡ªåŠ¨ç»“ç®—å¼€å…³</td>
                        <td>${system.è‡ªåŠ¨ç»“ç®—å¼€å…³ ? 'å¼€å¯' : 'å…³é—­'}</td>
                        <td>è‡ªåŠ¨æ‰§è¡Œæœˆåº¦ç»“ç®—</td>
                    </tr>
                    <tr>
                        <td>æ•°æ®æ›´æ–°</td>
                        <td>${lastUpdate ? lastUpdate.toLocaleString() : 'ä»æœª'}</td>
                        <td>æœ€åä¸€æ¬¡æ•°æ®æ›´æ–°</td>
                    </tr>
                    <tr>
                        <td>è‡ªåŠ¨åˆ·æ–°</td>
                        <td>${autoRefreshEnabled ? 'å¼€å¯' : 'å…³é—­'}</td>
                        <td>è‡ªåŠ¨åˆ·æ–°æ•°æ®</td>
                    </tr>
                `;
                
                systemContainer.innerHTML = html;
            }
        }
         // åŠ è½½å¤–äº¤æ¦‚è§ˆ
function loadDiplomacyOverview() {
    const container = document.getElementById('diplomacy-overview');
    if (!container) return;
    
    const diplomacy = territoryData.Diplomacy || {};
    const global = diplomacy.å…¨å±€çŠ¶æ€ || {};
    
    const focus = safeString(global.å¤–äº¤ç„¦ç‚¹, '');
    const recentEvent = safeString(global.æœ€è¿‘äº‹ä»¶, '');
    const specialStatus = safeString(global.ç‰¹æ®ŠçŠ¶æ€, '');
    const monthlyBalance = safeNumber(global.æœˆåº¦å¤–äº¤æ”¶æ”¯, 0);
    
    let html = `
        <table class="data-table">
            <tr>
                <td style="width: 100px;">å¤–äº¤ç„¦ç‚¹</td>
                <td>${focus}</td>
            </tr>
            <tr>
                <td>æœ€è¿‘äº‹ä»¶</td>
                <td>${recentEvent}</td>
            </tr>
            <tr>
                <td>ç‰¹æ®ŠçŠ¶æ€</td>
                <td>${specialStatus}</td>
            </tr>
            <tr>
                <td>æœˆåº¦å¤–äº¤æ”¶æ”¯</td>
                <td style="color: ${monthlyBalance >= 0 ? '#28a745' : '#dc3545'};">${formatCurrency(monthlyBalance, true)}</td>
            </tr>
        </table>
    `;
    
    container.innerHTML = html;
}

// åŠ è½½åŠ¿åŠ›å…³ç³»
function loadDiplomacyRelations() {
    const container = document.getElementById('diplomacy-relations');
    if (!container) return;
    
    const diplomacy = territoryData.Diplomacy || {};
    const relations = diplomacy.åŠ¿åŠ›å…³ç³» || {};
    
    if (Object.keys(relations).length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æš‚æ— å¤–äº¤å…³ç³»æ•°æ®</div>';
        return;
    }
    
    let html = '';
    
    Object.entries(relations).forEach(([key, relation]) => {
        if (typeof relation === 'object' && relation !== null) {
            const name = safeString(relation.åç§°, 'æœªçŸ¥åŠ¿åŠ›');
            const leader = safeString(relation.é¢†è¢–, '');
            const attitude = safeString(relation.æ€åº¦, 'ä¸­ç«‹');
            const relationValue = safeNumber(relation.å…³ç³»å€¼, 0);
            const strength = safeString(relation.å®åŠ›å¯¹æ¯”, '');
            const recentMove = safeString(relation.è¿‘æœŸåŠ¨å‘, '');
            const treaties = relation.ç°æœ‰æ¡çº¦ || {};
            
            // å…³ç³»å€¼é¢œè‰²
            let relationColor = '#6c757d';
            if (relationValue > 50) relationColor = '#28a745';
            else if (relationValue > 20) relationColor = '#20c997';
            else if (relationValue > -20) relationColor = '#ffc107';
            else if (relationValue > -50) relationColor = '#fd7e14';
            else relationColor = '#dc3545';
            
            // æ€åº¦æ ‡ç­¾
            let attitudeClass = 'tag';
            switch(attitude) {
                case 'æ•Œå¯¹': attitudeClass += ' tag-danger'; break;
                case 'å†·æ·¡': attitudeClass += ' tag-warning'; break;
                case 'ä¸­ç«‹': attitudeClass += ' tag-secondary'; break;
                case 'å‹å–„': attitudeClass += ' tag-success'; break;
                case 'ç›Ÿçº¦': attitudeClass += ' tag-primary'; break;
                case 'è‡£æœ(äºæˆ‘)': attitudeClass += ' tag-info'; break;
                case 'å®—ä¸»(äºæˆ‘)': attitudeClass += ' tag-dark'; break;
                default: attitudeClass += ' tag-secondary';
            }
            
            html += `
                <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #8B6914; border-radius: 5px; background: rgba(255, 255, 255, 0.8);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div style="font-size: 18px; font-weight: bold;">${name}</div>
                        <div>
                            <span class="${attitudeClass}" style="margin-right: 10px;">${attitude}</span>
                            <span style="color: ${relationColor}; font-weight: bold;">${relationValue}</span>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 10px; font-size: 12px;">
                        <div><strong>é¢†è¢–:</strong> ${leader}</div>
                        <div><strong>å®åŠ›å¯¹æ¯”:</strong> ${strength}</div>
                    </div>
                    
                    <div style="margin-bottom: 15px;">
                        <div><strong>è¿‘æœŸåŠ¨å‘:</strong> ${recentMove}</div>
                    </div>
                    
                    <div>
                        <div style="font-weight: bold; margin-bottom: 8px;">ç°æœ‰æ¡çº¦:</div>
            `;
            
            if (Object.keys(treaties).length === 0) {
                html += `<div style="font-size: 12px; color: #6c757d;">æ— æ­£å¼æ¡çº¦</div>`;
            } else {
                Object.entries(treaties).forEach(([treatyKey, treaty]) => {
                    const treatyType = safeString(treaty.æ¡çº¦ç±»å‹, '');
                    const signTime = safeString(treaty.ç­¾è®¢æ—¶é—´, '');
                    const mainContent = safeString(treaty.ä¸»è¦å†…å®¹, '');
                    const validity = safeString(treaty.æœ‰æ•ˆæœŸ, '');
                    const financialImpact = safeNumber(treaty.æ”¶æ”¯å½±å“, 0);
                    
                    html += `
                        <div style="margin-bottom: 10px; padding: 10px; border-left: 3px solid #8B6914; background: rgba(139, 105, 20, 0.05);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                <span style="font-weight: bold;">${treatyType}</span>
                                <span style="color: ${financialImpact >= 0 ? '#28a745' : '#dc3545'};">${formatCurrency(financialImpact, true)}/æœˆ</span>
                            </div>
                            <div style="font-size: 11px; color: #4A3728; margin-bottom: 3px;">${mainContent}</div>
                            <div style="display: flex; justify-content: space-between; font-size: 11px;">
                                <span>ç­¾è®¢: ${signTime}</span>
                                <span>æœ‰æ•ˆæœŸ: ${validity}</span>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `</div></div>`;
        }
    });
    
    container.innerHTML = html;
}

// åŠ è½½ä½¿è€…ä¿¡æ¯
function loadDiplomacyEnvoys() {
    const container = document.getElementById('diplomacy-envoys');
    if (!container) return;
    
    const diplomacy = territoryData.Diplomacy || {};
    const envoys = diplomacy.ä½¿è€…ä¿¡æ¯ || {};
    
    if (Object.keys(envoys).length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æš‚æ— ä½¿è€…ä¿¡æ¯</div>';
        return;
    }
    
    let html = '';
    
    Object.entries(envoys).forEach(([key, envoy]) => {
        if (typeof envoy === 'object' && envoy !== null) {
            const name = safeString(envoy.å§“å, 'æœªçŸ¥ä½¿è€…');
            const location = safeString(envoy.æ‰€åœ¨ä½ç½®, '');
            const mission = safeString(envoy.ä»»åŠ¡, '');
            const stayTime = safeString(envoy.åœç•™æ—¶é—´, '');
            const personalFavor = safeNumber(envoy.ä¸ªäººå¥½æ„Ÿ, 0);
            
            const favorColor = personalFavor > 60 ? '#28a745' : personalFavor > 40 ? '#ffc107' : '#dc3545';
            
            html += `
                <div style="margin-bottom: 15px; padding: 15px; border: 1px solid #8B6914; border-radius: 5px; background: rgba(255, 255, 255, 0.8);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div style="font-size: 16px; font-weight: bold;">${name}</div>
                        <div style="color: ${favorColor};">å¥½æ„Ÿ: ${personalFavor}</div>
                    </div>
                    
                    <div style="font-size: 12px;">
                        <div><strong>æ‰€åœ¨ä½ç½®:</strong> ${location}</div>
                        <div><strong>ä»»åŠ¡:</strong> ${mission}</div>
                        <div><strong>åœç•™æ—¶é—´:</strong> ${stayTime}</div>
                    </div>
                </div>
            `;
        }
    });
    
    container.innerHTML = html;
}

// åŠ è½½å¤–äº¤è¯¦æƒ…
function loadDiplomacyDetails() {
    loadDiplomacyOverview();
    loadDiplomacyRelations();
    loadDiplomacyEnvoys();
}
        
        // æ‰“å¼€é¢†ä¸»ä¿¡æ¯æ¨¡æ€æ¡†
        function openLordModal() {
            const modal = document.getElementById('lord-modal');
            const content = document.getElementById('lord-modal-content');
            const title = document.getElementById('lord-modal-title');
            
            const lord = territoryData.Lord || {};
            
            if (!lord || Object.keys(lord).length === 0) {
                content.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æš‚æ— é¢†ä¸»ä¿¡æ¯</div>';
            } else {
                const name = safeString(lord.å§“å, 'æœªçŸ¥é¢†ä¸»');
                const titleText = safeString(lord.ç§°å·, '');
                const gender = safeString(lord.æ€§åˆ«, '');
                const age = safeNumber(lord.å¹´é¾„, 0);
                const race = safeString(lord.ç§æ—, '');
                const profession = safeString(lord.èŒä¸š, '');
                const appearance = safeString(lord.å¤–è²Œ, '');
                const clothing = safeString(lord.è¡£ç€, '');
                const equipment = safeString(lord.è£…å¤‡, '');
                const background = safeString(lord.èƒŒæ™¯, '');
                const personality = safeString(lord.æ€§æ ¼, '');
                const location = safeString(lord.æ‰€åœ¨åœ°ç‚¹, '');
                const height = safeNumber(lord.èº«é«˜, 0);
                const weight = safeNumber(lord.ä½“é‡, 0);
                const sexExperience = safeNumber(lord.æ€§ç»éªŒ, 0);
                const children = safeString(lord.å­å—£, '');
                
                title.textContent = `${name} ${titleText ? `- ${titleText}` : ''}`;
                
                let html = `
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ‘‘ åŸºæœ¬ä¿¡æ¯</h3>
                        <div class="modal-grid">
                            <div class="modal-info-item">
                                <span class="modal-label">æ€§åˆ«:</span>
                                <span class="modal-value">${gender}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">å¹´é¾„:</span>
                                <span class="modal-value">${age}å²</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">ç§æ—:</span>
                                <span class="modal-value">${race}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">èŒä¸š:</span>
                                <span class="modal-value">${profession}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">èº«é«˜:</span>
                                <span class="modal-value">${height}å˜ç±³</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">ä½“é‡:</span>
                                <span class="modal-value">${weight}å…¬æ–¤</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ‘” å½“å‰çŠ¶æ€</h3>
                        <div class="modal-grid">
                            <div class="modal-info-item">
                                <span class="modal-label">æ‰€åœ¨åœ°ç‚¹:</span>
                                <span class="modal-value">${location}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">å½“å‰è¡£ç€:</span>
                                <span class="modal-value">${clothing}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">å½“å‰è£…å¤‡:</span>
                                <span class="modal-value">${equipment}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ“– ä¸ªäººç‰¹å¾</h3>
                        <div class="modal-grid">
                            <div class="modal-info-item" style="grid-column: 1 / -1;">
                                <span class="modal-label">å¤–è²Œ:</span>
                                <span class="modal-value">${appearance}</span>
                            </div>
                            <div class="modal-info-item" style="grid-column: 1 / -1;">
                                <span class="modal-label">æ€§æ ¼:</span>
                                <span class="modal-value">${personality}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ“œ èƒŒæ™¯æ•…äº‹</h3>
                        <div class="modal-info-item">
                            <span class="modal-value">${background}</span>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ’‘ ä¸ªäººä¿¡æ¯</h3>
                        <div class="modal-grid">
                            <div class="modal-info-item">
                                <span class="modal-label">æ€§ç»éªŒæ¬¡æ•°:</span>
                                <span class="modal-value">${sexExperience}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">å­å—£:</span>
                                <span class="modal-value">${children}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                content.innerHTML = html;
            }
            
            modal.style.display = 'flex';
        }
        
        // æ‰“å¼€å»ºç­‘è¯¦æƒ…æ¨¡æ€æ¡†
        function openBuildingModal(buildingKey) {
            const modal = document.getElementById('building-modal');
            const content = document.getElementById('building-modal-content');
            const title = document.getElementById('building-modal-title');
            
            const building = territoryData.å»ºç­‘?.[buildingKey];
            
            if (!building) {
                content.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">å»ºç­‘ä¿¡æ¯ä¸å­˜åœ¨</div>';
                modal.style.display = 'flex';
                return;
            }
            
            const name = safeString(building.åç§°, 'æœªçŸ¥å»ºç­‘');
            const type = safeString(building.ç±»å‹, 'æœªçŸ¥');
            const property = safeString(building.äº§æƒ, 'æœªçŸ¥');
            const location = safeString(building.ä½ç½®, '');
            const level = safeNumber(building.ç­‰çº§, 1);
            const status = safeString(building.çŠ¶æ€, 'æœªçŸ¥');
            const appearance = safeString(building.å¤–è§‚æè¿°, '');
            const condition = safeString(building.å½“å‰çŠ¶å†µ, '');
            const specialEvent = safeString(building.ç‰¹æ®Šäº‹ä»¶, 'æ— ');
            
            const staff = building.äººå‘˜é…ç½® || {};
            const managerCount = safeNumber(staff.ç®¡ç†è€…?.å½“å‰äººæ•°, 0);
            const artisanCount = safeNumber(staff.å·¥åŒ ?.å½“å‰äººæ•°, 0);
            const workerCount = safeNumber(staff.å·¥äºº?.å½“å‰äººæ•°, 0);
            const apprenticeCount = safeNumber(staff.å­¦å¾’?.å½“å‰äººæ•°, 0);
            const guardCount = safeNumber(staff.å®ˆå«?.å½“å‰äººæ•°, 0);
            const totalStaff = safeNumber(staff.æ€»å½“å‰äººæ•°, 0);
            const maxStaff = safeNumber(staff.æ€»æœ€å¤§äººæ•°, 0);
            const totalSalary = safeNumber(staff.æ€»æœˆè–ª, 0);
            
            const finance = building.ç»æµæ¨¡å‹ || {};
            const generalFinance = finance.é€šç”¨è´¢åŠ¡ || {};
            const financeSummary = finance.è´¢åŠ¡æ±‡æ€» || {};
            const maintenance = safeNumber(generalFinance.ç»´æŠ¤è´¹, 0);
            const totalExpense = safeNumber(generalFinance.æœˆæ€»æ”¯å‡º, 0);
            const grossIncome = safeNumber(financeSummary.æœˆæ¯›æ”¶å…¥, 0);
            const netProfit = safeNumber(financeSummary.æœˆå‡€æ”¶ç›Š, 0);
            const financeStatus = safeString(financeSummary.æ”¶æ”¯çŠ¶æ€, 'æœªçŸ¥');
            
            const upgrade = building.å‡çº§ || {};
            const canUpgrade = upgrade.å¯å‡çº§ === true;
            const upgradeTarget = safeNumber(upgrade.ç›®æ ‡ç­‰çº§, 0);
            const upgradeRequirements = upgrade.éœ€æ±‚ || {};
            const upgradeCost = safeNumber(upgradeRequirements.é‡‘å¸, 0);
            const upgradeMaterials = upgradeRequirements.ææ–™ || {};
            const upgradeWood = safeNumber(upgradeMaterials.æœ¨æ, 0);
            const upgradeStone = safeNumber(upgradeMaterials.çŸ³æ, 0);
            const upgradeIron = safeNumber(upgradeMaterials.é“çŸ¿, 0);
            const upgradeTime = safeNumber(upgradeRequirements.æ—¶é—´, 0);
            
            title.textContent = name;
            
            let html = `
                <div class="modal-section">
                    <h3 class="modal-section-title">ğŸ›ï¸ åŸºç¡€ä¿¡æ¯</h3>
                    <div class="modal-grid">
                        <div class="modal-info-item">
                            <span class="modal-label">ç±»å‹:</span>
                            <span class="modal-value">${type}</span>
                        </div>
                        <div class="modal-info-item">
                            <span class="modal-label">äº§æƒ:</span>
                            <span class="modal-value">${property === 'lord' ? 'é¢†ä¸»æ‰€æœ‰' : 'ç§æœ‰'}</span>
                        </div>
                        <div class="modal-info-item">
                            <span class="modal-label">ä½ç½®:</span>
                            <span class="modal-value">${location || 'æœªæŒ‡å®š'}</span>
                        </div>
                        <div class="modal-info-item">
                            <span class="modal-label">ç­‰çº§:</span>
                            <span class="modal-value">${level}</span>
                        </div>
                        <div class="modal-info-item">
                            <span class="modal-label">çŠ¶æ€:</span>
                            <span class="modal-value">${status}</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3 class="modal-section-title">ğŸ‘¥ äººå‘˜é…ç½®</h3>
                    <div class="building-detail-section">
                        <table class="building-finance-table">
                            <tr>
                                <td>ç®¡ç†è€…:</td>
                                <td>${managerCount}äºº</td>
                            </tr>
                            <tr>
                                <td>å·¥åŒ :</td>
                                <td>${artisanCount}äºº</td>
                            </tr>
                            <tr>
                                <td>å·¥äºº:</td>
                                <td>${workerCount}äºº</td>
                            </tr>
                            <tr>
                                <td>å­¦å¾’:</td>
                                <td>${apprenticeCount}äºº</td>
                            </tr>
                            <tr>
                                <td>å®ˆå«:</td>
                                <td>${guardCount}äºº</td>
                            </tr>
                            <tr style="border-top: 1px solid rgba(139, 105, 20, 0.3);">
                                <td>æ€»è®¡:</td>
                                <td>${totalStaff}/${maxStaff}äºº</td>
                            </tr>
                            <tr>
                                <td>æœˆè–ªæ€»é¢:</td>
                                <td>${formatCurrency(totalSalary)}</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3 class="modal-section-title">ğŸ’° è´¢åŠ¡çŠ¶å†µ</h3>
                    <div class="building-detail-section">
                        <table class="building-finance-table">
                            <tr>
                                <td>æœˆæ¯›æ”¶å…¥:</td>
                                <td style="color: #28a745;">${formatCurrency(grossIncome)}</td>
                            </tr>
                            <tr>
                                <td>æœˆæ€»æ”¯å‡º:</td>
                                <td style="color: #dc3545;">${formatCurrency(totalExpense)}</td>
                            </tr>
                            <tr style="border-top: 1px solid rgba(139, 105, 20, 0.3);">
                                <td>æœˆå‡€æ”¶ç›Š:</td>
                                <td style="color: ${netProfit >= 0 ? '#28a745' : '#dc3545'}; font-weight: bold;">
                                    ${formatCurrency(netProfit, true)}
                                </td>
                            </tr>
                            <tr>
                                <td>æ”¶æ”¯çŠ¶æ€:</td>
                                <td>${financeStatus}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;
            
            // å‡çº§ä¿¡æ¯
            if (canUpgrade && upgradeTarget > 0) {
                html += `
                    <div class="modal-section">
                        <h3 class="modal-section-title">â¬† å‡çº§ä¿¡æ¯</h3>
                        <div class="building-detail-section">
                            <div class="modal-info-item">
                                <span class="modal-label">å¯å‡çº§è‡³:</span>
                                <span class="modal-value">${upgradeTarget}çº§</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">æ‰€éœ€æ—¶é—´:</span>
                                <span class="modal-value">${upgradeTime}å¤©</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">å‡çº§éœ€æ±‚:</span>
                                <span class="modal-value">
                                    é‡‘å¸: ${formatCurrency(upgradeCost)} | 
                                    æœ¨æ: ${upgradeWood}æ–¹ | 
                                    çŸ³æ: ${upgradeStone}æ–¹ | 
                                    é“çŸ¿: ${upgradeIron}æ–¤
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // æè¿°ä¿¡æ¯
            html += `
                <div class="modal-section">
                    <h3 class="modal-section-title">ğŸ“ æè¿°ä¿¡æ¯</h3>
                    <div class="building-detail-section">
                        <div class="modal-info-item">
                            <span class="modal-label">å¤–è§‚:</span>
                            <span class="modal-value">${appearance}</span>
                        </div>
                        <div class="modal-info-item">
                            <span class="modal-label">å½“å‰çŠ¶å†µ:</span>
                            <span class="modal-value">${condition}</span>
                        </div>
                        <div class="modal-info-item">
                            <span class="modal-label">ç‰¹æ®Šäº‹ä»¶:</span>
                            <span class="modal-value">${specialEvent}</span>
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
            modal.style.display = 'flex';
        }
        
        // æ‰“å¼€è§’è‰²è¯¦æƒ…æ¨¡æ€æ¡† - é‡å¤§ä¿®æ”¹ï¼šæ·»åŠ é€‰é¡¹å¡åŠŸèƒ½
        function openCharacterModal(characterKey) {
            const modal = document.getElementById('character-modal');
            const content = document.getElementById('character-modal-content');
            const title = document.getElementById('character-modal-title');
            
            const character = territoryData.è§’è‰²?.[characterKey];
            
            if (!character) {
                content.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">è§’è‰²ä¿¡æ¯ä¸å­˜åœ¨</div>';
                modal.style.display = 'flex';
                return;
            }
            
            const name = safeString(character.å§“å, 'æœªçŸ¥è§’è‰²');
            const overview = character.è§’è‰²æ¦‚è§ˆ || {};
            const appearance = character.èº«ä½“å¤–è²Œ || {};
            const abilities = character.èƒ½åŠ›äº”ç»´ || {};
            const sexInfo = character.æ€§ || {};
            
            const gender = safeString(overview.æ€§åˆ«, '');
            const age = safeNumber(overview.å¹´é¾„, 0);
            const identity = safeString(overview.èº«ä»½, '');
            const profession = safeString(overview.èŒä¸š, '');
            const relationship = safeString(overview.ä¸é¢†ä¸»å…³ç³», '');
            const personality = safeString(overview.æ€§æ ¼, '');
            const love = safeNumber(overview.å¥½æ„Ÿåº¦, 0);
            const loyalty = safeNumber(overview.å¿ è¯šåº¦, 0);
            const mood = safeString(overview.æƒ…ç»ª, '');
            const behavior = safeString(overview.å½“å‰è¡Œä¸º, '');
            const location = safeString(overview.æ‰€åœ¨åœ°ç‚¹, '');
            const recentInteraction = safeString(overview.æœ€è¿‘äº’åŠ¨, 'æ— ');
            
            const appearanceDesc = safeString(appearance.å¤–è²Œ, '');
            const figure = safeString(appearance.èº«æ, '');
            const height = safeNumber(appearance.èº«é«˜, 0);
            const weight = safeNumber(appearance.ä½“é‡, 0);
            const upperClothing = safeString(appearance.ä¸Šèº«è¡£ç€, '');
            const lowerClothing = safeString(appearance.ä¸‹èº«è¡£ç€, '');
            const accessories = safeString(appearance.é…é¥°, 'æ— ');
            const specialMarks = safeString(appearance.ç‰¹æ®Šæ ‡è®°, 'æ— ');
            
            const military = safeNumber(abilities.å†›äº‹, 0);
            const management = safeNumber(abilities.ç®¡ç†, 0);
            const diplomacy = safeNumber(abilities.å¤–äº¤, 0);
            const strategy = safeNumber(abilities.è°‹ç•¥, 0);
            const knowledge = safeNumber(abilities.å­¦è¯†, 0);
            const bravery = safeNumber(abilities.å‹‡æ­¦, 0);
            
            const background = safeString(character.èƒŒæ™¯æ•…äº‹, 'æ— èƒŒæ™¯æ•…äº‹');
            
            title.textContent = name;
            
            // æ„å»ºé€‰é¡¹å¡å¯¼èˆª
            let html = `
                <div style="margin-bottom: 15px; display: flex; align-items: center;">
                    <span style="font-size: 18px; font-weight: bold; margin-right: 10px;">${name}</span>
                    <span style="font-size: 14px; color: #8B6914;">${identity} | ${profession}</span>
                </div>
                
                <div class="character-modal-tabs">
                    <button class="character-tab-btn active" onclick="switchCharacterTab(this, 'basic')">åŸºæœ¬ä¿¡æ¯</button>
                    <button class="character-tab-btn" onclick="switchCharacterTab(this, 'relationship')">å…³ç³»ä¸èƒ½åŠ›</button>
                    <button class="character-tab-btn" onclick="switchCharacterTab(this, 'appearance')">å¤–è²Œè¡£ç€</button>
                    <button class="character-tab-btn" onclick="switchCharacterTab(this, 'sex')">æ€§ä¿¡æ¯</button>
                    <button class="character-tab-btn" onclick="switchCharacterTab(this, 'background')">èƒŒæ™¯æ•…äº‹</button>
                </div>
                
                <!-- åŸºæœ¬ä¿¡æ¯é€‰é¡¹å¡ -->
                <div class="character-tab-content active" id="character-tab-basic">
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ“Š åŸºç¡€ä¿¡æ¯</h3>
                        <div class="modal-grid">
                            <div class="modal-info-item">
                                <span class="modal-label">æ€§åˆ«:</span>
                                <span class="modal-value">${gender}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">å¹´é¾„:</span>
                                <span class="modal-value">${age}å²</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">èº«ä»½:</span>
                                <span class="modal-value">${identity}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">èŒä¸š:</span>
                                <span class="modal-value">${profession}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">æƒ…ç»ª:</span>
                                <span class="modal-value">${mood}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">æ‰€åœ¨åœ°ç‚¹:</span>
                                <span class="modal-value">${location}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ“ å½“å‰çŠ¶æ€</h3>
                        <div class="modal-grid">
                            <div class="modal-info-item">
                                <span class="modal-label">å½“å‰è¡Œä¸º:</span>
                                <span class="modal-value">${behavior}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">æœ€è¿‘äº’åŠ¨:</span>
                                <span class="modal-value">${recentInteraction}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å…³ç³»ä¸èƒ½åŠ›é€‰é¡¹å¡ -->
                <div class="character-tab-content" id="character-tab-relationship">
                    <div class="modal-section">
                        <h3 class="modal-section-title">â¤ï¸ ä¸é¢†ä¸»å…³ç³»</h3>
                        <div class="modal-grid">
                            <div class="modal-info-item">
                                <span class="modal-label">å…³ç³»æè¿°:</span>
                                <span class="modal-value">${relationship}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">æ€§æ ¼:</span>
                                <span class="modal-value">${personality}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">å¥½æ„Ÿåº¦:</span>
                                <span class="modal-value">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span>${love}/100</span>
                                        <div class="progress" style="flex: 1;">
                                            <div class="progress-bar" style="width: ${love}%"></div>
                                        </div>
                                    </div>
                                </span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">å¿ è¯šåº¦:</span>
                                <span class="modal-value">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span>${loyalty}/100</span>
                                        <div class="progress" style="flex: 1;">
                                            <div class="progress-bar" style="width: ${loyalty}%"></div>
                                        </div>
                                    </div>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ’ª èƒ½åŠ›äº”ç»´</h3>
                        <div class="ability-radar">
                            <div class="ability-item">
                                <div class="ability-name">å†›äº‹</div>
                                <div class="ability-value">${military}</div>
                            </div>
                            <div class="ability-item">
                                <div class="ability-name">ç®¡ç†</div>
                                <div class="ability-value">${management}</div>
                            </div>
                            <div class="ability-item">
                                <div class="ability-name">å¤–äº¤</div>
                                <div class="ability-value">${diplomacy}</div>
                            </div>
                            <div class="ability-item">
                                <div class="ability-name">è°‹ç•¥</div>
                                <div class="ability-value">${strategy}</div>
                            </div>
                            <div class="ability-item">
                                <div class="ability-name">å­¦è¯†</div>
                                <div class="ability-value">${knowledge}</div>
                            </div>
                            <div class="ability-item">
                                <div class="ability-name">å‹‡æ­¦</div>
                                <div class="ability-value">${bravery}</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- å¤–è²Œè¡£ç€é€‰é¡¹å¡ -->
                <div class="character-tab-content" id="character-tab-appearance">
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ‘” å¤–è²Œè¡£ç€</h3>
                        <div class="modal-grid">
                            <div class="modal-info-item" style="grid-column: 1 / -1;">
                                <span class="modal-label">å¤–è²Œ:</span>
                                <span class="modal-value">${appearanceDesc}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">èº«æ:</span>
                                <span class="modal-value">${figure}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">èº«é«˜:</span>
                                <span class="modal-value">${height}å˜ç±³</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">ä½“é‡:</span>
                                <span class="modal-value">${weight}å…¬æ–¤</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">ä¸Šèº«è¡£ç€:</span>
                                <span class="modal-value">${upperClothing}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">ä¸‹èº«è¡£ç€:</span>
                                <span class="modal-value">${lowerClothing}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">é…é¥°:</span>
                                <span class="modal-value">${accessories}</span>
                            </div>
                            <div class="modal-info-item">
                                <span class="modal-label">ç‰¹æ®Šæ ‡è®°:</span>
                                <span class="modal-value">${specialMarks}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æ€§ä¿¡æ¯é€‰é¡¹å¡ -->
                <div class="character-tab-content" id="character-tab-sex">
            `;
            
            // ========== æ€§ä¿¡æ¯å†…å®¹ ==========
            const chest = sexInfo.èƒ¸éƒ¨ || {};
            const vagina = sexInfo.å°ç©´ || {};
            const anus = sexInfo.ååº­ || {};
            const penis = sexInfo.è‚‰æ£’ || {};
            const sexExp = sexInfo.æ€§ç»éªŒ || {};
            const fetish = safeString(sexInfo.æ€§ç™–, '');
            const cycle = sexInfo.ç”Ÿç†å‘¨æœŸ || {};
            const pregnancy = sexInfo.æ€€å­•çŠ¶æ€ || {};
            const children = sexInfo.å­å—£ || {};
            const fluids = sexInfo.ä½“æ¶²çŠ¶æ€ || {};
            const sensitiveAreas = safeString(sexInfo.æ•æ„Ÿå¸¦, '');
            const rejectedActs = safeString(sexInfo.æ‹’ç»è¡Œä¸º, '');
            const specialAbilities = safeString(sexInfo.ç‰¹æ®Šèƒ½åŠ›, '');
            
            // èƒ¸éƒ¨ä¿¡æ¯
            if (safeString(chest.å¤–è§‚, '') !== 'æ— ' && safeString(chest.å¤–è§‚, '') !== '') {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">èƒ¸éƒ¨</div>
                        <div class="sex-info-grid">
                            <div class="sex-info-item">
                                <span class="modal-label">å¤–è§‚:</span>
                                <span class="modal-value">${safeString(chest.å¤–è§‚, '')}</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">å¤§å°:</span>
                                <span class="modal-value">${safeString(chest.å¤§å°, '')}</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">çŠ¶æ€:</span>
                                <span class="modal-value">${safeString(chest.çŠ¶æ€, '')}</span>
                            </div>
                        </div>
                        <div class="sex-progress-container">
                            <div class="sex-progress-label">æ•æ„Ÿåº¦:</div>
                            <div class="progress" style="flex: 1;">
                                <div class="progress-bar" style="width: ${safeNumber(chest.æ•æ„Ÿåº¦, 0)}%"></div>
                            </div>
                            <span>${safeNumber(chest.æ•æ„Ÿåº¦, 0)}</span>
                        </div>
                    </div>
                `;
            }
            
            // å°ç©´ä¿¡æ¯
            if (safeString(vagina.å¤–è§‚, '') !== 'æ— ' && safeString(vagina.å¤–è§‚, '') !== '') {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">å°ç©´</div>
                        <div class="sex-info-grid">
                            <div class="sex-info-item">
                                <span class="modal-label">å¤–è§‚:</span>
                                <span class="modal-value">${safeString(vagina.å¤–è§‚, '')}</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">çŠ¶æ€:</span>
                                <span class="modal-value">${safeString(vagina.çŠ¶æ€, '')}</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">ä½¿ç”¨æ¬¡æ•°:</span>
                                <span class="modal-value">${safeNumber(vagina.ä½¿ç”¨æ¬¡æ•°, 0)}</span>
                            </div>
                        </div>
                        <div class="sex-progress-container">
                            <div class="sex-progress-label">ç´§è‡´åº¦:</div>
                            <div class="progress" style="flex: 1;">
                                <div class="progress-bar" style="width: ${safeNumber(vagina.ç´§è‡´åº¦, 0)}%"></div>
                            </div>
                            <span>${safeNumber(vagina.ç´§è‡´åº¦, 0)}</span>
                        </div>
                        <div class="sex-progress-container">
                            <div class="sex-progress-label">æ•æ„Ÿåº¦:</div>
                            <div class="progress" style="flex: 1;">
                                <div class="progress-bar" style="width: ${safeNumber(vagina.æ•æ„Ÿåº¦, 0)}%"></div>
                            </div>
                            <span>${safeNumber(vagina.æ•æ„Ÿåº¦, 0)}</span>
                        </div>
                    </div>
                `;
            }
            
            // ååº­ä¿¡æ¯
            if (safeString(anus.å¤–è§‚, '') !== 'æ— ' && safeString(anus.å¤–è§‚, '') !== '') {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">ååº­</div>
                        <div class="sex-info-grid">
                            <div class="sex-info-item">
                                <span class="modal-label">å¤–è§‚:</span>
                                <span class="modal-value">${safeString(anus.å¤–è§‚, '')}</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">çŠ¶æ€:</span>
                                <span class="modal-value">${safeString(anus.çŠ¶æ€, '')}</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">ä½¿ç”¨æ¬¡æ•°:</span>
                                <span class="modal-value">${safeNumber(anus.ä½¿ç”¨æ¬¡æ•°, 0)}</span>
                            </div>
                        </div>
                        <div class="sex-progress-container">
                            <div class="sex-progress-label">ç´§è‡´åº¦:</div>
                            <div class="progress" style="flex: 1;">
                                <div class="progress-bar" style="width: ${safeNumber(anus.ç´§è‡´åº¦, 0)}%"></div>
                            </div>
                            <span>${safeNumber(anus.ç´§è‡´åº¦, 0)}</span>
                        </div>
                        <div class="sex-progress-container">
                            <div class="sex-progress-label">æ•æ„Ÿåº¦:</div>
                            <div class="progress" style="flex: 1;">
                                <div class="progress-bar" style="width: ${safeNumber(anus.æ•æ„Ÿåº¦, 0)}%"></div>
                            </div>
                            <span>${safeNumber(anus.æ•æ„Ÿåº¦, 0)}</span>
                        </div>
                    </div>
                `;
            }
            
            // è‚‰æ£’ä¿¡æ¯
            if (safeString(penis.å¤–è§‚, '') !== 'æ— ' && safeString(penis.å¤–è§‚, '') !== '') {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">è‚‰æ£’</div>
                        <div class="sex-info-grid">
                            <div class="sex-info-item">
                                <span class="modal-label">å¤–è§‚:</span>
                                <span class="modal-value">${safeString(penis.å¤–è§‚, '')}</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">é•¿åº¦:</span>
                                <span class="modal-value">${safeNumber(penis.é•¿åº¦, 0)}å˜ç±³</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">ç²—åº¦:</span>
                                <span class="modal-value">${safeNumber(penis.ç²—åº¦, 0)}å˜ç±³</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">çŠ¶æ€:</span>
                                <span class="modal-value">${safeString(penis.çŠ¶æ€, '')}</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // æ€§ç»éªŒ
            html += `
                <div class="sex-info-section">
                    <div class="sex-info-title">æ€§ç»éªŒ</div>
                    <div class="sex-info-grid">
                        <div class="sex-info-item">
                            <span class="modal-label">æ€»æ¬¡æ•°:</span>
                            <span class="modal-value">${safeNumber(sexExp.æ€»æ¬¡æ•°, 0)}</span>
                        </div>
                        <div class="sex-info-item">
                            <span class="modal-label">äººæ•°:</span>
                            <span class="modal-value">${safeNumber(sexExp.äººæ•°, 0)}</span>
                        </div>
                        <div class="sex-info-item">
                            <span class="modal-label">ç¬¬ä¸€æ¬¡æ—¶é—´:</span>
                            <span class="modal-value">${safeString(sexExp.ç¬¬ä¸€æ¬¡æ—¶é—´, '')}</span>
                        </div>
                        <div class="sex-info-item">
                            <span class="modal-label">åå¥½å§¿åŠ¿:</span>
                            <span class="modal-value">${safeString(sexExp.åå¥½å§¿åŠ¿, '')}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // æ€§ç™–
            if (fetish) {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">æ€§ç™–</div>
                        <div class="modal-info-item">
                            <span class="modal-value">${fetish}</span>
                        </div>
                    </div>
                `;
            }
            
            // ç”Ÿç†å‘¨æœŸ
            if (safeString(cycle.å½“å‰é˜¶æ®µ, '') !== '' && safeString(cycle.å½“å‰é˜¶æ®µ, '') !== 'æ— ') {
                let cycleClass = '';
                switch(safeString(cycle.å½“å‰é˜¶æ®µ, '')) {
                    case 'æœˆç»æœŸ': cycleClass = 'cycle-menstrual'; break;
                    case 'åµæ³¡æœŸ': cycleClass = 'cycle-follicular'; break;
                    case 'æ’åµæœŸ': cycleClass = 'cycle-ovulation'; break;
                    case 'é»„ä½“æœŸ': cycleClass = 'cycle-luteal'; break;
                }
                
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">ç”Ÿç†å‘¨æœŸ</div>
                        <div class="sex-info-grid">
                            <div class="sex-info-item">
                                <span class="modal-label">å½“å‰é˜¶æ®µ:</span>
                                <span class="modal-value">
                                    <span class="cycle-stage ${cycleClass}">${safeString(cycle.å½“å‰é˜¶æ®µ, '')}</span>
                                </span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">é˜¶æ®µè¿›åº¦:</span>
                                <span class="modal-value">ç¬¬${safeNumber(cycle.é˜¶æ®µè¿›åº¦, 0)}å¤©</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">æ€»å‘¨æœŸå¤©æ•°:</span>
                                <span class="modal-value">${safeNumber(cycle.æ€»å‘¨æœŸå¤©æ•°, 0)}å¤©</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">å½“å‰å‘¨æœŸå¤©æ•°:</span>
                                <span class="modal-value">ç¬¬${safeNumber(cycle.å½“å‰å‘¨æœŸå¤©æ•°, 0)}å¤©</span>
                            </div>
                        </div>
                        <div class="cycle-indicator">
                            <div class="progress" style="flex: 1;">
                                <div class="progress-bar" style="width: ${(safeNumber(cycle.å½“å‰å‘¨æœŸå¤©æ•°, 0) / safeNumber(cycle.æ€»å‘¨æœŸå¤©æ•°, 28) * 100)}%"></div>
                            </div>
                        </div>
                        <div class="sex-info-item">
                            <span class="modal-label">ä¸Šæ¬¡æœˆç»å¼€å§‹:</span>
                            <span class="modal-value">${safeString(cycle.ä¸Šæ¬¡æœˆç»å¼€å§‹, '')}</span>
                        </div>
                    </div>
                `;
            }
            
            // æ€€å­•çŠ¶æ€
            const isPregnant = pregnancy.æ˜¯å¦æ€€å­• === true;
            html += `
                <div class="sex-info-section">
                    <div class="sex-info-title">æ€€å­•çŠ¶æ€</div>
                    <div class="pregnancy-indicator ${isPregnant ? 'pregnancy-yes' : 'pregnancy-no'}">
                        <div style="font-weight: bold; margin-bottom: 5px;">
                            ${isPregnant ? 'ğŸ¤° æ€€å­•ä¸­' : 'ğŸš« æœªæ€€å­•'}
                        </div>
            `;
            
            if (isPregnant) {
                html += `
                        <div class="sex-info-grid">
                            <div class="sex-info-item">
                                <span class="modal-label">æ€€å­•å¼€å§‹æ—¶é—´:</span>
                                <span class="modal-value">${safeString(pregnancy.æ€€å­•å¼€å§‹æ—¶é—´, '')}</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">æ€€å­•å‘¨æ•°:</span>
                                <span class="modal-value">${safeNumber(pregnancy.æ€€å­•å‘¨æ•°, 0)}å‘¨</span>
                            </div>
                            <div class="sex-info-item">
                                <span class="modal-label">èƒå„¿çˆ¶äº²:</span>
                                <span class="modal-value">${safeString(pregnancy.èƒå„¿çˆ¶äº², '')}</span>
                            </div>
                        </div>
                        <div class="sex-info-item">
                            <span class="modal-label">å­•æœŸçŠ¶æ€:</span>
                            <span class="modal-value">${safeString(pregnancy.å­•æœŸçŠ¶æ€, '')}</span>
                        </div>
                `;
            }
            
            html += `</div></div>`;
            
            // å­å—£
            html += `
                <div class="sex-info-section">
                    <div class="sex-info-title">å­å—£</div>
                    <div class="sex-info-grid">
                        <div class="sex-info-item">
                            <span class="modal-label">æ•°é‡:</span>
                            <span class="modal-value">${safeNumber(children.æ•°é‡, 0)}</span>
                        </div>
                    </div>
                    <div class="sex-info-item">
                        <span class="modal-label">æè¿°:</span>
                        <span class="modal-value">${safeString(children.æè¿°, '')}</span>
                    </div>
                </div>
            `;
            
            // ä½“æ¶²çŠ¶æ€
            if (fluids && Object.keys(fluids).length > 0) {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">ä½“æ¶²çŠ¶æ€</div>
                        <div class="fluid-container">
                `;
                
                const fluidItems = [
                    { key: 'èƒƒéƒ¨æ¶²ä½“é‡', label: 'èƒƒéƒ¨', maxKey: 'èƒƒéƒ¨', unit: 'ml' },
                    { key: 'å­å®«æ¶²ä½“é‡', label: 'å­å®«', maxKey: 'å­å®«', unit: 'ml' },
                    { key: 'è‚ é“æ¶²ä½“é‡', label: 'è‚ é“', maxKey: 'è‚ é“', unit: 'ml' },
                    { key: 'è†€èƒ±æ¶²ä½“é‡', label: 'è†€èƒ±', maxKey: 'è†€èƒ±', unit: 'ml' }
                ];
                
                fluidItems.forEach(item => {
                    const current = safeNumber(fluids[item.key], 0);
                    const max = safeNumber(fluids.æœ€å¤§å®¹é‡?.[item.maxKey], 1000);
                    const percentage = max > 0 ? (current / max * 100) : 0;
                    
                    html += `
                        <div class="fluid-item">
                            <div class="fluid-name">${item.label}</div>
                            <div>${current}${item.unit} / ${max}${item.unit}</div>
                            <div class="progress" style="margin-top: 5px;">
                                <div class="progress-bar" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
                
                // æ’æ³„éœ€æ±‚
                const excretionNeed = safeNumber(fluids.æ’æ³„éœ€æ±‚, 0);
                html += `
                    <div style="margin-top: 10px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 3px;">
                            <span>æ’æ³„éœ€æ±‚:</span>
                            <span>${excretionNeed}/100</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" style="width: ${excretionNeed}%"></div>
                        </div>
                    </div>
                `;
                
                html += `</div>`;
            }
            
            // æ•æ„Ÿå¸¦
            if (sensitiveAreas) {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">æ•æ„Ÿå¸¦</div>
                        <div class="modal-info-item">
                            <span class="modal-value">${sensitiveAreas}</span>
                        </div>
                    </div>
                `;
            }
            
            // æ‹’ç»è¡Œä¸º
            if (rejectedActs) {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">æ‹’ç»è¡Œä¸º</div>
                        <div class="modal-info-item">
                            <span class="modal-value">${rejectedActs}</span>
                        </div>
                    </div>
                `;
            }
            
            // ç‰¹æ®Šèƒ½åŠ›
            if (specialAbilities && specialAbilities !== 'æ— ') {
                html += `
                    <div class="sex-info-section">
                        <div class="sex-info-title">ç‰¹æ®Šèƒ½åŠ›</div>
                        <div class="modal-info-item">
                            <span class="modal-value">${specialAbilities}</span>
                        </div>
                    </div>
                `;
            }
            
            // å…³é—­æ€§ä¿¡æ¯é€‰é¡¹å¡
            html += `</div>`;
            
            // èƒŒæ™¯æ•…äº‹é€‰é¡¹å¡
            html += `
                <div class="character-tab-content" id="character-tab-background">
                    <div class="modal-section">
                        <h3 class="modal-section-title">ğŸ“– èƒŒæ™¯æ•…äº‹</h3>
                        <div class="modal-info-item">
                            <span class="modal-value">${background}</span>
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
            modal.style.display = 'flex';
        }
        
        // è§’è‰²æ¨¡æ€æ¡†é€‰é¡¹å¡åˆ‡æ¢å‡½æ•°
        function switchCharacterTab(btn, tabId) {
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            const tabButtons = btn.parentElement.querySelectorAll('.character-tab-btn');
            tabButtons.forEach(tabBtn => {
                tabBtn.classList.remove('active');
            });
            
            // éšè—æ‰€æœ‰é€‰é¡¹å¡å†…å®¹
            const tabContents = document.querySelectorAll('.character-tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // æ¿€æ´»å½“å‰é€‰é¡¹å¡
            btn.classList.add('active');
            document.getElementById(`character-tab-${tabId}`).classList.add('active');
        }
        
        // æ‰“å¼€æ³•ä»¤è¯¦æƒ…æ¨¡æ€æ¡†
        function openDecreeModal(decreeKey) {
            const modal = document.getElementById('decree-modal');
            const content = document.getElementById('decree-modal-content');
            const title = document.getElementById('decree-modal-title');
            
            const decree = territoryData.æ³•ä»¤?.[decreeKey];
            
            if (!decree) {
                content.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æ³•ä»¤ä¿¡æ¯ä¸å­˜åœ¨</div>';
                modal.style.display = 'flex';
                return;
            }
            
            const name = safeString(decree.åç§°, 'æœªçŸ¥æ³•ä»¤');
            const active = decree.ç”Ÿæ•ˆçŠ¶æ€ === true;
            const activeTime = safeString(decree.ç”Ÿæ•ˆæ—¶é—´, 'æœªçŸ¥');
            const description = safeString(decree.æ³•ä»¤æè¿°, 'æ— æè¿°');
            
            const economicEffects = decree.ç»æµæ•ˆæœ || {};
            const socialEffects = decree.ç¤¾ä¼šæ•ˆæœ || {};
            
            title.textContent = name;
            
            let html = `
                <div class="modal-section">
                    <h3 class="modal-section-title">ğŸ“œ åŸºæœ¬ä¿¡æ¯</h3>
                    <div class="modal-grid">
                        <div class="modal-info-item">
                            <span class="modal-label">çŠ¶æ€:</span>
                            <span class="modal-value">
                                <span class="tag ${active ? 'status-active' : ''}" style="padding: 3px 10px;">
                                    ${active ? 'ç”Ÿæ•ˆä¸­' : 'å·²å¤±æ•ˆ'}
                                </span>
                            </span>
                        </div>
                        <div class="modal-info-item">
                            <span class="modal-label">ç”Ÿæ•ˆæ—¶é—´:</span>
                            <span class="modal-value">${activeTime}</span>
                        </div>
                    </div>
                    <div class="modal-info-item" style="margin-top: 10px;">
                        <span class="modal-label">æ³•ä»¤æè¿°:</span>
                        <span class="modal-value">${description}</span>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h3 class="modal-section-title">ğŸ“ˆ æ³•ä»¤æ•ˆæœ</h3>
                    <div class="decree-effect-details">
                        <div class="decree-effect-category">
                            <div class="effect-category-title">ğŸ’° ç»æµæ•ˆæœ</div>
                            ${economicEffects.ç¨ç‡ä¿®æ­£ ? `<div>ç¨ç‡ä¿®æ­£: ${economicEffects.ç¨ç‡ä¿®æ­£ >= 0 ? '+' : ''}${(economicEffects.ç¨ç‡ä¿®æ­£ * 100).toFixed(1)}%</div>` : '<div>æ— ç¨ç‡ä¿®æ­£</div>'}
                            ${economicEffects.ä¸“é¡¹ç¨ç‡ ? `<div>ä¸“é¡¹ç¨ç‡: ${(economicEffects.ä¸“é¡¹ç¨ç‡ * 100).toFixed(1)}%</div>` : ''}
                            ${economicEffects.å›ºå®šæ”¶å…¥ ? `<div>å›ºå®šæ”¶å…¥: ${formatCurrency(economicEffects.å›ºå®šæ”¶å…¥)}</div>` : ''}
                            ${economicEffects.å›ºå®šæ”¯å‡º ? `<div>å›ºå®šæ”¯å‡º: ${formatCurrency(economicEffects.å›ºå®šæ”¯å‡º)}</div>` : ''}
                            ${economicEffects.æ•ˆç‡åŠ æˆ ? `<div>æ•ˆç‡åŠ æˆ: +${(economicEffects.æ•ˆç‡åŠ æˆ * 100).toFixed(1)}%</div>` : ''}
                        </div>
                        <div class="decree-effect-category">
                            <div class="effect-category-title">ğŸ˜ï¸ ç¤¾ä¼šæ•ˆæœ</div>
                            ${socialEffects.æ°‘å¿ƒå½±å“ ? `<div>æ°‘å¿ƒå½±å“: ${socialEffects.æ°‘å¿ƒå½±å“ >= 0 ? '+' : ''}${socialEffects.æ°‘å¿ƒå½±å“}</div>` : '<div>æ— æ°‘å¿ƒå½±å“</div>'}
                            ${socialEffects.æ²»å®‰å½±å“ ? `<div>æ²»å®‰å½±å“: ${socialEffects.æ²»å®‰å½±å“ >= 0 ? '+' : ''}${socialEffects.æ²»å®‰å½±å“}</div>` : ''}
                            ${socialEffects.äººå£å½±å“ ? `<div>äººå£å½±å“: ${socialEffects.äººå£å½±å“ >= 0 ? '+' : ''}${(socialEffects.äººå£å½±å“ * 100).toFixed(2)}%</div>` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
            modal.style.display = 'flex';
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
        }
        
        // åˆ‡æ¢ç« èŠ‚æ˜¾ç¤º/éšè—
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const toggle = header.querySelector('.section-toggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggle.textContent = 'â–¼';
            } else {
                content.style.display = 'none';
                toggle.textContent = 'â–¶';
            }
            // æ£€æŸ¥æ™¨æŠ¥æœªè¯»çŠ¶æ€
            checkMorningReportUnread();
            adjustIframeHeight();
        }
        
        // åˆ‡æ¢é€‰é¡¹å¡
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰é€‰é¡¹å¡
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é€‰é¡¹å¡
            const targetTab = document.getElementById(`tab-${tabName}`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // è®¾ç½®æ´»åŠ¨çŠ¶æ€
            const targetBtn = Array.from(document.querySelectorAll('.tab-btn')).find(btn => 
                btn.textContent.trim().toLowerCase().includes(tabName.toLowerCase())
            );
            if (targetBtn) {
                targetBtn.classList.add('active');
            }
            
            // åŠ è½½é€‰é¡¹å¡æ•°æ®
            switch(tabName) {

                case 'diplomacy':
    loadDiplomacyDetails();
    break;
                    
                case 'overview':
                    // æ¦‚è§ˆé€‰é¡¹å¡å·²ç»åœ¨updateUIä¸­æ›´æ–°
                    break;
                case 'economy':
                    loadEconomyDetails();
                    break;
                case 'population':
                    loadPopulationDetails();
                    break;
                case 'military':
                    loadMilitaryDetails();
                    break;
                case 'buildings':
                    loadBuildingsGrid();
                    break;
                case 'resources':
                    loadResourcesDetails();
                    break;
                case 'technology':
                    loadTechnologyDetails();
                    break;
                case 'decrees':
                    loadDecreesGrid();
                    break;
                case 'characters':
                    loadCharactersGrid();
                    break;
                case 'system':
                    loadSystemDetails();
                    break;
            }
            
            adjustIframeHeight();
        }
        
        // åˆ·æ–°æ•°æ®
        async function refreshData() {
            try {
                showLoading(true);
                
                // æ¸…é™¤ç°æœ‰æ•°æ®ï¼Œå¼ºåˆ¶é‡æ–°è·å–
                territoryData = null;
                localStorage.removeItem('territoryData');
                
                await fetchFromMVU();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                const now = new Date();
                document.getElementById('last-update').textContent = now.toLocaleTimeString();
                
            } catch (error) {
                console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
                alert('åˆ·æ–°æ•°æ®å¤±è´¥: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        // æœˆåº¦ç»“ç®—
        async function monthlySettlement() {
            if (confirm('ç¡®å®šè¦æ‰§è¡Œæœˆåº¦ç»“ç®—å—ï¼Ÿè¿™å°†æ›´æ–°æ‰€æœ‰ç»æµæ•°æ®ã€‚')) {
                try {
                    showLoading(true);
                    
                    // æ£€æŸ¥MVUå‡½æ•°æ˜¯å¦å­˜åœ¨
                    if (typeof executeMvuCode === 'function') {
                        await executeMvuCode('Territory.monthlySettlement()');
                    } else if (typeof window.executeMvuCode === 'function') {
                        await window.executeMvuCode('Territory.monthlySettlement()');
                    } else {
                        // æ¨¡æ‹Ÿæ•°æ®å˜åŒ–
                        if (territoryData) {
                            // æ›´æ–°å›½åº“
                            const netIncome = safeNumber(territoryData.ç»æµ?.è´¢æ”¿?.æœˆå‡€æ”¶å…¥, 0);
                            territoryData.ç»æµ.è´¢æ”¿.åº“å­˜é‡‘å¸ = safeNumber(territoryData.ç»æµ.è´¢æ”¿.åº“å­˜é‡‘å¸, 0) + netIncome;
                            
                            // æ›´æ–°äººå£
                            const growthRate = safeNumber(territoryData.äººå£?.äººå£å¢é•¿ç‡, 0);
                            territoryData.äººå£.æ€»äººå£ = Math.floor(safeNumber(territoryData.äººå£.æ€»äººå£, 0) * (1 + growthRate));
                            
                            // æ›´æ–°æ¸¸æˆæ—¶é—´
                            const system = territoryData.System || {};
                            const timeMatch = (system.å½“å‰æ¸¸æˆæ—¶é—´ || 'ç¬¬1å¹´ 1æœˆ').match(/ç¬¬(\d+)å¹´ (\d+)æœˆ/);
                            if (timeMatch) {
                                let year = parseInt(timeMatch[1]);
                                let month = parseInt(timeMatch[2]) + 1;
                                if (month > 12) {
                                    month = 1;
                                    year++;
                                }
                                system.å½“å‰æ¸¸æˆæ—¶é—´ = `ç¬¬${year}å¹´ ${month}æœˆ`;
                                
                                // æ›´æ–°å­£èŠ‚
                                const seasons = ['æ˜¥å­£', 'å¤å­£', 'ç§‹å­£', 'å†¬å­£'];
                                const seasonIndex = Math.floor((month - 1) / 3) % 4;
                                system.å½“å‰å­£èŠ‚ = seasons[seasonIndex];
                            }
                            
                            lastUpdate = new Date();
                            document.getElementById('last-update').textContent = lastUpdate.toLocaleTimeString();
                            
                            // ä¿å­˜æ›´æ–°åçš„æ•°æ®
                            localStorage.setItem('territoryData', JSON.stringify(territoryData));
                            updateUI();
                        }
                    }
                    
                    alert('æœˆåº¦ç»“ç®—å®Œæˆï¼');
                } catch (error) {
                    console.error('æœˆåº¦ç»“ç®—å¤±è´¥:', error);
                    alert('æœˆåº¦ç»“ç®—å¤±è´¥: ' + error.message);
                } finally {
                    showLoading(false);
                }
            }
        }
        
        // åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const btn = document.getElementById('auto-refresh-btn');
            
            if (autoRefreshEnabled) {
                btn.innerHTML = 'â¸ï¸ æš‚åœåˆ·æ–°';
                btn.style.background = '#28a745';
                autoRefreshInterval = setInterval(refreshData, 30000);
            } else {
                btn.innerHTML = 'â–¶ï¸ è‡ªåŠ¨åˆ·æ–°';
                btn.style.background = '#8B6914';
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            }
        }
        
        // å¯¼å‡ºæ•°æ®
        function exportData() {
            if (!territoryData) {
                alert('æ²¡æœ‰æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            const dataStr = JSON.stringify(territoryData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `é¢†åœ°æ•°æ®_${new Date().toISOString().slice(0,10)}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            alert('æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶');
        }
        
        // æ¸…é™¤æœ¬åœ°æ•°æ®
        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„æ•°æ®å—ï¼Ÿè¿™ä¸ä¼šå½±å“MVUç³»ç»Ÿä¸­çš„æ•°æ®ã€‚')) {
                localStorage.removeItem('territoryData');
                territoryData = null;
                alert('æœ¬åœ°æ•°æ®å·²æ¸…é™¤ï¼Œè¯·åˆ·æ–°é¡µé¢é‡æ–°è·å–æ•°æ®');
            }
        }
        
        // æ˜¾ç¤ºè°ƒè¯•é¢æ¿
        function showDebugPanel() {
            debugMode = !debugMode;
            const debugSection = document.getElementById('debug-section');
            const debugInfo = document.getElementById('debug-info');
            
            if (debugMode) {
                debugSection.style.display = 'block';
                
                let debugHtml = '<div style="font-size: 12px;">';
                
                // æ˜¾ç¤ºå½“å‰æ•°æ®çŠ¶æ€
                debugHtml += '<div><strong>æ•°æ®çŠ¶æ€:</strong> ' + (territoryData ? 'å·²åŠ è½½' : 'æœªåŠ è½½') + '</div>';
                
                if (territoryData) {
                    // æ˜¾ç¤ºå…³é”®æ•°æ®
                    debugHtml += '<div><strong>äººå£:</strong> ' + (territoryData.äººå£?.æ€»äººå£ || 'N/A') + '</div>';
                    debugHtml += '<div><strong>å›½åº“:</strong> ' + (territoryData.ç»æµ?.è´¢æ”¿?.åº“å­˜é‡‘å¸ || 'N/A') + '</div>';
                    debugHtml += '<div><strong>å»ºç­‘æ•°é‡:</strong> ' + (territoryData.å»ºç­‘ ? Object.keys(territoryData.å»ºç­‘).length : 0) + '</div>';
                    debugHtml += '<div><strong>è§’è‰²æ•°é‡:</strong> ' + (territoryData.è§’è‰² ? Object.keys(territoryData.è§’è‰²).length : 0) + '</div>';
                    debugHtml += '<div><strong>æ³•ä»¤æ•°é‡:</strong> ' + (territoryData.æ³•ä»¤ ? Object.keys(territoryData.æ³•ä»¤).length : 0) + '</div>';
                    debugHtml += '<div><strong>æœ€åæ›´æ–°:</strong> ' + (lastUpdate ? lastUpdate.toLocaleTimeString() : 'N/A') + '</div>';
                }
                
                debugHtml += '</div>';
                
                debugInfo.innerHTML = debugHtml;
            } else {
                debugSection.style.display = 'none';
            }
            
            adjustIframeHeight();
        }
        
        // è°ƒæ•´iframeé«˜åº¦
        function adjustIframeHeight() {
            setTimeout(() => {
                const height = document.documentElement.scrollHeight;
                if (window.parent && window.parent.postMessage) {
                    window.parent.postMessage({
                        type: 'resize_iframe',
                        height: height + 'px'
                    }, '*');
                }
            }, 100);
        }
        
        // å·¥å…·å‡½æ•°
        function formatNumber(num) {
            const number = safeNumber(num, 0);
            return number.toLocaleString();
        }
        
        function formatCurrency(amount, showSign = false) {
            const num = safeNumber(amount, 0);
            let formatted = num.toLocaleString() + ' é‡‘å¸';
            if (showSign) {
                formatted = (num >= 0 ? '+' : '') + formatted;
            }
            return formatted;
        }
        
        function getThreatColor(threat) {
            if (!threat) return '#6c757d';
            switch(threat) {
                case 'å®‰å…¨': return '#28a745';
                case 'è­¦æˆ’': return '#ffc107';
                case 'å±é™©': return '#dc3545';
                case 'æå±': return '#721c24';
                default: return '#6c757d';
            }
        }
        
        function getMoraleColor(morale) {
            const num = safeNumber(morale, 0);
            if (num > 70) return '#28a745';
            if (num > 40) return '#ffc107';
            return '#dc3545';
        }
        
        // åˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            // åŠ è½½æ•°æ®
            fetchFromMVU();
            
            // è°ƒæ•´iframeé«˜åº¦
            setTimeout(adjustIframeHeight, 200);
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–
            window.addEventListener('resize', adjustIframeHeight);
            
            // ç›‘å¬æ¨¡æ€æ¡†å¤–ç‚¹å‡»å…³é—­
            window.addEventListener('click', (event) => {
                if (event.target.classList.contains('modal-overlay')) {
                    event.target.style.display = 'none';
                }
            });
        });

        // æ£€æŸ¥æ™¨æŠ¥æœªè¯»çŠ¶æ€
function checkMorningReportUnread() {
    if (!territoryData || !territoryData.æ™¨æŠ¥) {
        morningReportUnread = false;
        return;
    }
    
    // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦å·²è¯»å–
    const lastReadTime = localStorage.getItem('morningReportLastRead');
    const morningReports = territoryData.æ™¨æŠ¥;
    
    if (!lastReadTime) {
        // å¦‚æœä»æœªè¯»å–è¿‡ï¼Œæ˜¾ç¤ºæœªè¯»æ ‡è®°
        morningReportUnread = true;
    } else {
        // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„é€»è¾‘ï¼Œæ¯”å¦‚æ ¹æ®æ—¶é—´åˆ¤æ–­æ˜¯å¦æœ‰æ–°æ™¨æŠ¥
        // æš‚æ—¶ç®€å•å¤„ç†ä¸ºæ€»æ˜¯æ˜¾ç¤ºæœªè¯»æ ‡è®°
        morningReportUnread = true;
    }
    
    // æ›´æ–°æŒ‰é’®çŠ¶æ€
    updateMorningReportButton();
}

// æ›´æ–°æ™¨æŠ¥æŒ‰é’®çŠ¶æ€
function updateMorningReportButton() {
    const badge = document.getElementById('morning-report-badge');
    if (badge) {
        badge.style.display = morningReportUnread ? 'block' : 'none';
    }
}

// æ‰“å¼€æ™¨æŠ¥æ¨¡æ€æ¡†
function openMorningReportModal() {
    const modal = document.getElementById('morning-report-modal');
    const content = document.getElementById('morning-report-modal-content');
    
    const morningReports = territoryData.æ™¨æŠ¥ || {};
    
    if (Object.keys(morningReports).length === 0) {
        content.innerHTML = '<div style="text-align: center; padding: 40px; color: #6c757d;">æš‚æ— æ™¨æŠ¥å†…å®¹</div>';
    } else {
        let html = '<div class="morning-report-grid">';
        
        Object.entries(morningReports).forEach(([key, report]) => {
            if (typeof report === 'object' && report !== null) {
                const title = safeString(report.æ ‡é¢˜, '');
                const contentText = safeString(report.å†…å®¹, '');
                const category = key;
                
                // æ ¹æ®keyæ˜¾ç¤ºä¸åŒçš„åˆ†ç±»åç§°
                let categoryName = 'æœªåˆ†ç±»';
                switch(key) {
                    case 'ç‹å›½é£é—»': categoryName = 'ç‹å›½é£é—»'; break;
                    case 'é¢†åœ°çºªäº‹': categoryName = 'é¢†åœ°çºªäº‹'; break;
                    case 'äººç‰©è½¶å½•': categoryName = 'äººç‰©è½¶å½•'; break;
                    case 'å¼‚äº‹æ‚è°ˆ': categoryName = 'å¼‚äº‹æ‚è°ˆ'; break;
                }
                
                html += `
                    <div class="morning-report-card">
                        <div class="morning-report-header">
                            <div class="morning-report-title">${title}</div>
                            <div class="morning-report-category">${categoryName}</div>
                        </div>
                        <div class="morning-report-content">
                            ${contentText.replace(/\n/g, '<br>')}
                        </div>
                        <div class="morning-report-actions">
                            <button class="share-btn" onclick="shareReport('${key}', '${title.replace(/'/g, "\\'")}', '${contentText.replace(/'/g, "\\'")}')">
                                ğŸ“¤ åˆ†äº«
                            </button>
                        </div>
                    </div>
                `;
            }
        });
        
        html += '</div>';
        content.innerHTML = html;
    }
    
    // æ ‡è®°ä¸ºå·²è¯»
    morningReportUnread = false;
    updateMorningReportButton();
    localStorage.setItem('morningReportLastRead', new Date().toISOString());
    
    modal.style.display = 'flex';
}

// å…³é—­æ™¨æŠ¥æ¨¡æ€æ¡†
function closeMorningReportModal() {
    const modal = document.getElementById('morning-report-modal');
    modal.style.display = 'none';
}

// åˆ†äº«æ™¨æŠ¥
function shareReport(reportKey, reportTitle, reportContent) {
    // å­˜å‚¨å½“å‰åˆ†äº«çš„æ™¨æŠ¥ä¿¡æ¯
    currentShareReport = {
        key: reportKey,
        title: reportTitle,
        content: reportContent
    };
    
    // æ‰“å¼€åˆ†äº«é€‰æ‹©è§’è‰²æ¨¡æ€æ¡†
    openShareCharacterModal();
}

// æ‰“å¼€åˆ†äº«é€‰æ‹©è§’è‰²æ¨¡æ€æ¡†
function openShareCharacterModal() {
    if (!currentShareReport) return;
    
    const modal = document.getElementById('share-report-modal');
    const infoDiv = document.getElementById('share-report-info');
    const characterList = document.getElementById('share-character-list');
    
    // è®¾ç½®åˆ†äº«ä¿¡æ¯
    infoDiv.innerHTML = `
        <div style="font-weight: bold; margin-bottom: 5px;">åˆ†äº«æ™¨æŠ¥ï¼š${currentShareReport.title}</div>
        <div style="font-size: 12px; color: #4A3728;">
            ${currentShareReport.content.length > 100 ? currentShareReport.content.substring(0, 100) + '...' : currentShareReport.content}
        </div>
    `;
    
    // è·å–è§’è‰²åˆ—è¡¨
    const characters = territoryData.è§’è‰² || {};
    
    if (Object.keys(characters).length === 0) {
        characterList.innerHTML = '<div style="text-align: center; padding: 20px; color: #6c757d;">æš‚æ— è§’è‰²</div>';
    } else {
        let html = '';
        
        Object.entries(characters).forEach(([characterKey, character]) => {
            if (typeof character === 'object' && character !== null) {
                const name = safeString(character.å§“å, 'æœªçŸ¥è§’è‰²');
                const overview = character.è§’è‰²æ¦‚è§ˆ || {};
                const identity = safeString(overview.èº«ä»½, '');
                const gender = safeString(overview.æ€§åˆ«, '');
                
                // ç¡®å®šå¤´åƒ
                let avatar = 'ğŸ‘¤';
                if (gender === 'å¥³') avatar = 'ğŸ‘©';
                if (gender === 'ç”·') avatar = 'ğŸ‘¨';
                if (identity.includes('é“åŒ ')) avatar = 'âš’ï¸';
                if (identity.includes('æˆ˜å£«')) avatar = 'ğŸ›¡ï¸';
                if (identity.includes('å•†äºº')) avatar = 'ğŸ’°';
                if (identity.includes('å®˜å‘˜')) avatar = 'ğŸ“‹';
                
                html += `
                    <div class="share-character-card" onclick="selectCharacterForShare('${characterKey}', '${name.replace(/'/g, "\\'")}')">
                        <div class="share-character-avatar">${avatar}</div>
                        <div>
                            <div class="share-character-name">${name}</div>
                            <div class="share-character-title">${identity}</div>
                        </div>
                    </div>
                `;
            }
        });
        
        characterList.innerHTML = html;
    }
    
    modal.style.display = 'flex';
}

// é€‰æ‹©è§’è‰²è¿›è¡Œåˆ†äº«
function selectCharacterForShare(characterKey, characterName) {
    if (!currentShareReport) return;
    
    // ç”Ÿæˆåˆ†äº«æ–‡æœ¬ - æ ¼å¼æ›´è‡ªç„¶
    const shareText = `é¢†ä¸»å¤§äººå°†ä»Šæ—¥çš„æ™¨æŠ¥åˆ†äº«ç»™æˆ‘ï¼š\n\nã€${currentShareReport.title}ã€‘\n\n${currentShareReport.content}\n\n${characterName}ï¼Œä½ å¯¹è¿™äº›æ¶ˆæ¯æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ`;
    
    console.log('æ­£åœ¨åˆ†äº«ç»™', characterName);
    
    // å°è¯•æ”¾å…¥è¾“å…¥æ¡†
    const result = sendToSillyTavern(shareText);
    
    // æ ¹æ®ç»“æœæ˜¾ç¤ºä¸åŒæç¤º
    if (result.success) {
        // å¦‚æœæˆåŠŸï¼Œä½†æ²¡æœ‰ä½¿ç”¨toastrï¼Œåˆ™ä½¿ç”¨alert
        if (!result.usedToastr) {
            alert(`âœ… æ™¨æŠ¥å·²æ”¾å…¥è¾“å…¥æ¡†ï¼\n\nåˆ†äº«å¯¹è±¡ï¼š${characterName}\n\nè¯·æŸ¥çœ‹è¾“å…¥æ¡†ä¸­çš„å†…å®¹ï¼Œå¯ä»¥ç¼–è¾‘åå‘é€ã€‚`);
        }
    } else {
        alert(`âœ… åˆ†äº«æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nè¯·åœ¨Silly Tavernçš„è¾“å…¥æ¡†ä¸­ç²˜è´´ç»™${characterName}ã€‚`);
    }
    
    // å…³é—­æ¨¡æ€æ¡†
    closeModal('share-report-modal');
    currentShareReport = null;
}
        
// å¤åˆ¶åˆ°å‰ªè´´æ¿
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        alert('åˆ†äº«æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\n' + text);
    }).catch(err => {
        console.error('å¤åˆ¶å¤±è´¥:', err);
        // åˆ›å»ºä¸´æ—¶å…ƒç´ è¿›è¡Œå¤åˆ¶
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        alert('åˆ†äº«æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
    });
}

// å‘é€æ–‡æœ¬åˆ°Silly Tavernè¾“å…¥æ¡† - æ”¹è¿›ç‰ˆï¼ˆå€Ÿé‰´åœ°å›¾æ’ä»¶æ–¹æ³•ï¼‰
function sendToSillyTavern(text) {
    console.log('å°è¯•å¡«å……è¾“å…¥æ¡†ï¼Œå†…å®¹é•¿åº¦:', text.length);
    
    try {
        // æ–¹æ³•1ï¼šä½¿ç”¨åœ°å›¾æ’ä»¶çš„æ–¹æ³•ï¼ˆæœ€å¯èƒ½æœ‰æ•ˆï¼‰
        const stDoc = window.parent.document;
        let textarea = stDoc.getElementById('send_textarea');
        
        if (textarea && textarea.tagName === 'TEXTAREA') {
            console.log('âœ… æ‰¾åˆ°è¾“å…¥æ¡† (send_textarea)');
            
            // è®¾ç½®æ–‡æœ¬
            textarea.value = text;
            
            // è§¦å‘äº‹ä»¶è®©Silly TavernçŸ¥é“å†…å®¹å·²æ”¹å˜
            textarea.dispatchEvent(new Event('input', { bubbles: true }));
            textarea.dispatchEvent(new Event('change', { bubbles: true }));
            
            // èšç„¦åˆ°è¾“å…¥æ¡†
            textarea.focus();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼ˆä½¿ç”¨toastrï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼‰
            if (window.parent.toastr) {
                window.parent.toastr.success('æ–‡æœ¬å·²æ”¾å…¥è¾“å…¥æ¡†ï¼');
            }
            
            return { success: true, usedToastr: !!window.parent.toastr };
        }
        
        // æ–¹æ³•2ï¼šå¤‡ç”¨é€‰æ‹©å™¨
        const backupSelectors = [
            '#user-input',
            '#message-input',
            '.chat-input textarea',
            '.input-area textarea',
            'textarea[placeholder*="å‘é€"]',
            'textarea[placeholder*="Send"]',
            'textarea[placeholder*="æ¶ˆæ¯"]',
            'textarea[placeholder*="Message"]'
        ];
        
        for (let selector of backupSelectors) {
            textarea = stDoc.querySelector(selector);
            if (textarea && textarea.tagName === 'TEXTAREA') {
                console.log(`âœ… æ‰¾åˆ°è¾“å…¥æ¡† (${selector})`);
                textarea.value = text;
                textarea.dispatchEvent(new Event('input', { bubbles: true }));
                textarea.dispatchEvent(new Event('change', { bubbles: true }));
                textarea.focus();
                
                if (window.parent.toastr) {
                    window.parent.toastr.success('æ–‡æœ¬å·²æ”¾å…¥è¾“å…¥æ¡†ï¼');
                }
                
                return { success: true, usedToastr: !!window.parent.toastr };
            }
        }
        
        // æ–¹æ³•3ï¼šéå†æ‰€æœ‰textarea
        const allTextareas = stDoc.querySelectorAll('textarea');
        for (let ta of allTextareas) {
            if (!ta.readOnly && !ta.disabled) {
                console.log('âœ… æ‰¾åˆ°å¯ç”¨çš„textarea');
                ta.value = text;
                ta.dispatchEvent(new Event('input', { bubbles: true }));
                ta.dispatchEvent(new Event('change', { bubbles: true }));
                ta.focus();
                
                if (window.parent.toastr) {
                    window.parent.toastr.success('æ–‡æœ¬å·²æ”¾å…¥è¾“å…¥æ¡†ï¼');
                }
                
                return { success: true, usedToastr: !!window.parent.toastr };
            }
        }
        
        console.log('âŒ åœ¨çˆ¶çª—å£ä¸­æœªæ‰¾åˆ°å¯ç”¨çš„è¾“å…¥æ¡†');
        
        // æ–¹æ³•4ï¼šå¦‚æœä»¥ä¸Šéƒ½å¤±è´¥ï¼Œå°è¯•åœ¨å½“å‰çª—å£æŸ¥æ‰¾
        const localSelectors = [
            '#send_textarea',
            '#user-input',
            '#message-input',
            'textarea:not([readonly]):not([disabled])'
        ];
        
        for (let selector of localSelectors) {
            textarea = document.querySelector(selector);
            if (textarea && textarea.tagName === 'TEXTAREA') {
                console.log(`âœ… åœ¨å½“å‰çª—å£æ‰¾åˆ°è¾“å…¥æ¡† (${selector})`);
                textarea.value = text;
                textarea.dispatchEvent(new Event('input', { bubbles: true }));
                textarea.dispatchEvent(new Event('change', { bubbles: true }));
                textarea.focus();
                
                if (window.parent.toastr) {
                    window.parent.toastr.success('æ–‡æœ¬å·²æ”¾å…¥è¾“å…¥æ¡†ï¼');
                }
                
                return { success: true, usedToastr: !!window.parent.toastr };
            }
        }
        
        console.log('âŒ æ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥ï¼Œä½¿ç”¨å‰ªè´´æ¿å¤‡ç”¨æ–¹æ¡ˆ');
        copyToClipboard(text);
        return { success: false };
        
    } catch (error) {
        console.error('å¡«å……è¾“å…¥æ¡†æ—¶å‡ºé”™:', error);
        
        // è·¨åŸŸé”™è¯¯å¤„ç†
        if (error.name === 'SecurityError' || error.message.includes('cross-origin')) {
            console.log('è·¨åŸŸè®¿é—®è¢«é˜»æ­¢ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆ');
            // å°è¯•postMessageé€šä¿¡
            try {
                if (window.parent && window.parent.postMessage) {
                    window.parent.postMessage({
                        type: 'fill_textarea',
                        text: text
                    }, '*');
                    console.log('å·²å‘é€postMessageè¯·æ±‚');
                }
            } catch (e) {
                console.error('postMessageä¹Ÿå¤±è´¥:', e);
            }
        }
        
        // æœ€ç»ˆå›é€€åˆ°å‰ªè´´æ¿
        copyToClipboard(text);
        return { success: false };
    }
}
    </script>
</body>
</html>
