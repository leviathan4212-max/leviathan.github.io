<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢†åœ°çŠ¶æ€é¢æ¿</title>
    <style>
        /* å…³é”®ï¼šå¼ºåˆ¶é‡ç½®æ‰€æœ‰å¯èƒ½çš„æ ·å¼å†²çª */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            height: auto !important;
            background: #F5E6C8 !important; /* å¼ºåˆ¶ç¾Šçš®çº¸èƒŒæ™¯ */
            font-family: 'Microsoft YaHei', 'SimHei', sans-serif !important;
            color: #2C1810 !important;
            overflow: visible !important;
        }
        
        /* ä¸»å®¹å™¨ - ä¸è¦ç”¨å›ºå®šé«˜åº¦ */
        .territory-status-panel {
            background: #F5E6C8 !important;
            border: 2px solid #8B6914 !important;
            border-radius: 8px !important;
            padding: 15px !important;
            margin: 10px !important;
            width: auto !important;
            max-width: none !important;
            min-height: auto !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
        }
        
        /* å¤´éƒ¨ */
        .status-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #8B6914;
            padding-bottom: 10px;
        }
        
        .header-title {
            font-size: 1.5em;
            color: #2C1810;
            margin: 0 0 5px 0;
        }
        
        .header-subtitle {
            color: #8B6914;
            font-size: 0.9em;
        }
        
        /* ç« èŠ‚æ ·å¼ */
        .status-section {
            margin-bottom: 15px;
            border: 1px solid #8B6914;
            border-radius: 5px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .section-header {
            background: #E8D4A8;
            padding: 8px 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #8B6914;
        }
        
        .section-title {
            font-weight: bold;
            color: #2C1810;
        }
        
        .toggle-arrow {
            font-size: 0.8em;
        }
        
        .section-content {
            padding: 10px;
            display: block; /* é»˜è®¤æ˜¾ç¤º */
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* æ•°æ®ç½‘æ ¼ */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .data-item {
            margin-bottom: 8px;
        }
        
        .data-label {
            font-weight: bold;
            color: #4A3728;
            font-size: 0.9em;
            margin-bottom: 2px;
        }
        
        .data-value {
            color: #2C1810;
        }
        
        /* ç§æ—ç½‘æ ¼ */
        .race-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }
        
        .race-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #8B6914;
            border-radius: 4px;
            padding: 6px;
            font-size: 0.9em;
        }
        
        .race-name {
            font-weight: bold;
            color: #2C1810;
        }
        
        .race-status {
            font-size: 0.8em;
            color: #4A3728;
        }
        
        /* ç»Ÿè®¡è¡Œ */
        .stats-row {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            padding: 10px;
            background: rgba(201, 162, 39, 0.1);
            border-radius: 5px;
        }
        
        .stat-item {
            text-align: center;
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #8B7314;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #4A3728;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .race-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-row {
                flex-wrap: wrap;
            }
            
            .stat-item {
                flex: 0 0 50%;
                margin-bottom: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .territory-status-panel {
                padding: 10px;
                margin: 5px;
            }
            
            .race-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="territory-status-panel">
        <div class="status-header">
            <h1 class="header-title">é¢†åœ°çŠ¶æ€é¢æ¿</h1>
            <div class="header-subtitle">æœ€åæ›´æ–°: <span id="update-time">åˆšåˆš</span></div>
        </div>
        
        <!-- é¢†åœ°åŸºç¡€ä¿¡æ¯ -->
        <div class="status-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">ğŸ° é¢†åœ°åŸºç¡€ä¿¡æ¯</div>
                <div class="toggle-arrow">â–¼</div>
            </div>
            <div class="section-content">
                <div class="data-grid" id="basic-info">
                    <div class="data-item">
                        <div class="data-label">é¢†åœ°åç§°</div>
                        <div class="data-value">åŒ—å¢ƒè¾¹å¢ƒé¢†</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">é¢†åœ°é¢ç§¯</div>
                        <div class="data-value">85 å¹³æ–¹é‡Œ</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">åœ°å½¢ç‰¹å¾</div>
                        <div class="data-value">ä¸˜é™µä¸æ£®æ—</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">å‘å±•é˜¶æ®µ</div>
                        <div class="data-value">åˆå»º</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- äººå£ä¸ç§æ—æ„æˆ -->
        <div class="status-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">ğŸ‘¥ äººå£ä¸ç§æ—æ„æˆ</div>
                <div class="toggle-arrow">â–¼</div>
            </div>
            <div class="section-content">
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-label">æ€»äººå£</div>
                        <div class="data-value">1,250 äºº</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">èŒä¸šåˆ†å¸ƒ</div>
                        <div class="data-value">å†œæ°‘ 700äºº, å·¥åŒ  120äºº</div>
                    </div>
                </div>
                <div class="race-grid">
                    <div class="race-card">
                        <div class="race-name">äººç±»</div>
                        <div class="race-status">900äºº | ä¸»å¯¼</div>
                    </div>
                    <div class="race-card">
                        <div class="race-name">çŸ®äºº</div>
                        <div class="race-status">150äºº | å¹³ç­‰</div>
                    </div>
                    <div class="race-card">
                        <div class="race-name">åŠç²¾çµ</div>
                        <div class="race-status">100äºº | å¹³ç­‰</div>
                    </div>
                    <div class="race-card">
                        <div class="race-name">å“¥å¸ƒæ—</div>
                        <div class="race-status">50äºº | å¥´éš¶</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç»æµä¸è´¢æ”¿ -->
        <div class="status-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">ğŸ’° ç»æµä¸è´¢æ”¿</div>
                <div class="toggle-arrow">â–¼</div>
            </div>
            <div class="section-content">
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-value">2,500</div>
                        <div class="stat-label">å›½åº“èµ„é‡‘</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">+180</div>
                        <div class="stat-label">æœˆåº¦å‡€æ”¶å…¥</div>
                    </div>
                </div>
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-label">æœˆæ€»æ”¶å…¥</div>
                        <div class="data-value">1,850 é‡‘å¸</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">æœˆæ€»æ”¯å‡º</div>
                        <div class="data-value">1,670 é‡‘å¸</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä»“åº“ç‰©èµ„å‚¨å¤‡ -->
        <div class="status-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">ğŸª ä»“åº“ç‰©èµ„å‚¨å¤‡</div>
                <div class="toggle-arrow">â–¼</div>
            </div>
            <div class="section-content">
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-label">ç²®é£Ÿ</div>
                        <div class="data-value">6,500 æ‹…</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">æœ¨æ</div>
                        <div class="data-value">900 æ–¹</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">çŸ³æ</div>
                        <div class="data-value">500 æ–¹</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">é“çŸ¿</div>
                        <div class="data-value">300 æ–¤</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å†›äº‹ä¸é˜²å¾¡ -->
        <div class="status-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">âš”ï¸ å†›äº‹ä¸é˜²å¾¡</div>
                <div class="toggle-arrow">â–¼</div>
            </div>
            <div class="section-content">
                <div class="stats-row">
                    <div class="stat-item">
                        <div class="stat-value">80</div>
                        <div class="stat-label">å¸¸å¤‡å†›</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">200</div>
                        <div class="stat-label">æ°‘å…µ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">D</div>
                        <div class="stat-label">æˆ˜åŠ›è¯„çº§</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å±…æ°‘ä¸ç¤¾ä¼šçŠ¶æ€ -->
        <div class="status-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">ğŸ  å±…æ°‘ä¸ç¤¾ä¼šçŠ¶æ€</div>
                <div class="toggle-arrow">â–¼</div>
            </div>
            <div class="section-content">
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-label">ç”Ÿæ´»æ°´å¹³</div>
                        <div class="data-value">æ¸©é¥±</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">æ²»å®‰çŠ¶å†µ</div>
                        <div class="data-value">65 (è‰¯å¥½)</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">æ°‘å¿ƒæŒ‡æ•°</div>
                        <div class="data-value">70</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">å¨èƒç­‰çº§</div>
                        <div class="data-value">è­¦æˆ’</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å»ºç­‘è®¾æ–½ -->
        <div class="status-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">ğŸ›ï¸ å»ºç­‘è®¾æ–½</div>
                <div class="toggle-arrow">â–¼</div>
            </div>
            <div class="section-content">
                <div class="data-grid">
                    <div class="data-item">
                        <div class="data-label">å±…æ°‘åŒº</div>
                        <div class="data-value">Lv.2 | æ­£å¸¸è¿è¥</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">å¸‚åœº</div>
                        <div class="data-value">Lv.2 | æ­£å¸¸è¿è¥</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">é“åŒ é“º</div>
                        <div class="data-value">Lv.1 | æ­£å¸¸è¿è¥</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">åŒ—å¢ƒç­æœ›å¡”</div>
                        <div class="data-value">Lv.1 | å»ºè®¾ä¸­</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°æ—¶é—´ä¸ºå½“å‰æ—¶é—´
        function updateTime() {
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            document.getElementById('update-time').textContent = timeStr;
        }
        
        // åˆ‡æ¢ç« èŠ‚æ˜¾ç¤º/éšè—
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const arrow = header.querySelector('.toggle-arrow');
            
            if (content.style.display === 'none' || content.style.display === '') {
                content.style.display = 'block';
                arrow.textContent = 'â–¼';
            } else {
                content.style.display = 'none';
                arrow.textContent = 'â–¶';
            }
        }
        
        // ä»MVUè·å–æ•°æ®ï¼ˆéœ€è¦MVUæ’ä»¶æ”¯æŒï¼‰
        async function fetchFromMVU() {
            try {
                // å°è¯•ä»MVUæ’ä»¶è·å–æ•°æ®
                if (typeof window.getVariables === 'function') {
                    console.log('å°è¯•ä»MVUè·å–æ•°æ®...');
                    
                    // è¿™é‡Œéœ€è¦æ ¹æ®MVUæ’ä»¶çš„å®é™…APIè¿›è¡Œè°ƒæ•´
                    const mvuData = await window.getVariables({ 
                        type: 'message', 
                        message_id: window.getCurrentMessageId?.() || 'current' 
                    });
                    
                    if (mvuData && mvuData.Territory) {
                        console.log('MVUæ•°æ®è·å–æˆåŠŸ:', mvuData.Territory);
                        return mvuData.Territory;
                    }
                }
                
                // å¦‚æœMVUä¸å¯ç”¨ï¼Œæ£€æŸ¥localStorage
                const storedData = localStorage.getItem('territoryData');
                if (storedData) {
                    console.log('ä»localStorageè·å–æ•°æ®');
                    return JSON.parse(storedData);
                }
                
                // å¦‚æœéƒ½æ²¡æœ‰ï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®
                console.log('ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                return {
                    åŸºæœ¬ä¿¡æ¯: {
                        åç§°: "åŒ—å¢ƒè¾¹å¢ƒé¢†",
                        é¢ç§¯: 85,
                        åœ°å½¢: "ä¸˜é™µä¸æ£®æ—",
                        å‘å±•é˜¶æ®µ: "åˆå»º"
                    },
                    äººå£: {
                        æ€»äººå£: 1250,
                        ç§æ—æ„æˆ: {
                            äººç±»: { æ•°é‡: 900, åœ°ä½: "ä¸»å¯¼" },
                            çŸ®äºº: { æ•°é‡: 150, åœ°ä½: "å¹³ç­‰" },
                            åŠç²¾çµ: { æ•°é‡: 100, åœ°ä½: "å¹³ç­‰" },
                            å“¥å¸ƒæ—: { æ•°é‡: 50, åœ°ä½: "å¥´éš¶" }
                        }
                    },
                    ç»æµ: {
                        è´¢æ”¿: {
                            åº“å­˜é‡‘å¸: 2500,
                            æœˆæ€»æ”¶å…¥: 1850,
                            æœˆæ€»æ”¯å‡º: 1670,
                            æœˆå‡€æ”¶å…¥: 180
                        }
                    },
                    ä»“åº“: {
                        ç²®é£Ÿ: { å½“å‰å‚¨é‡: 6500, å•ä½: "æ‹…" },
                        æœ¨æ: { å½“å‰å‚¨é‡: 900, å•ä½: "æ–¹" },
                        çŸ³æ: { å½“å‰å‚¨é‡: 500, å•ä½: "æ–¹" },
                        é“çŸ¿: { å½“å‰å‚¨é‡: 300, å•ä½: "æ–¤" }
                    },
                    å†›äº‹: {
                        å…µåŠ›: {
                            å¸¸å¤‡å†›: 80,
                            æ°‘å…µ: 200,
                            ç²¾é”éƒ¨é˜Ÿ: 0
                        },
                        æˆ˜åŠ›è¯„çº§: {
                            æ€»è¯„çº§: "D"
                        }
                    },
                    çŠ¶æ€: {
                        å±…æ°‘çŠ¶æ€: {
                            ç”Ÿæ´»æ°´å¹³: "æ¸©é¥±",
                            æ²»å®‰çŠ¶å†µ: 65,
                            æ°‘å¿ƒæŒ‡æ•°: 70,
                            å¨èƒç­‰çº§: "è­¦æˆ’"
                        }
                    },
                    å»ºç­‘: {
                        å±…æ°‘åŒº: { åç§°: "å±…æ°‘åŒº", ç­‰çº§: 2, çŠ¶æ€: "æ­£å¸¸è¿è¥" },
                        å¸‚åœº: { åç§°: "å¸‚åœº", ç­‰çº§: 2, çŠ¶æ€: "æ­£å¸¸è¿è¥" },
                        é“åŒ é“º: { åç§°: "é“åŒ é“º", ç­‰çº§: 1, çŠ¶æ€: "æ­£å¸¸è¿è¥" },
                        åŒ—å¢ƒç­æœ›å¡”: { åç§°: "åŒ—å¢ƒç­æœ›å¡”", ç­‰çº§: 1, çŠ¶æ€: "å»ºè®¾ä¸­" }
                    }
                };
            } catch (error) {
                console.error('è·å–æ•°æ®å¤±è´¥:', error);
                return null;
            }
        }
        
        // æ›´æ–°UIæ•°æ®
        async function updateUIData() {
            const data = await fetchFromMVU();
            if (!data) return;
            
            // æ›´æ–°åŸºç¡€ä¿¡æ¯
            const basicInfo = document.getElementById('basic-info');
            if (basicInfo && data.åŸºæœ¬ä¿¡æ¯) {
                basicInfo.innerHTML = `
                    <div class="data-item">
                        <div class="data-label">é¢†åœ°åç§°</div>
                        <div class="data-value">${data.åŸºæœ¬ä¿¡æ¯.åç§° || 'æœªçŸ¥'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">é¢†åœ°é¢ç§¯</div>
                        <div class="data-value">${data.åŸºæœ¬ä¿¡æ¯.é¢ç§¯ || 'æœªçŸ¥'} å¹³æ–¹é‡Œ</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">åœ°å½¢ç‰¹å¾</div>
                        <div class="data-value">${data.åŸºæœ¬ä¿¡æ¯.åœ°å½¢ || 'æœªçŸ¥'}</div>
                    </div>
                    <div class="data-item">
                        <div class="data-label">å‘å±•é˜¶æ®µ</div>
                        <div class="data-value">${data.åŸºæœ¬ä¿¡æ¯.å‘å±•é˜¶æ®µ || 'æœªçŸ¥'}</div>
                    </div>
                `;
            }
            
            // å¯ä»¥æ·»åŠ æ›´å¤šæ•°æ®æ›´æ–°é€»è¾‘...
            
            // æ›´æ–°æ—¶é—´
            updateTime();
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¢†åœ°çŠ¶æ€é¢æ¿åˆå§‹åŒ–...');
            
            // åˆå§‹æ›´æ–°æ—¶é—´
            updateTime();
            
            // å°è¯•è·å–æ•°æ®
            setTimeout(updateUIData, 100);
            
            // æ¯éš”30ç§’è‡ªåŠ¨æ›´æ–°
            setInterval(updateTime, 30000);
            
            // æ·»åŠ å…¨å±€APIï¼Œä¾›SillyTavernè°ƒç”¨
            window.TerritoryStatus = {
                refresh: updateUIData,
                setData: function(newData) {
                    console.log('æ‰‹åŠ¨è®¾ç½®é¢†åœ°æ•°æ®:', newData);
                    localStorage.setItem('territoryData', JSON.stringify(newData));
                    updateUIData();
                }
            };
            
            console.log('é¢†åœ°çŠ¶æ€é¢æ¿å·²å°±ç»ª');
        });
    </script>
</body>
</html>
